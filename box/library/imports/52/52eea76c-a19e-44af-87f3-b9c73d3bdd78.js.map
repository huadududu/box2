{"version":3,"sources":["../../../../../assets/src/controller/assets/src/controller/BoxController.js"],"names":["CameraController","require","StageConfig","BlockConfig","CycleConfig","GameType","GameUtils","BlockBigFactory","BlockSmallFactory","SpriteFrameCenter","ParticleSystemCenter","GameMenuController","winsize","cc","winSize","BaseHeight","height","BaseWidth","width","GameHeight","GameCenterY","BaseGame","Class","extends","Component","properties","gameNode","Node","camera","Camera","BlockBig","Prefab","BlockSmall","MarginsBig","MarginsSmall","UIBottom","Sky","Bgbz","Underground","motionStreak","MotionStreak","hammer","sp","Skeleton","boxSpine","btnbox","Button","language","visible","default","hard","myinfo","type","floorNum","rowNum","blockWidth","blockBlank","moveNum","margins","curMaxLine","canTouch","previousPt","Hatting","HattingPos","onLoad","preLoadAtlas","initdata","bind","blocks","marginlist","startPos","setCompleteListener","animationName","trackEntry","animation","name","log","trackIndex","node","active","smCallback","animationName1","restart","playBoxSpine","setAnimation","stopBoxSpine","playHammerSpine","stopHammerSpine","changeHammerSpine","data","skeletonData","start","JSON","parse","sys","localStorage","getItem","level","gold","gem","exp","initInfo","layer","i","length","blockwidth","size","count","blank","addBlocks","cameraStartPosY","setSmPosition","addUIBottom","resetMarginList","isValid","destroy","resetBlockList","j","lineinfo","addLines","getPngName","cycleID","push","topline","top","pngname","thisNum","conf","factory","curX","curY","lineArray","left","createMargins","position","p","addChild","right","endpos","create","thisID","indexOf","cycleArry","split","getnum","randomInt","parseInt","neednumber","destroyBlock","line","row","destroyUpdate","checkCanDestroy","setItem","stringify","updateDate","maxLineNum","max","totoalRowNum","cameraCentPosY","maxline","move","oldY","getPositionY","newY","setPositionY","posbottom","y","totoal","skyposy","bzYbottom","other","realwidth","maxrow","range","geScreenRange","find","canclick","num","location","hammerpos","texiao","getEffByBlock","addParticleForNode","x","getComponent","getPngId","cameraPosY","min","maxPosY","canshowy","Math","floor","cameraY","gameY","realx","realy","hamX","hamY","updateTouch","point","touchStartCallBack","reset","console","setPositionX","touchCancelCallBack","isTouching","touchEndCallBack","touchMoveCallBack","onClickTreasure","event","maxlinenum","touchEndPoint","getLocation","eventcallback","id","toolChange","info","ToolConfig","SkeletonDataCenter","addSkeletonData","update"],"mappings":"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","file":"BoxController.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/**\n * Created by bing on 20/04/2018.\n */\n\n//负责head展现和变换。\nconst CameraController = require('CameraController');\nlet StageConfig = require(\"StageConfig\");\nlet BlockConfig = require(\"BoxConfig1\");\nlet CycleConfig = require(\"CycleConfig\");\nlet GameType = require(\"GameType\");\nlet GameUtils = require(\"GameUtils\");\nlet BlockBigFactory = require(\"BlockBigFactory\");\nlet BlockSmallFactory = require(\"BlockSmallFactory\");\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\nlet GameMenuController = require('GameMenuController');\n\n\nlet winsize = cc.winSize;\nconst BaseHeight =  winsize.height/2;\nconst BaseWidth =  winsize.width/2;\nconst GameHeight = 514;\nconst GameCenterY = 360;\nconst BaseGame = 257 ;\n\ncc.Class({\n    extends:cc.Component,\n\n    properties:{\n        gameNode:cc.Node,\n        camera: cc.Camera,\n        BlockBig:cc.Prefab,\n        BlockSmall:cc.Prefab,\n        MarginsBig:cc.Prefab,\n        MarginsSmall:cc.Prefab,\n        UIBottom:cc.Prefab,\n        Sky:cc.Node,\n        Bgbz:cc.Node,\n        Underground:cc.Node,\n        motionStreak: cc.MotionStreak,\n        hammer: sp.Skeleton,\n        boxSpine:sp.Skeleton,\n        btnbox:cc.Button,\n        GameMenuController: GameMenuController,\n        language:{\n            visible: false,\n            default:\"English\"\n        },\n        hard:{\n            visible : true,\n            default:5\n        },\n        myinfo:{\n            visible : true,\n            default:null\n        },\n        type:{\n            visible : false,\n            default:0\n        },\n        floorNum:{\n            visible:false,\n            default:5\n        },\n        rowNum:{\n            visible:false,\n            default:5\n        },\n        blockWidth:100,\n        blockBlank:{\n            visible:false,\n            default:0\n        },\n        moveNum:{\n            visible:false,\n            default:0\n        },\n        margins:{\n            visible:false,\n            default:0\n        },\n        curMaxLine:{\n            visible: false,\n            default:0\n        },\n        canTouch:{\n            visible:false,\n            default:true\n        },\n        previousPt:{\n            visible:false,\n            default:null\n        },\n        Hatting:{\n            visible:false,\n            default:false\n        },\n        HattingPos:{\n            visible: false,\n            default:null\n        }\n    },\n\n\n    onLoad:function () {\n        SpriteFrameCenter.preLoadAtlas(\"png/box\",this.initdata.bind(this));\n        this.blocks = [];\n        this.marginlist=[];\n        this.startPos = -GameHeight/2;\n        // this.sm.on('stop',      this.smCallback,        this);\n        this.hammer.setCompleteListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n            this.hammer.node.active = false;\n              this.smCallback();\n        });\n         this.boxSpine.node.active = false;\n        this.boxSpine.setCompleteListener(trackEntry => {\n            var animationName1 = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName1);\n             this.restart();\n            this.boxSpine.node.active = false;\n\n        });\n    },\n    playBoxSpine:function () {\n        this.boxSpine.node.active = true;\n        this.boxSpine.setAnimation(0, \"newAnimation\", false);\n    },\n\n\n    stopBoxSpine:function () {\n        this.boxSpine.node.active = false;\n    },\n    playHammerSpine:function () {\n\n         this.hammer.node.active = true;\n         this.hammer.setAnimation(0, \"newAnimation\", true);\n    },\n    stopHammerSpine:function () {\n        this.hammer.node.active = false;\n    },\n    changeHammerSpine:function(data){\n        // this.hammer.node.active = false;\n        this.hammer.skeletonData = data;\n    },\n    start:function(){\n        // this.initdata();\n        this.myinfo = JSON.parse(cc.sys.localStorage.getItem('myinfo'));\n        if(this.myinfo == null){\n            this.myinfo ={hard:1,level:1,gold:1,gem:1,exp:1,hammer:[]};\n        }\n        this.hard = this.myinfo[\"hard\"];\n        this.GameMenuController.initInfo(this.myinfo);\n    },\n    restart:function(){\n        this.hard++;\n\n        this.initdata();\n    },\n    initdata:function(){\n        this.floorNum=StageConfig[this.hard].layer;\n        for (var i = 0;i<BlockConfig.length;i++){\n            if(BlockConfig[i].blockwidth == StageConfig[this.hard].size){\n                this.type = BlockConfig[i].type;\n                break;\n            }\n        }\n        this.rowNum=BlockConfig[this.type].count;\n        this.blockWidth=BlockConfig[this.type].blockwidth;\n        this.blockBlank=BlockConfig[this.type].blank;\n        this.margins=BlockConfig[this.type].margins;\n\n        this.addBlocks();\n        this.cameraStartPosY();\n        this.setSmPosition();\n        this.GameMenuController.addUIBottom();\n        this.playHammerSpine();\n        this.btnbox.node.active = true;\n\n    },\n    resetMarginList:function(){\n        if(this.marginlist.length>0){\n            for(let i=0 ;i<this.marginlist.length;i++){\n                let node = this.marginlist[i];\n                if(cc.isValid(node)){\n                    node.destroy();\n                }\n            }\n        }\n        this.marginlist=[];\n    },\n    resetBlockList:function(){\n        if(this.blocks.length>0){\n            for(let i=0 ;i<this.blocks.length;i++){\n                for( let j=0;j<this.blocks[i].length;j++){\n                    let node = this.blocks[i][j];\n                    if(cc.isValid(node)){\n                        node.destroy();\n                    }\n                }\n            }\n        }\n        this.blocks=[];\n    },\n    //--------- block -----------------------\n    addBlocks:function() {\n\n        this.resetBlockList();\n        this.resetMarginList();\n        for (var i =0;i< this.floorNum-1;i++){\n\n            var lineinfo=this.addLines(this.getPngName(StageConfig[this.hard].cycleID,i),i);\n\n            this.blocks.push(lineinfo);\n            lineinfo=[];\n        }\n        let topline = this.addLines(StageConfig[this.hard].top,i);\n        this.blocks.push(topline);\n    },\n    addLines:function (pngname,thisNum) {\n\n        let conf=BlockConfig[this.type];\n        let count = conf.count;\n        let factory= this.type == 0?BlockBigFactory:BlockSmallFactory;\n        let curX= conf.margins+conf.blank -BaseWidth;\n        let curY= thisNum*(this.blockWidth+conf.blank) + this.startPos;\n        let lineArray=[];\n        let left = factory.createMargins(pngname);\n\n        left.position = cc.p(conf.margins/2-BaseWidth,curY+this.blockWidth/2);\n        this.gameNode.addChild(left);\n        this.marginlist.push(left);\n        let right = factory.createMargins(pngname);\n        let endpos = BaseWidth- conf.margins/2;\n        right.position = cc.p(endpos,curY+this.blockWidth/2);\n        this.gameNode.addChild(right);\n        this.marginlist.push(right);\n\n        for(var i=0;i<count;i++){\n            let node = factory.create(pngname);\n            node.position = cc.p(curX+this.blockWidth/2,curY+this.blockWidth/2);\n            curX+=this.blockWidth+conf.blank;\n            this.gameNode.addChild(node);\n            lineArray.push(node);\n        }\n\n        return lineArray;\n    },\n\n    //根据 获得 图片的名字\n    getPngName(cycleID,thisNum){\n        let thisID;\n        if(cycleID.indexOf(\";\") != -1){\n            let cycleArry = cycleID.split(\";\");\n            let getnum=GameUtils.randomInt(0,cycleArry.length-1);\n            thisID=cycleArry[getnum];\n        }else{\n            thisID=parseInt(cycleID);\n        }\n        let neednumber=0;\n        for(var i =1;i<=10 ;i++)\n        {\n            if(CycleConfig[thisID][\"num\"+i] == 0){\n                i=0;\n                continue;\n            }\n            neednumber+=CycleConfig[thisID][\"num\"+i];\n            if(neednumber>=thisNum){\n                return CycleConfig[thisID][\"block\"+i]\n            }\n            if(i==10){\n                i=0;\n            }\n        }\n    },\n    //销毁砖块\n    destroyBlock:function(line,row ){\n\n        if(!this.blocks[line])\n            return;\n        let node = this.blocks[line][row];\n        if(cc.isValid(node) ) {\n            node.destroy();\n            this.destroyUpdate();\n        }\n\n    },\n    checkCanDestroy :function(line,row){\n        if(!cc.isValid(this.blocks[line]) || !cc.isValid(this.blocks[line][row]) )\n            return false;\n        if(line >= this.floorNum-1)\n            return true;\n        let node;\n        node = this.blocks[line+1][row];\n        if(!cc.isValid(node)){\n            return true;\n        }\n        if(line>0){\n            node = this.blocks[line-1][row];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }\n        if(row>0 && row <this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if (row == 0){\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if(row == this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    destroyUpdate:function(){\n        this.myinfo.exp++;\n        cc.sys.localStorage.setItem('myinfo',JSON.stringify(this.myinfo));\n        this.GameMenuController.updateDate({exp:this.myinfo.exp});\n\n    },\n    //--------- block -----------------------\n    maxLineNum:function(){\n        var max=0;\n        for(var i=0;i<this.floorNum;i++){\n            for(var j= 0;j<this.rowNum;j++) {\n                if (this.blocks && this.blocks[i] && this.blocks[i][j]) {\n                    var node = this.blocks[i][j];\n                    if (!cc.isValid(node))\n                        continue;\n                    if (i > max) {\n                        max = i;\n                    }\n                    break;\n                }\n            }\n        }\n        return max;\n    },\n\n    totoalRowNum:function(line) {//line 行拥有点的数量\n        var max = 0;\n        for(var j= 0;j<this.rowNum;j++){\n            var node = this.blocks[line][j];\n            if(!cc.isValid(node) )\n                continue;\n            max++;\n        }\n        return max;\n    },\n\n    //************camera 相关设置 start **********************\n    cameraCentPosY:function(){\n\n        let maxline=this.maxLineNum();\n        if(this.curMaxLine<= maxline){\n            return;\n        }\n        let move = this.curMaxLine-maxline;\n        this.curMaxLine=maxline;\n        let oldY = this.camera.node.getPositionY();\n        if(oldY<=GameCenterY){\n            return;\n        }\n        let newY= oldY-this.blockWidth*move;\n        if(newY>=GameCenterY){\n            this.camera.node.setPositionY(newY);\n        }else {\n            this.camera.node.setPositionY(GameCenterY);\n        }\n\n    },\n\n    cameraStartPosY:function(){\n        let height = this.floorNum*(this.blockWidth+this.blockBlank);\n        //地下\n        this.Underground.height=height;\n        let posbottom= (height-GameHeight)/2;\n        this.Underground.y=posbottom;\n        //地面\n        let totoal= this.Bgbz.height+height -50;\n        let skyposy;\n        let bzYbottom;\n        let other = GameHeight- totoal;\n        bzYbottom= (totoal+height - GameHeight)/2 -25;\n        this.Bgbz.y=bzYbottom;\n        if(other>0){\n            this.Sky.active = true;\n            this.Sky.height = other+10;\n            skyposy= (GameHeight - other)/2;\n            this.Sky.y=skyposy;\n            this.camera.node.setPositionY(GameCenterY);\n        }else{\n            this.Sky.active = false;\n            this.camera.node.setPositionY(GameCenterY - other);\n\n        }\n        this.curMaxLine = this.floorNum -1;\n    },\n\n\n    //************camera 相关设置 end **********************\n    //*********** 锤子 相关设置  start***************\n    setSmPosition:function(){\n        let realwidth=this.blockWidth+this.blockBlank;\n        let maxline = this.curMaxLine;\n        let maxrow = this.totoalRowNum(0);\n        if(maxline == 0 && maxrow ==   0)\n        {\n            this.HattingPos =null;\n            // this.sm.node.visible = false;\n            this.hammer.node.active = false;\n            return ;\n        }\n         this.hammer.node.active = true;\n        let range = this.geScreenRange();\n        // let line = GameUtils.randomInt(range.min,range.max);\n         let line = this.curMaxLine;\n        let find = false;\n        let canclick=[];\n        for(var i = 0;i<this.rowNum;i++){\n            if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\n                canclick.push(i);\n\n            }\n        }\n\n       let num = GameUtils.randomInt(0,canclick.length-1);\n        let row= canclick[num];\n\n        let location = this.hammerpos(line,row);\n        let texiao=this.getEffByBlock(line,row);\n        ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n        this.HattingPos ={x:line,y:row};\n        this.hammer.node.position=location;\n        this.playHammerSpine();\n    },\n    //根据小块的位置 过的特效文件\n    getEffByBlock(line,row){\n\n        let type = this.type == 0? \"BlockBig\":\"BlockSmall\";\n        let node = this.blocks[line][row].getComponent(type);\n        return node.getPngId();\n    },\n    geScreenRange : function(){\n        let max = this.curMaxLine;\n        let cameraPosY = this.camera.node.getPositionY();\n        let min=0;\n        let realwidth=this.blockWidth+this.blockBlank;\n        if(cameraPosY <= BaseHeight){\n            min =0;\n        }else{\n            let maxPosY= max*realwidth;\n            let canshowy = (maxPosY - cameraPosY+BaseHeight)/realwidth;\n            min = Math.floor(max- canshowy);\n        }\n        return {max:max,min:min};\n    },\n    //根据块的位置计算锤子的位置\n    hammerpos:function(line,row){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        let realx = row * realwidth+this.margins+this.blockBlank;\n        let realy = line * realwidth+gameY -cameraY -BaseGame;\n        let hamX= realx - BaseWidth + 42+this.blockWidth;\n        let hamY = realy - 42;\n        return cc.p(hamX,hamY);\n\n    },\n    smCallback:function(){\n        if(this.HattingPos != null){\n            let y= this.HattingPos.y;\n            let x= this.HattingPos.x;\n            if(cc.isValid(this.blocks[x][y])){\n                // this.blocks[x][y].destroy();\n                this.destroyBlock(x,y);\n            }\n            this.cameraCentPosY();\n             this.setSmPosition();\n        }\n    },\n    //*********** 锤子 相关设置  end*****************\n\n    updateTouch:function(point){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        var line = Math.floor((point.y-(gameY-cameraY+BaseHeight - BaseGame))/realwidth);\n        var row = Math.floor((point.x-this.margins - this.blockBlank)/realwidth);\n        if(this.checkCanDestroy(line,row)){\n            let location = this.hammerpos(line,row);\n            let texiao=this.getEffByBlock(line,row);\n            ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n            this.destroyBlock(line,row);\n        }\n    },\n    touchStartCallBack:function (location) {\n        if(!this.canTouch){\n            return;\n        }\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins)){\n            this.motionStreak.reset();\n            return;\n        }\n        console.log(\"touchStartCallBack\");\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n        this.motionStreak.reset();\n        // this.isTouching = false;\n    },\n\n    touchCancelCallBack:function (location) {\n        this.updateTouch(location);\n        this.isTouching = false;\n        this.motionStreak.reset();\n    },\n\n    touchEndCallBack:function (location) {\n        // this.touchPosition(location);\n        this.updateTouch(location);\n        this.isTouching = false;\n        console.log(\"touchEndCallBack\");\n         this.motionStreak.reset();\n    },\n    touchMoveCallBack:function (location) {\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins\n        || location.y<216 )){\n            this.motionStreak.reset();\n            return;\n        }\n        this.updateTouch(location);\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n    },\n\n    onClickTreasure:function(event){\n        var maxlinenum= this.maxLineNum();\n        var totoalRowNum= this.totoalRowNum(0);\n        if(maxlinenum != 0  || totoalRowNum != 0){\n            this.touchEndPoint = event.getLocation();\n\n            this.updateTouch(this.touchEndPoint);\n            return;\n        }\n        this.btnbox.node.active = false;\n        this.playBoxSpine();\n    },\n    eventcallback: function(type, id) {\n        // let node= this.itemList.indexOf(sender);\n        switch (type){\n            case 0:\n                break;\n            case 1:\n                // let info = ToolConfig[id];\n                // let animation = info.animation;\n                // // BoxController.changeHammerSpine(animation);\n                // SkeletonDataCenter.addSkeletonData(animation, BoxController.changeHammerSpine);\n                this.toolChange(id);\n                break;\n            case 2:\n                break;\n        }\n    },\n    toolChange:function(id) {\n        let info = ToolConfig[id];\n        let animation = info.animation;\n        // BoxController.changeHammerSpine(animation);\n        SkeletonDataCenter.addSkeletonData(animation,this.changeHammerSpine.bind(this) );\n    },\n    update:function(){\n        this.cameraCentPosY();\n    }\n});"]}