{"version":3,"sources":["../../../../../assets/src/controller/assets/src/controller/BoxController.js"],"names":["StageConfig","require","BlockConfig","CycleConfig","ToolConfig","AttributeConfig","AcceleratorConfig","EfficiencyConfig","BoxConfig","RewardConfig","GameType","GameUtils","GameState","BlockBigFactory","BlockSmallFactory","RewardItemFactory","SpriteFrameCenter","ParticleSystemCenter","SkeletonDataCenter","GameConfig","Global","GameHeight","GameCenterY","BaseGame","cc","Class","extends","Component","properties","gameNode","Node","camera","Camera","BlockBig","Prefab","BlockSmall","MarginsBig","MarginsSmall","RewardItem","UIBottom","Sky","Bgbz","Underground","motionStreak","MotionStreak","boxSpine","sp","Skeleton","btnbox","Button","GameMenu","treasure","upgradView","openbox","type","visible","default","rowNum","blockWidth","blockBlank","moveNum","margins","curMaxLine","canTouch","previousPt","Hatting","HattingPos","accelerHammer","accelerGold","efficeGold","gameState","init","onLoad","winsize","winSize","BaseHeight","height","BaseWidth","width","hammerStart","hammerEnd","preLoadAtlas","initdata","bind","GameMenuController","find","getComponent","initInfo","blocks","marginlist","hammers","rewardItem","startPos","setCompleteListener","animationName1","trackEntry","animation","name","log","trackIndex","addItems","firstOpen","playBoxSpine","node","active","setAnimation","stopBoxSpine","playHammerSpine","hammerpos","playHammers","i","undefined","setSmPosition","stopHammerSpine","addHammer","id","hammer","addComponent","info","conf","attribute","addSkeletonData","addChild","animationName","checkCanHammer","smCallback","timescale","att","parseFloat","time","timeScale","changeHammerSpine","data","skeletonData","start","initEfficienyInfo","nodehammer","j","conf1","restart","hard","destroy","hatting","floorNum","layer","length","blockwidth","size","count","blank","addBlocks","cameraStartPosY","initTreasure","addUIBottom","resetMarginList","isValid","resetBlockList","lineinfo","addLines","getPngName","cycleID","push","topline","top","pngname","thisNum","factory","curX","curY","lineArray","left","createMargins","position","p","right","endpos","create","thisID","indexOf","cycleArry","split","getnum","randomInt","parseInt","neednumber","destroyBlock","line","row","location","texiao","getEffByBlock","console","addParticleForNode","removeFromParent","destroyUpdate","cameraCentPosY","checkCanDestroy","myinfo","exp","gold","updateDate","saveExp","saveGold","maxLineNum","max","totoalRowNum","maxline","move","oldY","getPositionY","newY","moveY","action1","moveTo","runAction","ralmovelength","action2","x","y","posbottom","totoal","skyposy","bzYbottom","other","setPositionY","realwidth","maxrow","range","geScreenRange","canclick","curline","num","getPngId","cameraPosY","min","maxPosY","canshowy","Math","floor","cameraY","gameY","realx","realy","hamX","hamY","updateTouch","point","touchStartCallBack","end","reset","touchCancelCallBack","location1","convertToNodeSpace","isTouching","touchEndCallBack","touchMoveCallBack","setPositionX","multMoveCallBack","location01","location02","distance","pSub","origin","onClickTreasure","event","maxlinenum","touchEndPoint","getLocation","update","eventcallback","string","accleleratorChange","accleleratorrRecover","toolChange","efficiencyAdd","changeHammerSpeed","updateButtom","speedHammer","speedGold","speed","coin","changeGoldSpeed","bool","checkCanAdd","saveHammer","addAdTime","mess","costtype","cost","gem","next","confArry","unlock","openAdTimes","needlvl","level","inviteFriends","addFriendCallBack","friendId","freindsInfo","self","isFBInstantGame","FBP","RewardedVideoAsync","FBP1","chooseAsync","friendID","oldFriend","boxID","box","rewardID","reward","itemdata","random","z","str","rewardarry","createRewardItem","golds","gems","saveGem","BoxID","BoxConf","normalSprite","getFrameFromAtlas","icon","pressedSprite","hoverSprite","disabledSprite","addSkeletonDataWait","action","callFunc","setFinish","sequence","efficiencyChange","addgold","timestamp","Date","parse","efficiency","jumptime","attr","btnType","skipID","saveEfficiency","nowtime","paseTime","timestart","useTime","timeleft","outlineTime","offlinetime","addeff","onClickBtnaddGem","onClickBtnaddGold","onClickBtnsubGem","onClickBtnsubGold","onClickBtnaddExp"],"mappings":"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","file":"BoxController.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/**\n * Created by bing on 20/04/2018.\n */\n\n//负责head展现和变换。\nlet StageConfig = require(\"StageConfig\");\nlet BlockConfig = require(\"BoxConfig1\");\nlet CycleConfig = require(\"CycleConfig\");\nlet ToolConfig = require(\"ToolConfig\");\nlet AttributeConfig = require(\"AttributeConfig\");\nlet AcceleratorConfig = require(\"AcceleratorConfig\");\nlet EfficiencyConfig = require(\"EfficiencyConfig\");\nlet BoxConfig = require(\"BoxConfig\");\nlet RewardConfig = require(\"RewardConfig\");\n\n\nlet GameType = require(\"GameType\");\nlet GameUtils = require(\"GameUtils\");\nlet GameState = require(\"GameState\");\nlet BlockBigFactory = require(\"BlockBigFactory\");\nlet BlockSmallFactory = require(\"BlockSmallFactory\");\nlet RewardItemFactory = require(\"RewardItemFactory\");\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\nlet SkeletonDataCenter = require(\"SkeletonDataCenter\");\nlet GameConfig = require(\"GameConfig\");\n// let GameMenuController = require('GameMenuController');\n\nlet Global = require('Global');\n\nconst GameHeight = 514;\nconst GameCenterY = 0;\nconst BaseGame = GameHeight/2;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        gameNode: cc.Node,\n        camera: cc.Camera,\n        BlockBig: cc.Prefab,\n        BlockSmall: cc.Prefab,\n        MarginsBig: cc.Prefab,\n        MarginsSmall: cc.Prefab,\n        RewardItem: cc.Prefab,\n        UIBottom: cc.Prefab,\n        Sky: cc.Node,\n        Bgbz: cc.Node,\n        Underground: cc.Node,\n        motionStreak: cc.MotionStreak,\n        // hammer: sp.Skeleton,\n        boxSpine: sp.Skeleton,\n        btnbox: cc.Button,\n        GameMenu: cc.Node,\n        treasure: cc.Button,\n        upgradView: cc.Node,\n        openbox: cc.Node,\n        // GameMenuController: GameMenuController,\n        type: {\n            visible: false,\n            default: 0\n        },\n        rowNum: {\n            visible: false,\n            default: 5\n        },\n        blockWidth: 100,\n        blockBlank: {\n            visible: false,\n            default: 0\n        },\n        moveNum: {\n            visible: false,\n            default: 0\n        },\n        margins: {\n            visible: false,\n            default: 0\n        },\n        curMaxLine: {\n            visible: false,\n            default: 0\n        },\n        canTouch: {\n            visible: false,\n            default: true\n        },\n        previousPt: {\n            visible: false,\n            default: null\n        },\n        Hatting: {\n            visible: false,\n            default: false\n        },\n        HattingPos: {\n            visible: false,\n            default: null\n        },\n        accelerHammer: {\n            visible: false,\n            default: 1\n        },\n        accelerGold: {\n            visible: false,\n            default: 1\n        },\n        efficeGold: 0,\n        gameState: GameState.init,//0 init 1 playing 2 rolling 3 end\n    },\n\n\n    onLoad: function () {\n        this.winsize = cc.winSize;\n        this.BaseHeight = this.winsize.height / 2;\n        this.BaseWidth = this.winsize.width / 2;\n        this.hammerStart = 1;//表示锤子的起始id\n        this.hammerEnd = 10;//表示锤子的最后一个id\n\n\n\n        SpriteFrameCenter.preLoadAtlas(\"png/box\", this.initdata.bind(this));\n        this.GameMenuController = cc.find(\"Canvas/GameMenu\").getComponent(\"GameMenuController\");\n        Global.initInfo();\n        this.blocks = [];\n        this.marginlist = [];\n        this.hammers = {};\n        this.rewardItem = [];\n        this.accelerHammer = 1;\n        this.accelerGold = 1;\n        this.startPos = -GameHeight / 2;\n        this.boxSpine.setCompleteListener(trackEntry => {\n            var animationName1 = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName1);\n            // this.restart();\n            this.addItems();\n\n        });\n        this.firstOpen = true;\n    },\n    playBoxSpine: function () {\n        this.boxSpine.node.active = true;\n        this.boxSpine.setAnimation(0, \"newAnimation\", false);\n    },\n    stopBoxSpine: function () {\n        this.boxSpine.node.active = false;\n    },\n    playHammerSpine: function (hammerpos) {\n\n        this.hammers[hammerpos].node.active = true;\n        this.hammers[hammerpos].setAnimation(0, \"newAnimation\", true);\n    },\n    playHammers: function () {\n        for (var i = this.hammerStart; i <= this.hammerEnd; i++) {\n            if (this.hammers[i] != undefined) {\n                this.setSmPosition(i);\n            }\n        }\n    },\n    stopHammerSpine: function (hammerpos) {\n        this.hammers[hammerpos].node.active = false;\n    },\n    addHammer: function (id) {\n        let node = new cc.Node();\n        let hammer = node.addComponent(sp.Skeleton);\n        let info = ToolConfig[id];\n        let animation = info.animation;\n        let conf = AttributeConfig[info.attribute];\n\n        SkeletonDataCenter.addSkeletonData(animation, hammer);\n        this.GameMenu.addChild(node);\n        this.hammers[id] = hammer;\n        hammer.node.active = false;\n        hammer.setCompleteListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"HammerSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n            hammer.node.active = false;\n            if (this.checkCanHammer(id)) {\n                this.smCallback(id);\n            }\n        });\n        let timescale = 0.17 * conf.att / parseFloat(conf.time) * this.accelerHammer;\n        hammer.timeScale = timescale;\n    },\n    changeHammerSpine: function (data) {\n        this.hammer.skeletonData = data;\n    },\n    start: function () {\n        this.GameMenuController.initInfo();\n        this.hammers = {};\n        let timescale = 1;\n        let hammer = Global.hammer;\n        this.initEfficienyInfo();\n        for (var i = this.hammerStart; i <= this.hammerEnd; i++) {\n            if (hammer[i] == undefined)\n                continue;\n            let node = new cc.Node();\n            let nodehammer = node.addComponent(sp.Skeleton);\n            let info = ToolConfig[i];\n            let animation = info.animation;\n            SkeletonDataCenter.addSkeletonData(animation, nodehammer);\n            this.GameMenu.addChild(node);\n            this.hammers[hammer[i].id] = nodehammer;\n            nodehammer.node.active = false;\n            let j=i;\n            nodehammer.setCompleteListener(trackEntry => {\n                var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n                cc.log(\"HammerSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n                nodehammer.node.active = false;\n                if (this.checkCanHammer(j)) {\n                    this.smCallback(j);\n                }\n            });\n            let attribute = Global.hammer[i].attribute;\n            let conf1 = AttributeConfig[attribute];\n            nodehammer.timeScale = 0.17 * conf1.att / parseFloat(conf1.time) * this.accelerHammer;\n        }\n\n    },\n    restart: function () {\n        if (Global.hard < 10) {\n            Global.hard++;\n        }\n        this.boxSpine.node.active = false;\n        for (let i = 1; i < 4; i++) {\n            // let node = this.rewardItem[i];\n            this.rewardItem[i].destroy();\n            // if(cc.isValid( node)){\n            //     node.destroy();\n            // }\n        }\n        this.rewardItem = [];\n        // this.addItems();\n        this.initdata();\n        this.gameState = GameState.hatting;\n\n    },\n    initdata: function () {\n        let floorNum = StageConfig[Global.hard].layer;\n        for (var i = 0; i < BlockConfig.length; i++) {\n            if (BlockConfig[i].blockwidth == StageConfig[Global.hard].size) {\n                this.type = BlockConfig[i].type;\n                break;\n            }\n        }\n        this.rowNum = BlockConfig[this.type].count;\n        this.blockWidth = BlockConfig[this.type].blockwidth;\n        this.blockBlank = BlockConfig[this.type].blank;\n        this.margins = BlockConfig[this.type].margins;\n\n        this.addBlocks();\n        this.cameraStartPosY();\n        this.btnbox.node.active = true;\n        this.playHammers();\n        this.initTreasure();\n        if (this.firstOpen) {\n            this.GameMenuController.addUIBottom();\n            this.firstOpen = false;\n        }\n\n    },\n    checkCanHammer: function (id) {\n        var hammer = Global.hammer;\n        if (hammer[id] != undefined && hammer[id].attribute != -1)\n            return true;\n        return false;\n    },\n    resetMarginList: function () {\n        if (this.marginlist.length > 0) {\n            for (let i = 0; i < this.marginlist.length; i++) {\n                let node = this.marginlist[i];\n                if (cc.isValid(node)) {\n                    node.destroy();\n                }\n            }\n        }\n        this.marginlist = [];\n    },\n    resetBlockList: function () {\n        if (this.blocks.length > 0) {\n            for (let i = 0; i < this.blocks.length; i++) {\n                for (let j = 0; j < this.blocks[i].length; j++) {\n                    let node = this.blocks[i][j];\n                    if (cc.isValid(node)) {\n                        node.destroy();\n                    }\n                }\n            }\n        }\n        this.blocks = [];\n    },\n    //--------- block -----------------------\n    addBlocks: function () {\n\n        this.resetBlockList();\n        this.resetMarginList();\n        let floorNum = StageConfig[Global.hard].layer;\n        for (var i = 0; i < floorNum - 1; i++) {\n\n            var lineinfo = this.addLines(this.getPngName(StageConfig[Global.hard].cycleID, i), i);\n\n            this.blocks.push(lineinfo);\n            lineinfo = [];\n        }\n        let topline = this.addLines(StageConfig[Global.hard].top, i);\n        this.blocks.push(topline);\n    },\n    addLines: function (pngname, thisNum) {\n\n        let conf = BlockConfig[this.type];\n        let count = conf.count;\n        let factory = this.type == 0 ? BlockBigFactory : BlockSmallFactory;\n        let curX = conf.margins + conf.blank - this.BaseWidth;\n        let curY = thisNum * (this.blockWidth + conf.blank) + this.startPos;\n        let lineArray = [];\n        let left = factory.createMargins(pngname);\n\n        left.position = cc.p(conf.margins / 2 - this.BaseWidth, curY + this.blockWidth / 2);\n        this.gameNode.addChild(left);\n        this.marginlist.push(left);\n        let right = factory.createMargins(pngname);\n        let endpos = this.BaseWidth - conf.margins / 2;\n        right.position = cc.p(endpos, curY + this.blockWidth / 2);\n        this.gameNode.addChild(right);\n        this.marginlist.push(right);\n\n        for (var i = 0; i < count; i++) {\n            let node = factory.create(pngname);\n            node.position = cc.p(curX + this.blockWidth / 2, curY + this.blockWidth / 2);\n            curX += this.blockWidth + conf.blank;\n            this.gameNode.addChild(node);\n            lineArray.push(node);\n        }\n\n        return lineArray;\n    },\n\n    //根据 获得 图片的名字\n    getPngName(cycleID, thisNum) {\n        let thisID;\n        if (cycleID.indexOf(\";\") != -1) {\n            let cycleArry = cycleID.split(\";\");\n            let getnum = GameUtils.randomInt(0, cycleArry.length - 1);\n            thisID = cycleArry[getnum];\n        } else {\n            thisID = parseInt(cycleID);\n        }\n        let neednumber = 0;\n        for (var i = 1; i <= 10; i++) {\n            if (CycleConfig[thisID][\"num\" + i] == 0) {\n                i = 0;\n                continue;\n            }\n            neednumber += CycleConfig[thisID][\"num\" + i];\n            if (neednumber >= thisNum) {\n                return CycleConfig[thisID][\"block\" + i]\n            }\n            if (i == 10) {\n                i = 0;\n            }\n        }\n    },\n    //销毁砖块\n    destroyBlock: function (line, row) {\n\n        if (!this.blocks[line])\n            return;\n        let node = this.blocks[line][row];\n\n        if (node != null) {\n            let location = this.hammerpos(line, row);\n            let texiao = this.getEffByBlock(line, row);\n             console.log(\"destroylog:\", line, \":\", row, location);\n            ParticleSystemCenter.addParticleForNode(texiao + \".plist\", this.GameMenuController.node, location);\n            node.removeFromParent(true);\n            this.blocks[line][row] = null;\n            this.destroyUpdate();\n            this.cameraCentPosY();\n        }\n\n    },\n    checkCanDestroy: function (line, row) {\n        if (!this.blocks[line] || !this.blocks[line][row])\n            return false;\n        let floorNum = StageConfig[Global.hard].layer;\n        if (line >= floorNum - 1)\n            return true;\n        let node;\n        node = this.blocks[line + 1][row];\n        if (!cc.isValid(node)) {\n            return true;\n        }\n        if (line > 0) {\n            node = this.blocks[line - 1][row];\n            if (!cc.isValid(node)) {\n                return true;\n            }\n        }\n        if (row > 0 && row < this.rowNum - 1) {\n            node = this.blocks[line][row - 1];\n            if (!cc.isValid(node)) {\n                return true;\n            }\n            node = this.blocks[line][row + 1];\n            if (!cc.isValid(node)) {\n                return true;\n            }\n        } else if (row == 0) {\n            node = this.blocks[line][row + 1];\n            if (!cc.isValid(node)) {\n                return true;\n            }\n        } else if (row == this.rowNum - 1) {\n            node = this.blocks[line][row - 1];\n            if (!cc.isValid(node)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    destroyUpdate: function () {\n\n        let myinfo = {};\n        myinfo.exp = Global.exp + 1;\n        myinfo.gold = Global.gold + 1 * (this.accelerGold) + this.efficeGold;\n        this.GameMenuController.updateDate(myinfo);\n        Global.saveExp(myinfo.exp);\n        Global.saveGold(myinfo.gold);\n    },\n    //--------- block -----------------------\n    maxLineNum: function () {\n        var max = 0;\n        let floorNum = StageConfig[Global.hard].layer;\n        for (var i = 0; i < floorNum; i++) {\n            for (var j = 0; j < this.rowNum; j++) {\n                if (this.blocks && this.blocks[i] && this.blocks[i][j]) {\n                    var node = this.blocks[i][j];\n                    if (!cc.isValid(node))\n                        continue;\n                    // sss\n                    if (i > max) {\n                        max = i;\n                    }\n                    break;\n                }\n            }\n        }\n        return max;\n    },\n\n    totoalRowNum: function (line) {//line 行拥有点的数量\n        var max = 0;\n        for (var j = 0; j < this.rowNum; j++) {\n            var node = this.blocks[line][j];\n            if (!cc.isValid(node))\n                continue;\n            max++;\n        }\n        return max;\n    },\n\n    //************camera 相关设置 start **********************\n    cameraCentPosY: function () {\n\n        let maxline = this.maxLineNum();\n        if (this.curMaxLine <= maxline) {\n            return;\n        }\n        let move = this.curMaxLine - maxline;\n        this.curMaxLine = maxline;\n        let oldY = this.camera.node.getPositionY();\n        if (oldY <= 0) {\n            return;\n        }\n        let newY = oldY - this.blockWidth * move;\n        let moveY = 0;\n        if (newY >= 0) {\n            moveY = newY;\n        } else {\n            moveY = 0;\n        }\n        let location = cc.p(0, moveY);\n        let action1 = cc.moveTo(0.1, location);\n        this.camera.node.runAction(action1);\n        let ralmovelength = oldY - newY;\n        for (var i = this.hammerStart; i < this.hammerEnd; i++) {\n            if(this.hammers[i] != undefined){\n                let location=this.hammers[i].node.position;\n                let action2 = cc.moveTo(0.1,{x:location.x,y:location.y+ralmovelength})\n                this.hammers[i].node.runAction(action2);\n            }\n        }\n        // this.camera.node.setPositionY(moveY);\n\n\n    },\n\n    cameraStartPosY: function () {\n        let floorNum = StageConfig[Global.hard].layer;\n        let height = floorNum * (this.blockWidth + this.blockBlank);\n        //地下\n        this.Underground.height = height;\n        let posbottom = (height - GameHeight) / 2;\n        this.Underground.y = posbottom;\n        //地面\n        let totoal = this.Bgbz.height + height - 50;\n        let skyposy;\n        let bzYbottom;\n        let other = GameHeight - totoal;\n        bzYbottom = (totoal + height - GameHeight) / 2 - 25;\n        this.Bgbz.y = bzYbottom;\n        if (other > 0) {\n            this.Sky.active = true;\n            this.Sky.height = other + 10;\n            skyposy = (GameHeight - other) / 2;\n            this.Sky.y = skyposy;\n            this.camera.node.setPositionY(0);\n        } else {\n            this.Sky.active = false;\n            this.camera.node.setPositionY(-other);\n\n        }\n        this.curMaxLine = floorNum - 1;\n    },\n\n\n    //************camera 相关设置 end **********************\n    //*********** 锤子 相关设置  start***************\n    setSmPosition: function (hammerpos) {\n        let realwidth = this.blockWidth + this.blockBlank;\n        let maxline = this.curMaxLine;\n        let maxrow = this.totoalRowNum(0);\n        if (maxline == 0 && maxrow == 0) {\n            this.HattingPos = null;\n            // this.sm.node.visible = false;\n            this.hammers[hammerpos].node.active = false;\n            return;\n        }\n        let range = this.geScreenRange();\n        let line = this.curMaxLine;\n        let find = false;\n        let canclick = [];\n        let curline = line;\n        for (; curline >= 0; curline--) {\n            for (var i = 0; i < this.rowNum; i++) {//当前行可以删除的\n                if (this.blocks[curline] && this.checkCanDestroy(curline, i)) {\n                    let find = false;\n                    for (var j = this.hammerStart; j <= this.hammerEnd; j++) {\n                        if (this.HattingPos && this.HattingPos[j]) {\n                            if (this.HattingPos[j].x == curline && i == this.HattingPos[j].y) {\n                                find = true;\n                                break;\n                            }\n                        }\n                    }\n                    if (!find) {\n                        canclick.push(i);\n                    }\n                }\n            }\n            if (canclick.length > 0)\n                break;\n        }\n        if (canclick.length == 0) {\n            this.HattingPos[hammerpos] = null;\n            return;\n        }\n        let num = GameUtils.randomInt(0, canclick.length - 1);\n        let row = canclick[num];\n        let location = this.hammerpos(curline, row);\n        if (this.HattingPos == null) {\n            this.HattingPos = {};\n        }\n        this.HattingPos[hammerpos] = {x: curline, y: row};\n        console.log(\"choose:\",this.HattingPos[hammerpos]);\n        this.hammers[hammerpos].node.position = location;\n        this.hammers[hammerpos].node.active = true;\n        this.playHammerSpine(hammerpos);\n    },\n    //根据小块的位置 过的特效文件\n    getEffByBlock(line, row) {\n\n        let type = this.type == 0 ? \"BlockBig\" : \"BlockSmall\";\n        let node = this.blocks[line][row].getComponent(type);\n        return node.getPngId();\n    },\n    geScreenRange: function () {\n        let max = this.curMaxLine;\n        let cameraPosY = this.camera.node.getPositionY();\n        let min = 0;\n        let realwidth = this.blockWidth + this.blockBlank;\n        if (cameraPosY <= this.BaseHeight) {\n            min = 0;\n        } else {\n            let maxPosY = max * realwidth;\n            let canshowy = (maxPosY - cameraPosY + this.BaseHeight) / realwidth;\n            min = Math.floor(max - canshowy);\n        }\n        return {max: max, min: min};\n    },\n    //根据块的位置计算锤子的位置\n    hammerpos: function (line, row) {\n        let cameraY = this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth = this.blockWidth + this.blockBlank;\n        let realx = row * realwidth + this.margins + this.blockBlank;\n        let realy = line * realwidth - cameraY ;\n        let hamX = realx - this.BaseWidth - 42 + this.blockWidth;\n        let hamY = realy - 42;\n        return cc.p(hamX, hamY);\n\n    },\n    smCallback: function (hammerpos) {\n        if (this.HattingPos != null && this.HattingPos[hammerpos] != null) {\n\n            let y = this.HattingPos[hammerpos].y;\n            let x = this.HattingPos[hammerpos].x;\n            console.log(\"hammer:\",x,y);\n            if (cc.isValid(this.blocks[x][y])) {\n                this.destroyBlock(x, y);\n            }\n            this.setSmPosition(hammerpos);\n\n        }\n    },\n    //*********** 锤子 相关设置  end*****************\n\n    updateTouch: function (point) {\n        let cameraY = this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth = this.blockWidth + this.blockBlank;\n        var line = Math.floor((point.y + cameraY) / realwidth);\n        var row = Math.floor((point.x - this.margins - this.blockBlank) / realwidth);\n        let find = false;\n        if (this.checkCanDestroy(line, row)) {\n            for (var i = this.hammerStart; i <= this.hammerEnd; i++) {\n                if (this.HattingPos != null && this.HattingPos[i] != null && this.HattingPos[i] != undefined) {\n                    if (this.HattingPos[i].x == line && this.HattingPos[i].y == row) {\n                        this.hammers[i].node.active = false;\n                        // this.smCallback(i);\n\n                        this.destroyBlock(line, row);\n                        this.setSmPosition(i);\n                        find = true;\n                        break;\n                    }\n                }\n            }\n            if (!find) {\n                this.destroyBlock(line, row);\n            }\n        }\n    },\n    touchStartCallBack: function (location) {\n        if (!this.canTouch) {\n            return;\n        }\n        if (this.gameState == GameState.end) {\n            this.openbox.active = false;\n            this.restart();\n        }\n        if (location.x < this.margins || location.x > (2 * this.BaseWidth - this.margins)) {\n            // this.motionStreak.reset();\n            return;\n        }\n        console.log(\"touchStartCallBack\");\n        // this.previousPt = location;\n        // let motionpos = this.motionStreak.node.convertToNodeSpace(location);\n        // this.motionStreak.node.setPositionX(motionpos);\n        // this.motionStreak.node.setPositionY(motionpos);\n         this.motionStreak.reset();\n\n        // this.isTouching = false;\n    },\n\n    touchCancelCallBack: function (location1) {\n        let location= this.gameNode.convertToNodeSpace(location1);\n        this.updateTouch(location);\n        this.isTouching = false;\n         this.motionStreak.reset();\n    },\n\n    touchEndCallBack: function (location1) {\n        // this.touchPosition(location);\n        let location= this.gameNode.convertToNodeSpace(location1);\n        this.updateTouch(location);\n        this.isTouching = false;\n        console.log(\"touchEndCallBack\");\n        this.motionStreak.reset();\n        this.previousPt=null;\n    },\n    touchMoveCallBack: function (location1) {\n        // this.multMoveCallBack(location1);\n        // return;\n        let location= this.gameNode.convertToNodeSpace(location1);\n        if (!this.canTouch) {\n            return;\n        }\n        if (location.x < this.margins || location.x > (2 * this.BaseWidth - this.margins\n            || location.y < 216)) {\n            this.motionStreak.reset();\n            return;\n        }\n        this.updateTouch(location);\n        // this.previousPt = location;\n        this.motionStreak.node.setPositionX(location1.x - this.BaseWidth);\n        this.motionStreak.node.setPositionY(location1.y - this.BaseHeight);\n        // let motionpos = this.node.convertToNodeSpace(location1);\n        // this.motionStreak.node.position=motionpos;\n    },\n    //多点触控\n    multMoveCallBack:function(location01,location02 = null){\n\n        let location1 = this.gameNode.convertToNodeSpace(location01);\n        // let location2 = this.gameNode.convertToNodeSpace(location02);\n        console.log(\"1\",location1);\n        // console.log(\"2\",location2);\n        if(this.previousPt == null){\n            this.previousPt={};\n            this.previousPt[0]= location1;\n            // this.previousPt[1]= location2;\n            return;\n        }\n        var distance = cc.pSub( this.previousPt[0],location1);\n        console.log(\"distance\",distance);\n        if(distance.y != 0){\n            let origin = this.camera.node.getPositionY();\n            // if(origin == 0) {\n            //     return;\n            // }\n            let endpos =( origin+distance.y)*0.5;\n            if(endpos <0 ){\n                endpos =0;\n            }\n            if(endpos >300){\n                endpos = 300;\n            }\n            let move = origin - endpos;\n            this.camera.node.setPositionY(endpos);\n            for (var i = this.hammerStart; i < this.hammerEnd; i++) {\n                if(this.hammers[i] != undefined){\n                    let location=this.hammers[i].node.position;\n                    // let action2 = cc.moveTo(0.1,{x:location.x,y:location.y+move})\n                     // this.hammers[i].node.runAction(action2);\n                    this.hammers[i].node.setPositionY(location.y+move);\n                }\n            }\n        }\n\n\n\n\n\n    },\n    onClickTreasure: function (event) {\n        var maxlinenum = this.maxLineNum();\n        var totoalRowNum = this.totoalRowNum(0);\n        if (maxlinenum != 0 || totoalRowNum != 0) {\n            this.touchEndPoint = event.getLocation();\n\n            this.updateTouch(this.touchEndPoint);\n            return;\n        }\n        this.btnbox.node.active = false;\n        this.gameState = GameState.end;\n        this.canTouch = false;\n        this.openbox.active= true;\n        this.playBoxSpine();\n    },\n    update: function () {\n        // this.cameraCentPosY();\n    },\n    eventcallback: function (type, id, string = null) {\n        // let node= this.itemList.indexOf(sender);\n        switch (type) {\n            case 0:\n                if (string == null)\n                    this.accleleratorChange(id);\n                else {\n                    if (string == 'finish') {\n                        this.accleleratorrRecover(id);\n                    }\n                }\n                break;\n            case 1:\n                this.toolChange(id);\n                break;\n            case 2:\n                this.efficiencyAdd(id,string);\n                break;\n        }\n    },\n    //广告加速开始\n    accleleratorChange: function (id) {\n        let conf = AcceleratorConfig[id];\n        Global['bar' + id] = conf.time;\n        this.changeHammerSpeed();\n        this.GameMenuController.updateButtom();\n\n    },\n    //广告加速结束\n    accleleratorrRecover: function (id) {\n        this.changeHammerSpeed();\n        this.GameMenuController.updateButtom();\n    },\n\n    changeHammerSpeed: function () {\n        let speedHammer = 0;\n        let speedGold = 0;\n        for (let i = 1; i <= 2; i++) {\n            if (Global['bar' + i] > 0) {\n                speedHammer += AcceleratorConfig[i].speed;\n                speedGold += AcceleratorConfig[i].coin;\n            }\n        }\n        if (speedHammer == 0) {\n            speedHammer = 1;\n        }\n        if (speedGold == 0) {\n            speedGold = 1;\n        }\n        this.accelerHammer = speedHammer;\n        this.accelerGold = speedGold;\n        for (var i = this.hammerStart; i <= this.hammerEnd; i++) {\n            if (this.hammers[i] != undefined) {\n                let conf1 = AttributeConfig[Global.hammer[i].attribute];\n                this.hammers[i].timeScale = 0.17 * (conf1.att / parseFloat(conf1.time)) * this.accelerHammer;\n            }\n        }\n    },\n    changeGoldSpeed: function () {\n\n    },\n    toolChange: function (id) {\n        let info = ToolConfig[id];\n\n        if (Global.hammer[id] == undefined) {//激活\n            let bool = this.checkCanAdd(id);\n            if (bool) {\n                Global.hammer[id] = {id: id, attribute: info.attribute};\n                Global.saveHammer(Global.hammer);\n                this.addHammer(id);\n                this.setSmPosition(id);\n            } else {\n                this.addAdTime(id);\n            }\n            this.GameMenuController.updateButtom();\n\n        } else {//升级\n            let conf = AttributeConfig[Global.hammer[id].attribute];\n            let mess = {};\n\n            if (conf.costtype = 1001) {\n                Global.gold -= conf.cost;\n                mess['gold'] = Global.gold;\n            } else if (conf.costtype = 1002) {\n                Global.gem -= conf.cost;\n                mess['gem'] = Global.gem;\n            }\n            if (conf.next != -1) {\n                Global.hammer[id].attribute = conf.next;\n                let conf1 = AttributeConfig[conf.next];\n                Global.saveHammer(Global.hammer);\n                this.hammers[id].timeScale = 0.17 * (conf1.att / parseFloat(conf1.time)) * this.accelerHammer;\n            }\n            this.GameMenuController.updateDate(mess);\n        }\n    },\n    checkCanAdd: function (id) {\n        let conf = ToolConfig[id];\n        let thisID;\n        let confArry;\n        if (\"unlock\" in conf) {\n            if (conf.unlock.indexOf(\";\") != -1) {\n                confArry = conf.unlock.split(\";\");\n                thisID = confArry[0];\n            } else {\n                thisID = parseInt(conf.unlock);\n            }\n            if (thisID == -1) {\n                return true;\n            }\n            if (thisID == 0) {//点击激活\n                return true;\n            } else if (thisID == 1) {//视频激励\n                return Global.openAdTimes > 0;\n            } else if (thisID == 2) {//等级激活\n                let needlvl = confArry[1];\n                if (Global.level < needlvl) {\n                    return false;\n                } else {\n                    return true;\n                }\n\n            } else if (thisID == 3) {//邀请好友\n                // if(Global.freindsInfo[id]&&Global.freindsInfo[id].length){\n                //     Global.inviteFriends = Global.freindsInfo[id].length;\n                // }else{\n                //     Global.inviteFriends=0;\n                // }\n                if(Global.inviteFriends<confArry[1]){\n                    return false;\n                }else{\n                    return true;\n                }\n            }\n        }\n        return false;\n    },\n    addFriendCallBack:function(friendId){\n        if(Global.freindsInfo== null){\n            Global.freindsInfo = {};\n        }\n\n    },\n    addAdTime: function (id) {\n        let conf = ToolConfig[id];\n        let thisID;\n        let confArry;\n        let self = this;\n        if (\"unlock\" in conf) {\n            if (conf.unlock.indexOf(\";\") != -1) {\n                confArry = conf.unlock.split(\";\");\n                thisID = confArry[0];\n            } else {\n                thisID = parseInt(conf.unlock);\n            }\n            if (thisID == 1) {//视频激励\n                if(GameConfig.isFBInstantGame()){\n                    let FBP = require(\"FBPlugin\");\n                    FBP.RewardedVideoAsync(function(){\n                            Global.openAdTimes++;\n                            self.GameMenuController.updateButtom();\n                        }\n                    );\n                }else{\n                    Global.openAdTimes++;\n                }\n            } else if (thisID == 3) {//邀请好友\n                let FBP1 = require(\"FBPlugin\");\n                let self = this;\n                if(GameConfig.isFBInstantGame()){\n                    FBP1.chooseAsync(function(friendID){\n                        if(Global.freindsInfo== null){\n                            Global.freindsInfo = {};\n                        }\n                        if( Global.freindsInfo[id] == null){\n                            Global.freindsInfo[id] =[];\n                        }\n                        var find = false;\n                        for(var i = 0;i<Global.freindsInfo[id].length;i++){\n                            let oldFriend = Global.freindsInfo[id];\n                            if(oldFriend ==friendID ){\n                                find= true;\n                                break;\n                            }\n                        }\n                        if(!find){\n                            Global.freindsInfo[id].push(friendID);\n                            Global.inviteFriends = Global.freindsInfo[id].length;\n                        }\n                        self.GameMenuController.updateButtom();\n                    });\n                }else{\n                    Global.inviteFriends++;\n                }\n            }\n        }\n    },\n    addItems: function () {\n\n        let hard = Global.hard;\n        let boxID = StageConfig[hard].box;\n        let rewardID = BoxConfig[boxID].reward;\n        let conf = RewardConfig[rewardID];\n        let num = conf.num;\n        let itemdata = {};\n        let totoal = 0;\n        let reward = {};\n        let max = 0;\n        for (let i = 1; i < 7; i++) {\n            if (conf['rate' + i] != 0) {\n                totoal = conf['rate' + i];\n                if (i == 1) {\n                    itemdata[i] = totoal;\n                    max = itemdata[i];\n                } else {\n                    itemdata[i] = itemdata[i - 1] + totoal;\n                    max = itemdata[i];\n                }\n            }\n        }\n        for (let j = 1; j <= num; j++) {\n            let random = GameUtils.random(max);\n            for (let z = 1; itemdata[z] != undefined; z++) {\n                if (itemdata[z] < random) {\n                    continue;\n                }\n                reward[j] = conf['item' + z];\n                break;\n            }\n        }\n        let gold = 0;\n        let gem = 0;\n        let str = \"\";\n        for (let i = 1; i <= num; i++) {\n            if (reward[i] != undefined) {\n                str += reward[i] + \"--\";\n                if (reward[i].indexOf(\";\") != -1) {\n                    let rewardarry = reward[i].split(\";\");\n                    if (rewardarry[0] == 1001) {\n                        gold += parseInt(rewardarry[1]);\n                    } else if (rewardarry[0] == 1002) {\n                        gem += parseInt(rewardarry[1]);\n                    }\n                }\n            }\n            this.createRewardItem(reward[i], i);\n            this.openbox.active = true;\n        }\n        if (gold > 0 || gem > 0) {\n            let golds = Global.gold + gold;\n            let gems = Global.gem + gem;\n            this.GameMenuController.updateDate({gold: golds, gem: gems});\n            Global.saveGold(golds);\n            Global.saveGem(gems);\n        }\n\n    },\n    initTreasure: function () {\n        let BoxID = StageConfig[Global.hard].box;\n        let BoxConf = BoxConfig[BoxID];\n        this.treasure.normalSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\", BoxConf.icon + \".png\");\n        this.treasure.pressedSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\", BoxConf.icon + \".png\");\n        this.treasure.hoverSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\", BoxConf.icon + \".png\");\n        this.treasure.disabledSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\", BoxConf.icon + \".png\");\n        let animation = BoxConf.animation;\n        SkeletonDataCenter.addSkeletonDataWait(animation, this.boxSpine);\n        this.treasure.node.y = -GameHeight / 2 + this.blockWidth + 35 - 20;\n        this.boxSpine.node.y = -GameHeight / 2 + this.blockWidth + 35 - 20;\n\n    },\n    createRewardItem: function (reward, i) {\n        if (this.rewardItem[i]) {\n            this.rewardItem[i].destroy();\n            this.rewardItem[i] = null;\n        }\n        let start = -400 + i * 200;\n\n        let node = RewardItemFactory.create(reward);\n        let location = this.treasure.node.position;\n        this.rewardItem[i] = (node);\n        node.position = location;\n        let action = cc.moveTo(0.5, cc.p(start, 10));\n        let action2 = cc.callFunc(() => {\n            node.getComponent(\"RewardItem\").setFinish();\n            this.canTouch = true;\n        }, this);\n        // node.runAction(cc. moveTo(0.5,cc.p(start,-20)));\n        this.openbox.addChild(node);\n        node.runAction(cc.sequence(action, action2));\n    },\n    efficiencyAdd: function (id,str = null) {\n        if(str != null){\n            this.efficiencyChange();\n            return;\n        }\n        let conf = EfficiencyConfig[id];\n        let gem = 0;\n        let addgold=0;\n        if (conf.costtype == 1002 && Global.gem >= conf.cost) {//enough gem\n            gem = Global.gem - conf.cost;\n            if (conf.coin > 0) {\n                // this.efficeGold += conf.coin - 1;\n                let timestamp = Date.parse( new Date())/1000;// 以秒为单位\n                Global.efficiency[id] = {'id':id,'timeleft':conf.time,'timestart':timestamp};\n                this.efficiencyChange();\n            }\n            let myinfo = {};\n            if (conf.jumptime > 0) {//jump time\n\n                for(let i=this.hammerStart;i<=this.hammerEnd; i++){\n                    if(Global.hammer[i] != undefined){\n                        let attr = AttributeConfig[Global.hammer[i].attribute];\n                        addgold+=conf.jumptime*60*60/attr.time* attr.att;\n                    }\n                }\n                Global.addgold = addgold;\n                Global.btnType = 'skip';\n                Global.skipID = id;\n                this.upgradView.active= true;\n            }\n        }\n        this.GameMenuController.updateDate({'gem': gem});\n        Global.saveGem(gem);\n        Global.saveEfficiency(Global.efficiency);\n        this.GameMenuController.updateButtom();\n    },\n    //进入游戏计算离线时间 并计算收益\n    initEfficienyInfo:function(){\n        let nowtime= Date.parse( new Date())/1000;// 以秒为单位;\n        let addgold = 0;\n        for (let id in Global.efficiency) {\n            if ( Global.efficiency[id] == null){\n                continue;\n            }\n            let paseTime = (nowtime - Global.efficiency[id].timestart)/60;//以min\n            let conf = EfficiencyConfig[id];\n            let useTime = conf.time - Global.efficiency[id].timeleft;\n            if(paseTime > conf.time) {\n                paseTime = conf.time;\n            }\n            let outlineTime= paseTime - useTime;\n            let timeleft = conf.time - outlineTime - useTime;\n            if(timeleft <=0){\n                Global.efficiency[id] = null;\n            }else{\n                Global.efficiency[id].timeleft = parseInt(timeleft);\n                this.efficeGold += conf.coin - 1;\n            }\n            for(let i=this.hammerStart;i<=this.hammerEnd; i++){\n                if(Global.hammer[i] != undefined){\n                    let attr = AttributeConfig[Global.hammer[i].attribute];\n                    addgold+=conf.coin*outlineTime*60* attr.att/attr.time;\n                }\n            }\n            if(Global.offlinetime<outlineTime){\n                Global.offlinetime = outlineTime;\n            }\n        }\n        Global.saveEfficiency(Global.efficiency);\n        addgold  = parseInt(addgold);\n        if(addgold >0) {\n            Global.addgold = parseInt(addgold);\n            Global.btnType = 'outline';\n            this.upgradView.active = true;\n        }\n    },\n    //收益加速开始/结束\n    efficiencyChange: function () {\n        let addeff=0;\n\n        for( let id in Global.efficiency){\n            if(Global.efficiency[id] == null)\n                continue;\n            let conf = EfficiencyConfig[id];\n            addeff+=conf.coin - 1;\n        }\n        this.efficeGold = addeff;\n        this.GameMenuController.updateButtom();\n    },\n    onClickBtnaddGem() {\n\n        let gem = Global.gem + 100;\n        this.GameMenuController.updateDate({'gem': gem});\n        Global.saveGem(gem);\n        this.GameMenuController.updateButtom();\n    },\n    onClickBtnaddGold() {\n\n        let gold = Global.gold + 10;\n        this.GameMenuController.updateDate({'gold': gold});\n        Global.saveGold(gold);\n        this.GameMenuController.updateButtom();\n    },\n    onClickBtnsubGem() {\n\n        let gem = Global.gem - 10 > 0 ? Global.gem - 10 : 0;\n        this.GameMenuController.updateDate({'gem': gem});\n        Global.saveGem(gem);\n        this.GameMenuController.updateButtom();\n    },\n    onClickBtnsubGold() {\n\n        let gold = Global.gold - 10 > 0 ? Global.gold - 10 : 0;\n        this.GameMenuController.updateDate({'gold': gold});\n        Global.saveGold(gold);\n        this.GameMenuController.updateButtom();\n    },\n    onClickBtnaddExp() {\n\n        let exp = Global.exp +1000;\n        this.GameMenuController.updateDate({'exp': exp});\n        Global.saveExp(exp);\n        // this.GameMenuController.updateButtom();\n    }\n\n});\n//"]}