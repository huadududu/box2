{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\src\\utils/assets\\src\\utils\\state-machine.js"],"names":["StateMachine","VERSION","Result","SUCCEEDED","NOTRANSITION","CANCELLED","PENDING","Error","INVALID_TRANSITION","PENDING_TRANSITION","INVALID_CALLBACK","WILDCARD","ASYNC","create","cfg","target","initial","state","terminal","fsm","events","callbacks","map","transitions","add","e","from","Array","isArray","name","n","length","push","to","event","hasOwnProperty","buildEvent","current","is","indexOf","can","transition","undefined","cannot","concat","isFinished","error","args","msg","states","Object","keys","sort","defer","doCallback","func","apply","beforeAnyEvent","afterAnyEvent","leaveAnyState","enterAnyState","changeState","beforeThisEvent","afterThisEvent","leaveThisState","enterThisState","beforeEvent","afterEvent","leaveState","specific","general","enterState","prototype","slice","call","arguments","cancel","leave","exports","module","define","amd","require","window","self"],"mappings":"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","file":"state-machine.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\src\\utils","sourcesContent":["/*\r\n\r\n  Javascript State Machine Library - https://github.com/jakesgordon/javascript-state-machine\r\n\r\n  Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors\r\n  Released under the MIT license - https://github.com/jakesgordon/javascript-state-machine/blob/master/LICENSE\r\n\r\n*/\r\n\r\n(function () {\r\n\r\n  var StateMachine = {\r\n\r\n    //---------------------------------------------------------------------------\r\n\r\n    VERSION: \"2.4.0\",\r\n\r\n    //---------------------------------------------------------------------------\r\n\r\n    Result: {\r\n      SUCCEEDED:    1, // the event transitioned successfully from one state to another\r\n      NOTRANSITION: 2, // the event was successfull but no state transition was necessary\r\n      CANCELLED:    3, // the event was cancelled by the caller in a beforeEvent callback\r\n      PENDING:      4  // the event is asynchronous and the caller is in control of when the transition occurs\r\n    },\r\n\r\n    Error: {\r\n      INVALID_TRANSITION: 100, // caller tried to fire an event that was innapropriate in the current state\r\n      PENDING_TRANSITION: 200, // caller tried to fire an event while an async transition was still pending\r\n      INVALID_CALLBACK:   300 // caller provided callback function threw an exception\r\n    },\r\n\r\n    WILDCARD: '*',\r\n    ASYNC: 'async',\r\n\r\n    //---------------------------------------------------------------------------\r\n\r\n    create: function(cfg, target) {\r\n\r\n      var initial      = (typeof cfg.initial == 'string') ? { state: cfg.initial } : cfg.initial; // allow for a simple string, or an object with { state: 'foo', event: 'setup', defer: true|false }\r\n      var terminal     = cfg.terminal || cfg['final'];\r\n      var fsm          = target || cfg.target  || {};\r\n      var events       = cfg.events || [];\r\n      var callbacks    = cfg.callbacks || {};\r\n      var map          = {}; // track state transitions allowed for an event { event: { from: [ to ] } }\r\n      var transitions  = {}; // track events allowed from a state            { state: [ event ] }\r\n\r\n      var add = function(e) {\r\n        var from = Array.isArray(e.from) ? e.from : (e.from ? [e.from] : [StateMachine.WILDCARD]); // allow 'wildcard' transition if 'from' is not specified\r\n        map[e.name] = map[e.name] || {};\r\n        for (var n = 0 ; n < from.length ; n++) {\r\n          transitions[from[n]] = transitions[from[n]] || [];\r\n          transitions[from[n]].push(e.name);\r\n\r\n          map[e.name][from[n]] = e.to || from[n]; // allow no-op transition if 'to' is not specified\r\n        }\r\n        if (e.to)\r\n          transitions[e.to] = transitions[e.to] || [];\r\n      };\r\n\r\n      if (initial) {\r\n        initial.event = initial.event || 'startup';\r\n        add({ name: initial.event, from: 'none', to: initial.state });\r\n      }\r\n\r\n      for(var n = 0 ; n < events.length ; n++)\r\n        add(events[n]);\r\n\r\n      for(var name in map) {\r\n        if (map.hasOwnProperty(name))\r\n          fsm[name] = StateMachine.buildEvent(name, map[name]);\r\n      }\r\n\r\n      for(var name in callbacks) {\r\n        if (callbacks.hasOwnProperty(name))\r\n          fsm[name] = callbacks[name]\r\n      }\r\n\r\n      fsm.current     = 'none';\r\n      fsm.is          = function(state) { return Array.isArray(state) ? (state.indexOf(this.current) >= 0) : (this.current === state); };\r\n      fsm.can         = function(event) { return !this.transition && (map[event] !== undefined) && (map[event].hasOwnProperty(this.current) || map[event].hasOwnProperty(StateMachine.WILDCARD)); }\r\n      fsm.cannot      = function(event) { return !this.can(event); };\r\n      fsm.transitions = function()      { return (transitions[this.current] || []).concat(transitions[StateMachine.WILDCARD] || []); };\r\n      fsm.isFinished  = function()      { return this.is(terminal); };\r\n      fsm.error       = cfg.error || function(name, from, to, args, error, msg, e) { throw e || msg; }; // default behavior when something unexpected happens is to throw an exception, but caller can override this behavior if desired (see github issue #3 and #17)\r\n      fsm.states      = function() { return Object.keys(transitions).sort() };\r\n\r\n      if (initial && !initial.defer)\r\n        fsm[initial.event]();\r\n\r\n      return fsm;\r\n\r\n    },\r\n\r\n    //===========================================================================\r\n\r\n    doCallback: function(fsm, func, name, from, to, args) {\r\n      if (func) {\r\n        try {\r\n          return func.apply(fsm, [name, from, to].concat(args));\r\n        }\r\n        catch(e) {\r\n          return fsm.error(name, from, to, args, StateMachine.Error.INVALID_CALLBACK, \"an exception occurred in a caller-provided callback function\", e);\r\n        }\r\n      }\r\n    },\r\n\r\n    beforeAnyEvent:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onbeforeevent'],                       name, from, to, args); },\r\n    afterAnyEvent:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onafterevent'] || fsm['onevent'],      name, from, to, args); },\r\n    leaveAnyState:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onleavestate'],                        name, from, to, args); },\r\n    enterAnyState:   function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onenterstate'] || fsm['onstate'],      name, from, to, args); },\r\n    changeState:     function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onchangestate'],                       name, from, to, args); },\r\n\r\n    beforeThisEvent: function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onbefore' + name],                     name, from, to, args); },\r\n    afterThisEvent:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onafter'  + name] || fsm['on' + name], name, from, to, args); },\r\n    leaveThisState:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onleave'  + from],                     name, from, to, args); },\r\n    enterThisState:  function(fsm, name, from, to, args) { return StateMachine.doCallback(fsm, fsm['onenter'  + to]   || fsm['on' + to],   name, from, to, args); },\r\n\r\n    beforeEvent: function(fsm, name, from, to, args) {\r\n      if ((false === StateMachine.beforeThisEvent(fsm, name, from, to, args)) ||\r\n          (false === StateMachine.beforeAnyEvent( fsm, name, from, to, args)))\r\n        return false;\r\n    },\r\n\r\n    afterEvent: function(fsm, name, from, to, args) {\r\n      StateMachine.afterThisEvent(fsm, name, from, to, args);\r\n      StateMachine.afterAnyEvent( fsm, name, from, to, args);\r\n    },\r\n\r\n    leaveState: function(fsm, name, from, to, args) {\r\n      var specific = StateMachine.leaveThisState(fsm, name, from, to, args),\r\n          general  = StateMachine.leaveAnyState( fsm, name, from, to, args);\r\n      if ((false === specific) || (false === general))\r\n        return false;\r\n      else if ((StateMachine.ASYNC === specific) || (StateMachine.ASYNC === general))\r\n        return StateMachine.ASYNC;\r\n    },\r\n\r\n    enterState: function(fsm, name, from, to, args) {\r\n      StateMachine.enterThisState(fsm, name, from, to, args);\r\n      StateMachine.enterAnyState( fsm, name, from, to, args);\r\n    },\r\n\r\n    //===========================================================================\r\n\r\n    buildEvent: function(name, map) {\r\n      return function() {\r\n\r\n        var from  = this.current;\r\n        var to    = map[from] || (map[StateMachine.WILDCARD] != StateMachine.WILDCARD ? map[StateMachine.WILDCARD] : from) || from;\r\n        var args  = Array.prototype.slice.call(arguments); // turn arguments into pure array\r\n\r\n        if (this.transition)\r\n          return this.error(name, from, to, args, StateMachine.Error.PENDING_TRANSITION, \"event \" + name + \" inappropriate because previous transition did not complete\");\r\n\r\n        if (this.cannot(name))\r\n          return this.error(name, from, to, args, StateMachine.Error.INVALID_TRANSITION, \"event \" + name + \" inappropriate in current state \" + this.current);\r\n\r\n        if (false === StateMachine.beforeEvent(this, name, from, to, args))\r\n          return StateMachine.Result.CANCELLED;\r\n\r\n        if (from === to) {\r\n          StateMachine.afterEvent(this, name, from, to, args);\r\n          return StateMachine.Result.NOTRANSITION;\r\n        }\r\n\r\n        // prepare a transition method for use EITHER lower down, or by caller if they want an async transition (indicated by an ASYNC return value from leaveState)\r\n        var fsm = this;\r\n        this.transition = function() {\r\n          fsm.transition = null; // this method should only ever be called once\r\n          fsm.current = to;\r\n          StateMachine.enterState( fsm, name, from, to, args);\r\n          StateMachine.changeState(fsm, name, from, to, args);\r\n          StateMachine.afterEvent( fsm, name, from, to, args);\r\n          return StateMachine.Result.SUCCEEDED;\r\n        };\r\n        this.transition.cancel = function() { // provide a way for caller to cancel async transition if desired (issue #22)\r\n          fsm.transition = null;\r\n          StateMachine.afterEvent(fsm, name, from, to, args);\r\n        }\r\n\r\n        var leave = StateMachine.leaveState(this, name, from, to, args);\r\n        if (false === leave) {\r\n          this.transition = null;\r\n          return StateMachine.Result.CANCELLED;\r\n        }\r\n        else if (StateMachine.ASYNC === leave) {\r\n          return StateMachine.Result.PENDING;\r\n        }\r\n        else {\r\n          if (this.transition) // need to check in case user manually called transition() but forgot to return StateMachine.ASYNC\r\n            return this.transition();\r\n        }\r\n\r\n      };\r\n    }\r\n\r\n  }; // StateMachine\r\n\r\n  //===========================================================================\r\n\r\n  //======\r\n  // NODE\r\n  //======\r\n  if (typeof exports !== 'undefined') {\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n      exports = module.exports = StateMachine;\r\n    }\r\n    exports.StateMachine = StateMachine;\r\n  }\r\n  //============\r\n  // AMD/REQUIRE\r\n  //============\r\n  else if (typeof define === 'function' && define.amd) {\r\n    define(function(require) { return StateMachine; });\r\n  }\r\n  //========\r\n  // BROWSER\r\n  //========\r\n  else if (typeof window !== 'undefined') {\r\n    window.StateMachine = StateMachine;\r\n  }\r\n  //===========\r\n  // WEB WORKER\r\n  //===========\r\n  else if (typeof self !== 'undefined') {\r\n    self.StateMachine = StateMachine;\r\n  }\r\n\r\n}());\r\n"]}