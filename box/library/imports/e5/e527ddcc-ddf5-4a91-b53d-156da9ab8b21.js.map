{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\src\\controller/assets\\src\\controller\\InitialScript.js"],"names":["require","GameConfig","BingLog","Global","GameUtils","SpriteFrameCenter","cc","Class","extends","Component","properties","progress","Label","onLoad","log","printBaseInfo","director","getScene","name","randoms","index","randomInt","initHistory","syncInviteFriends","tankid","toString","DataCenter","requestFriends","requestWorld","getPlayerLeaderboard","start","preloadFiles","push","type","files","i","length","self","preloadCount","loadedCount","loadRes","inited","preloadFile","loader","err","result","warn","message","updateProgress","loadResDir","errs","assets","string","toFixed","goMenu","preLoadAtlas","loadScene","update","dt","sys","platform","isNative","os","osVersion","browserType","uaResult","language","windowPixelResolution","jsb","fileUtils","getWritablePath"],"mappings":"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","file":"InitialScript.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\src\\controller","sourcesContent":["//class InitialScript\r\nrequire('JSExtends');\r\nvar GameConfig = require(\"GameConfig\");\r\nlet BingLog = require(\"BingLog\");\r\nlet Global  = require(\"Global\");\r\nlet GameUtils = require(\"GameUtils\");\r\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties:{\r\n        progress:cc.Label,\r\n    },\r\n\r\n    onLoad: function () {\r\n\r\n        cc.log(\"InitialScript onLoad \");\r\n\r\n\r\n        // cc.sys.localStorage.clear();\r\n        this.printBaseInfo();\r\n        BingLog.log(\"Init Script----------\\n\\n\");\r\n        BingLog.log(\"InitialScript sc name: \", cc.director.getScene().name);\r\n\r\n        let randoms = [1,3,6,9];\r\n        let index = GameUtils.randomInt(0,3);\r\n        Global.initHistory();\r\n        Global.syncInviteFriends();\r\n        Global.tankid  = randoms[index].toString();\r\n\r\n        // request data\r\n        let DataCenter = require(\"DataCenter\");\r\n        DataCenter.requestFriends(null);\r\n        DataCenter.requestWorld(null);\r\n        DataCenter.getPlayerLeaderboard(null);\r\n\r\n    },\r\n\r\n    start: function () {\r\n\r\n        cc.log(\"InitialScript start \");\r\n        BingLog.log(\"scene name:\", cc.director.getScene().name);\r\n\r\n        //add all resource here.\r\n        let preloadFiles = [];\r\n        // preloadFiles.push({ name:\"prefab/HintController\",type:\"file\"});\r\n        preloadFiles.push({ name:\"fonts\",type:\"dir\"});\r\n        preloadFiles.push({ name:\"particle\",type:\"dir\"});\r\n        preloadFiles.push({ name:\"png/share\",type:\"dir\"});\r\n        // preloadFiles.push({ name:\"prefab\",type:\"dir\"});\r\n\r\n\r\n        let files = [\"prefab/bar\",\r\n            \"prefab/block\",\r\n            \"prefab/bullet\",\r\n            \"prefab/item\",\r\n            \"prefab/rankitem\",\r\n            \"prefab/rankitemInvite\",\r\n            \"prefab/rankitemEmpty\",\r\n            \"prefab/rankUI\",\r\n            \"prefab/inviteUI\",\r\n            \"prefab/msg\",\r\n            \"prefab/popwin\",\r\n            \"prefab/popmsg\",\r\n            \"prefab/tank\",\r\n            \"prefab/tankhead\",\r\n            \"png/game\",\r\n            \"png/tanks\"\r\n        ];\r\n\r\n        for(let i = 0; i <files.length;++i ){\r\n            preloadFiles.push({ name:files[i],type:\"file\"});\r\n        }\r\n\r\n\r\n        let self = this;\r\n        this.preloadCount = preloadFiles.length;\r\n        this.loadedCount = 0;\r\n        BingLog.log(\"preload:\",this.loadedCount,this.preloadCount);\r\n        this.loadRes = false;\r\n        this.inited = false;\r\n\r\n        for (let i = 0; i < preloadFiles.length; ++i) {\r\n            let preloadFile  = preloadFiles[i];\r\n            BingLog.log(\"will load file:\",preloadFile.name);\r\n            if(preloadFile.type === \"file\"){\r\n                cc.loader.loadRes(preloadFile.name, function (err, result) {\r\n                    if(err){\r\n                        BingLog.warn(\"load file err:\",err.message);\r\n                    }\r\n                    self.loadedCount++;\r\n                    BingLog.log(\"loading:\",self.loadedCount,self.loadedCount*100.0/self.preloadCount);\r\n\r\n                    // let base = self.node.getComponent(Welcome).Stage1Percent;\r\n                    // BingLog.log(\"percent:\",base+self.loadedCount* (100-base)/self.preloadCount);\r\n                    // self.node.getComponent(Welcome).updateUIProgress(base+self.loadedCount* (100-base)/self.preloadCount,0.5);\r\n                    if(self.loadedCount == self.preloadCount){\r\n                        self.loadRes = true;\r\n                    }\r\n                    self.updateProgress();\r\n                });\r\n            }else if(preloadFile.type === \"dir\"){\r\n                //Music\r\n                cc.loader.loadResDir(preloadFile.name, function (errs, assets) {\r\n                    if(errs){\r\n                        BingLog.warn(\"load file err:\",errs.message);\r\n                    }\r\n                    self.loadedCount++;\r\n                    BingLog.log(\"assets:\",assets);\r\n                    BingLog.log(\"loading:\",self.loadedCount,self.loadedCount*100.0/self.preloadCount);\r\n                    // let base = self.node.getComponent(Welcome).Stage1Percent;\r\n                    // BingLog.log(\"percent:\",base+self.loadedCount* (100-base)/self.preloadCount);\r\n                    // self.node.getComponent(Welcome).updateUIProgress(base+self.loadedCount* (100-base)/self.preloadCount,0.5);\r\n                    if(self.loadedCount == self.preloadCount){\r\n                        self.loadRes = true;\r\n                    }\r\n                    self.updateProgress();\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    updateProgress:function () {\r\n\r\n        let progress = this.loadedCount*100.0/this.preloadCount;\r\n        if(progress >100)\r\n        {\r\n            progress = 100;\r\n        }\r\n        this.progress.string = progress.toFixed(0).toString() + \"%\";\r\n\r\n    },\r\n\r\n    goMenu:function () {\r\n\r\n        SpriteFrameCenter.preLoadAtlas(\"png/game\",function () {\r\n            SpriteFrameCenter.preLoadAtlas(\"png/tanks\",function () {\r\n                cc.director.loadScene(\"gamemenu\");\r\n            });\r\n        });\r\n\r\n        // cc.director.loadScene(\"gametest\");\r\n\r\n        // cc.director.loadScene(\"test\");\r\n    },\r\n\r\n    update:function (dt) {\r\n        if(this.loadRes&& !this.inited){\r\n            this.loadRes = false;\r\n            this.inited = true;\r\n            this.goMenu();\r\n        }\r\n    },\r\n\r\n    printBaseInfo: function () {\r\n\r\n        BingLog.log(\"********   info   ********\");\r\n        BingLog.log(\"platform: \", cc.sys.platform);\r\n        BingLog.log(\"isNative: \", cc.sys.isNative);\r\n        BingLog.log(\"os: \", cc.sys.os);\r\n        BingLog.log(\"osVersion: \", cc.sys.osVersion);\r\n        BingLog.log(\"browserType: \", cc.sys.browserType);\r\n        BingLog.log(\"UA: \", cc.sys.uaResult);\r\n        BingLog.log(\"language: \", cc.sys.language);\r\n        BingLog.log(\"windowPixelResolution: \", cc.sys.windowPixelResolution);\r\n        if (cc.sys.isNative) {\r\n            BingLog.log(\"windowPixelResolution: \", jsb.fileUtils.getWritablePath());\r\n        }\r\n        BingLog.log(\"******** end info ********\");\r\n\r\n        // cc.sys.localStorage.setItem(\"TotalSpinsHourBonus\", 1001);\r\n        // MurkaCore.Instance.BaseGameConfig.GameInited = \"1234\";\r\n    }\r\n});\r\n"]}