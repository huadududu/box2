{"version":3,"sources":["../../../../../assets/src/controller/assets/src/controller/DataCenter.js"],"names":["module","exports","FBP","require","GameConfig","dc","cc","Class","extends","Object","properties","ctor","friends","world","playerInfo","getGamePlayers","ret","push","sort","a","b","score","friendsCallBack","callback","data","arguments","length","worldCallBack","playerCallBack","getPlayerLeaderboard","isFBInstantGame","LeaderBoardName","bind","requestWorld","getWorldLeaderboard","requestFriends","getFriendLeaderboard","instance"],"mappings":";;;;;;;;AAAA;;;AAGAA,OAAOC,OAAP,GAAiB,YAAY;;AAEzB,QAAIC,MAAMC,QAAQ,UAAR,CAAV;AACA,QAAIC,aAAaD,QAAQ,YAAR,CAAjB;;AAEA,QAAIE,KAAKC,GAAGC,KAAH,CAAS;;AAEdC,iBAAQF,GAAGG,MAFG;AAGdC,oBAAW,EAHG;;AAQdC,cAAK,gBAAY;;AAEb,iBAAKC,OAAL,GAAe,EAAf;AACA,iBAAKC,KAAL,GAAa,EAAb;AACA,iBAAKC,UAAL,GAAkB,IAAlB;AACH,SAba;;AAed;AACAC,wBAAe,0BAAY;AACvB,gBAAIC,MAAM,EAAV;AACA,gBAAG,KAAKF,UAAR,EAAmB;AACfE,oBAAIC,IAAJ,CAAS,KAAKH,UAAd;AACH;;AAEDE,gBAAIC,IAAJ,+BAAY,KAAKL,OAAjB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACAI,gBAAIE,IAAJ,CAAS,UAASC,CAAT,EAAYC,CAAZ,EAAe;AACpB,uBAAQA,EAAEC,KAAF,GAAUF,EAAEE,KAApB;AACH,aAFD;;AAMA,mBAAOL,GAAP;AACH,SA5Ca;;AA8CdM,yBAAgB,yBAAUC,QAAV,EAAmBC,IAAnB,EAAyB;;AAErC,gBAAGC,UAAUC,MAAV,IAAoB,CAAvB,EAAyB;AAAA;;AACrB,iCAAKd,OAAL,EAAaK,IAAb,oCAAqBO,IAArB;AACA,oBAAGD,QAAH,EAAY;AACRA,6BAASC,IAAT;AACH;AACJ,aALD,MAKK;AAAA;;AACD,kCAAKZ,OAAL,EAAaK,IAAb,qCAAqBM,QAArB;AACH;AACJ,SAxDa;;AA0DdI,uBAAc,uBAAUJ,QAAV,EAAmBC,IAAnB,EAAyB;;AAEnC,gBAAGC,UAAUC,MAAV,IAAoB,CAAvB,EAAyB;AAAA;;AACrB,+BAAKb,KAAL,EAAWI,IAAX,kCAAmBO,IAAnB;AACA,oBAAGD,QAAH,EAAY;AACRA,6BAASC,IAAT;AACH;AACJ,aALD,MAKK;AAAA;;AACD,gCAAKX,KAAL,EAAWI,IAAX,mCAAmBM,QAAnB;AACH;AACJ,SApEa;;AAuEdK,wBAAe,wBAAUL,QAAV,EAAmBC,IAAnB,EAAyB;;AAEpC,gBAAGC,UAAUC,MAAV,IAAoB,CAAvB,EAAyB;AACrB,qBAAKZ,UAAL,GAAkBU,IAAlB;AACA,oBAAGD,QAAH,EAAY;AACRA,6BAASC,IAAT;AACH;AACJ,aALD,MAKK;AACD,qBAAKV,UAAL,GAAkBS,QAAlB;AACH;AACJ,SAjFa;;AAmFdM,8BAAqB,8BAAUN,QAAV,EAAoB;AACzC,gBAAGnB,WAAW0B,eAAX,EAAH,EAAgC;AAC5B,oBAAG,CAAC,KAAKhB,UAAT,EAAqB;AACjBZ,wBAAI2B,oBAAJ,CAAyBzB,WAAW2B,eAApC,EAAoD,KAAKH,cAAL,CAAoBI,IAApB,CAAyB,IAAzB,EAA8BT,QAA9B,CAApD;AACH,iBAFD,MAEK;AACD,wBAAGA,QAAH,EAAY;AACRA,iCAAS,KAAKT,UAAd;AACH;AACJ;AACJ;AACJ,SA7FiB;;AA+FdmB,sBAAa,sBAAUV,QAAV,EAAoB;AAC7B,gBAAGnB,WAAW0B,eAAX,EAAH,EAAgC;AAC5B,oBAAG,KAAKjB,KAAL,CAAWa,MAAX,IAAqB,CAAxB,EAA2B;AACvBxB,wBAAIgC,mBAAJ,CAAwB9B,WAAW2B,eAAnC,EAAmD,KAAKJ,aAAL,CAAmBK,IAAnB,CAAwB,IAAxB,EAA6BT,QAA7B,CAAnD;AACH,iBAFD,MAEK;AACD,wBAAGA,QAAH,EAAY;AACRA,iCAAS,KAAKV,KAAd;AACH;AACJ;AACJ;AACJ,SAzGa;;AA2GdsB,wBAAe,wBAAUZ,QAAV,EAAoB;AAC/B,gBAAGnB,WAAW0B,eAAX,EAAH,EAAgC;AAC5B,oBAAG,KAAKlB,OAAL,CAAac,MAAb,IAAuB,CAA1B,EAA4B;AACxBxB,wBAAIkC,oBAAJ,CAAyBhC,WAAW2B,eAApC,EAAoD,KAAKT,eAAL,CAAqBU,IAArB,CAA0B,IAA1B,EAA+BT,QAA/B,CAApD;AACH,iBAFD,MAEK;AACD,wBAAGA,QAAH,EAAY;AACRA,iCAAS,KAAKX,OAAd;AACH;AACJ;AACJ;AACJ;;AArHa,KAAT,CAAT;;AA0HA,QAAIyB,WAAY,IAAIhC,EAAJ,EAAhB;AACA,WAAOgC,QAAP;AACH,CAjIgB,EAAjB","file":"DataCenter.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/**\n * Created by bing on 31/05/2018.\n */\nmodule.exports = function () {\n\n    let FBP = require(\"FBPlugin\");\n    let GameConfig = require(\"GameConfig\");\n\n    let dc = cc.Class({\n\n        extends:cc.Object,\n        properties:{\n\n\n        },\n\n        ctor:function () {\n\n            this.friends = [];\n            this.world = [];\n            this.playerInfo = null;\n        },\n\n        //获取游戏中需要对比的玩家列表。\n        getGamePlayers:function () {\n            let ret = [];\n            if(this.playerInfo){\n                ret.push(this.playerInfo);\n            }\n\n            ret.push(...this.friends);\n\n            //test\n            // for (let i = 0; i < 10; ++i) { // spawn items, we only need to do this once\n            //     let data = {\n            //         rank: i + 1,\n            //         name: \"world \"+i.toString(),\n            //         score: i*4+10,\n            //         photo: \"https://lookaside.facebook.com/platform/profilepic/?psid=2063223640372248&height=50&width=50&ext=1528008224&hash=AeRL1ntBbxis94hX\"\n            //     };\n            //\n            //     ret.push(data);\n            // }\n\n            //根据score进行排序\n            ret.sort(function(a, b) {\n                return  b.score - a.score;\n            });\n\n\n\n            return ret;\n        },\n        \n        friendsCallBack:function (callback,data) {\n\n            if(arguments.length == 2){\n                this.friends.push(...data);\n                if(callback){\n                    callback(data);\n                }\n            }else{\n                this.friends.push(...callback);\n            }\n        },\n\n        worldCallBack:function (callback,data) {\n\n            if(arguments.length == 2){\n                this.world.push(...data);\n                if(callback){\n                    callback(data);\n                }\n            }else{\n                this.world.push(...callback);\n            }\n        },\n\n\n        playerCallBack:function (callback,data) {\n\n            if(arguments.length == 2){\n                this.playerInfo = data;\n                if(callback){\n                    callback(data);\n                }\n            }else{\n                this.playerInfo = callback;\n            }\n        },\n\n        getPlayerLeaderboard:function (callback) {\n        if(GameConfig.isFBInstantGame()){\n            if(!this.playerInfo) {\n                FBP.getPlayerLeaderboard(GameConfig.LeaderBoardName,this.playerCallBack.bind(this,callback));\n            }else{\n                if(callback){\n                    callback(this.playerInfo);\n                }\n            }\n        }\n    },\n\n        requestWorld:function (callback) {\n            if(GameConfig.isFBInstantGame()){\n                if(this.world.length == 0) {\n                    FBP.getWorldLeaderboard(GameConfig.LeaderBoardName,this.worldCallBack.bind(this,callback));\n                }else{\n                    if(callback){\n                        callback(this.world);\n                    }\n                }\n            }\n        },\n        \n        requestFriends:function (callback) {\n            if(GameConfig.isFBInstantGame()){\n                if(this.friends.length == 0){\n                    FBP.getFriendLeaderboard(GameConfig.LeaderBoardName,this.friendsCallBack.bind(this,callback));\n                }else{\n                    if(callback){\n                        callback(this.friends);\n                    }\n                }\n            }\n        },\n\n\n    });\n\n    let instance  = new dc();\n    return instance;\n}();"]}