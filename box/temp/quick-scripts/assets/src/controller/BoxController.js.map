{"version":3,"sources":["BoxController.js"],"names":["CameraController","require","StageConfig","BlockConfig","CycleConfig","GameType","GameUtils","BlockBigFactory","BlockSmallFactory","SpriteFrameCenter","ParticleSystemCenter","winsize","cc","winSize","BaseHeight","height","BaseWidth","width","GameHeight","GameCenterY","BaseGame","Class","extends","Component","properties","gameNode","Node","BlockBig","Prefab","camera","Camera","BlockSmall","UIBottom","Sky","Bgbz","Underground","motionStreak","MotionStreak","hammer","sp","Skeleton","boxSpine","GameMenuController","language","visible","default","hard","myinfo","type","floorNum","rowNum","blockWidth","blockBlank","moveNum","margins","curMaxLine","canTouch","previousPt","Hatting","HattingPos","onLoad","preLoadAtlas","initdata","bind","blocks","startPos","setCompleteListener","animationName","trackEntry","animation","name","log","trackIndex","node","active","smCallback","setEndListener","animationName1","restart","playBoxSpine","setAnimation","stopBoxSpine","playHammerSpine","stopHammerSpine","start","sys","localStorage","getItem","level","speed","gold","gem","exp","layer","i","length","blockwidth","size","count","blank","addBlocks","cameraStartPosY","setSmPosition","addUIBottom","initInfo","lineinfo","addLines","getPngName","cycleID","push","topline","top","pngname","thisNum","conf","factory","curX","curY","lineArray","create","position","p","addChild","thisID","indexOf","cycleArry","split","getnum","randomInt","parseInt","neednumber","destroyBlock","line","row","isValid","destroy","checkCanDestroy","maxLineNum","max","j","totoalRowNum","cameraCentPosY","maxline","move","oldY","getPositionY","newY","setPositionY","posbottom","y","totoal","skyposy","bzYbottom","other","realwidth","maxrow","range","geScreenRange","find","canclick","num","location","hammerpos","texiao","getEffByBlock","addParticleForNode","x","getComponent","getPngId","cameraPosY","min","maxPosY","canshowy","Math","floor","cameraY","gameY","realx","realy","hamX","hamY","updateTouch","point","touchStartCallBack","console","setPositionX","reset","touchCancelCallBack","isTouching","touchEndCallBack","touchMoveCallBack","onClickTreasure","event","maxlinenum","touchEndPoint","getLocation","update"],"mappings":"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","file":"BoxController.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/**\n * Created by bing on 20/04/2018.\n */\n\n//负责head展现和变换。\nconst CameraController = require('CameraController');\nlet StageConfig = require(\"StageConfig\");\nlet BlockConfig = require(\"BoxConfig1\");\nlet CycleConfig = require(\"CycleConfig\");\nlet GameType = require(\"GameType\");\nlet GameUtils = require(\"GameUtils\");\nlet BlockBigFactory = require(\"BlockBigFactory\");\nlet BlockSmallFactory = require(\"BlockSmallFactory\");\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\nlet winsize = cc.winSize;\nconst BaseHeight =  winsize.height/2;\nconst BaseWidth =  winsize.width/2;\nconst GameHeight = 514;\nconst GameCenterY = 360;\nconst BaseGame = 257 ;\n\ncc.Class({\n    extends:cc.Component,\n\n    properties:{\n        gameNode:cc.Node,\n        BlockBig:cc.Prefab,\n        camera: cc.Camera,\n        BlockSmall:cc.Prefab,\n        UIBottom:cc.Prefab,\n        Sky:cc.Node,\n        Bgbz:cc.Node,\n        Underground:cc.Node,\n        motionStreak: cc.MotionStreak,\n        hammer: sp.Skeleton,\n        boxSpine:sp.Skeleton,\n        GameMenuController: require('GameMenuController'),\n        language:{\n            visible: false,\n            default:\"English\"\n        },\n        hard:{\n            visible : true,\n            default:5\n        },\n        myinfo:{\n            visible : true,\n            default:null\n        },\n        type:{\n            visible : false,\n            default:0\n        },\n        floorNum:{\n            visible:false,\n            default:5\n        },\n        rowNum:{\n            visible:false,\n            default:5\n        },\n        blockWidth:100,\n        blockBlank:{\n            visible:false,\n            default:0\n        },\n        moveNum:{\n            visible:false,\n            default:0\n        },\n        margins:{\n            visible:false,\n            default:0\n        },\n        curMaxLine:{\n            visible: false,\n            default:0\n        },\n        canTouch:{\n            visible:false,\n            default:true\n        },\n        previousPt:{\n            visible:false,\n            default:null\n        },\n        Hatting:{\n            visible:false,\n            default:false\n        },\n        HattingPos:{\n            visible: false,\n            default:null\n        }\n    },\n\n\n    onLoad:function () {\n        SpriteFrameCenter.preLoadAtlas(\"png/box\",this.initdata.bind(this));\n        this.blocks = [];\n        this.startPos = -GameHeight/2;\n        // this.sm.on('stop',      this.smCallback,        this);\n        this.hammer.setCompleteListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n            this.hammer.node.active = false;\n             this.smCallback();\n        });\n        this.boxSpine.node.active = false;\n        this.boxSpine.setEndListener(trackEntry => {\n            var animationName1 = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName1);\n            this.boxSpine.node.active = false;\n            this.restart();\n        });\n\n    },\n    playBoxSpine:function () {\n        this.boxSpine.node.active = true;\n        this.boxSpine.setAnimation(0, \"newAnimation\", false);\n    },\n\n\n    stopBoxSpine:function () {\n        this.boxSpine.node.active = false;\n    },\n    playHammerSpine:function () {\n        this.hammer.node.active = true;\n        this.hammer.setAnimation(0, \"newAnimation\", false);\n    },\n    stopHammerSpine:function () {\n        this.hammer.node.active = false;\n    },\n\n    start:function(){\n        // this.initdata();\n        this.myinfo = cc.sys.localStorage.getItem('myinfo');\n        if(this.myinfo == null){\n            this.myinfo ={hard:1,level:1,speed:1,gold:1,gem:1,exp:1};\n        }\n        this.hard = this.myinfo.hard;\n\n\n    },\n    restart:function(){\n        this.hard++;\n        this.initdata();\n    },\n    initdata:function(){\n        this.floorNum=StageConfig[this.hard].layer;\n        for (var i = 0;i<BlockConfig.length;i++){\n            if(BlockConfig[i].blockwidth == StageConfig[this.hard].size){\n                this.type = BlockConfig[i].type;\n                break;\n            }\n        }\n        this.rowNum=BlockConfig[this.type].count;\n        this.blockWidth=BlockConfig[this.type].blockwidth;\n        this.blockBlank=BlockConfig[this.type].blank;\n        this.margins=BlockConfig[this.type].margins;\n        this.addBlocks();\n        this.cameraStartPosY();\n        this.setSmPosition();\n        // let callfun  = cc.callFunc(this.setSmPosition);\n        // cc.repeatForever(cc.sequence(callfun, ));\n        // var animstae = this.sm.play();\n        // animstae.repeatCount = 2;\n        this.GameMenuController.addUIBottom();\n        this.GameMenuController.initInfo(this.myinfo);\n        this.playHammerSpine();\n\n\n    },\n    //--------- block -----------------------\n    addBlocks:function() {\n\n        this.blocks=[];\n        for (var i =0;i< this.floorNum-1;i++){\n\n            var lineinfo=this.addLines(this.getPngName(StageConfig[this.hard].cycleID,i),i);\n\n            this.blocks.push(lineinfo);\n            lineinfo=[];\n        }\n        let topline = this.addLines(StageConfig[this.hard].top,i);\n        this.blocks.push(topline);\n    },\n    addLines:function (pngname,thisNum) {\n\n        let conf=BlockConfig[this.type];\n        let count = conf.count;\n        let factory= this.type == 0?BlockBigFactory:BlockSmallFactory;\n        let curX= conf.margins+conf.blank -BaseWidth;\n        let curY= thisNum*(this.blockWidth+conf.blank) + this.startPos;\n        let lineArray=[];\n        for(var i=0;i<count;i++){\n            let node = factory.create(pngname);\n            node.position = cc.p(curX+this.blockWidth/2,curY+this.blockWidth/2);\n            curX+=this.blockWidth+conf.blank;\n            this.gameNode.addChild(node);\n            lineArray.push(node);\n        }\n\n        return lineArray;\n    },\n\n    //根据 获得 图片的名字\n    getPngName(cycleID,thisNum){\n        let thisID;\n        if(cycleID.indexOf(\";\") != -1){\n            let cycleArry = cycleID.split(\";\");\n            let getnum=GameUtils.randomInt(0,cycleArry.length-1);\n            thisID=cycleArry[getnum];\n        }else{\n            thisID=parseInt(cycleID);\n        }\n        let neednumber=0;\n        for(var i =1;i<=10 ;i++)\n        {\n            if(CycleConfig[thisID][\"num\"+i] == 0){\n                i=0;\n                continue;\n            }\n            neednumber+=CycleConfig[thisID][\"num\"+i];\n            if(neednumber>=thisNum){\n                return CycleConfig[thisID][\"block\"+i]\n            }\n            if(i==10){\n                i=0;\n            }\n        }\n    },\n    //销毁砖块\n    destroyBlock:function(line,row ){\n\n        if(!this.blocks[line])\n            return;\n        let node = this.blocks[line][row];\n        if(cc.isValid(node) ) {\n            node.destroy();\n        }\n\n    },\n    checkCanDestroy :function(line,row){\n        if(!cc.isValid(this.blocks[line]) || !cc.isValid(this.blocks[line][row]))\n            return false;\n        if(line >= this.floorNum-1)\n            return true;\n        let node;\n        node = this.blocks[line+1][row];\n        if(!cc.isValid(node)){\n            return true;\n        }\n        if(line>0){\n            node = this.blocks[line-1][row];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }\n        if(row>0 && row <this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if (row == 0){\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if(row == this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    //--------- block -----------------------\n    maxLineNum:function(){\n        var max=0;\n        for(var i=0;i<this.floorNum;i++){\n            for(var j= 0;j<this.rowNum;j++) {\n                if (this.blocks && this.blocks[i] && this.blocks[i][j]) {\n                    var node = this.blocks[i][j];\n                    if (!cc.isValid(node))\n                        continue;\n                    if (i > max) {\n                        max = i;\n                    }\n                    break;\n                }\n            }\n        }\n        return max;\n    },\n\n    totoalRowNum:function(line) {//line 行拥有点的数量\n        var max = 0;\n        for(var j= 0;j<this.rowNum;j++){\n            var node = this.blocks[line][j];\n            if(!cc.isValid(node) )\n                continue;\n            max++;\n        }\n        return max;\n    },\n\n    //************camera 相关设置 start **********************\n    cameraCentPosY:function(){\n\n        let maxline=this.maxLineNum();\n        if(this.curMaxLine<= maxline){\n            return;\n        }\n        let move = this.curMaxLine-maxline;\n        this.curMaxLine=maxline;\n        let oldY = this.camera.node.getPositionY();\n        if(oldY<=GameCenterY){\n            return;\n        }\n        let newY= oldY-this.blockWidth*move;\n        if(newY>=GameCenterY){\n            this.camera.node.setPositionY(newY);\n        }else {\n            this.camera.node.setPositionY(GameCenterY);\n        }\n\n    },\n\n    cameraStartPosY:function(){\n        let height = this.floorNum*(this.blockWidth+this.blockBlank);\n        //地下\n        this.Underground.height=height;\n        let posbottom= (height-GameHeight)/2;\n        this.Underground.y=posbottom;\n        //地面\n        let totoal= this.Bgbz.height+height -50;\n        let skyposy;\n        let bzYbottom;\n        let other = GameHeight- totoal;\n        bzYbottom= (totoal+height - GameHeight)/2 -25;\n        this.Bgbz.y=bzYbottom;\n        if(other>0){\n            this.Sky.active = true;\n            this.Sky.height = other+10;\n            skyposy= (GameHeight - other)/2;\n            this.Sky.y=skyposy;\n            this.camera.node.setPositionY(GameCenterY);\n        }else{\n            this.Sky.active = false;\n            this.camera.node.setPositionY(GameCenterY - other);\n\n        }\n        this.curMaxLine = this.floorNum -1;\n    },\n\n\n    //************camera 相关设置 end **********************\n    //*********** 锤子 相关设置  start***************\n    setSmPosition:function(){\n        let realwidth=this.blockWidth+this.blockBlank;\n        let maxline = this.curMaxLine;\n        let maxrow = this.totoalRowNum(0);\n        if(maxline == 0 && maxrow ==   0)\n        {\n            this.HattingPos =null;\n            // this.sm.node.visible = false;\n            this.hammer.node.active = false;\n            return ;\n        }\n         this.hammer.node.active = true;\n        let range = this.geScreenRange();\n        // let line = GameUtils.randomInt(range.min,range.max);\n         let line = this.curMaxLine;\n        let find = false;\n        let canclick=[];\n        for(var i = 0;i<this.rowNum;i++){\n            if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\n                canclick.push(i);\n\n            }\n        }\n\n       let num = GameUtils.randomInt(0,canclick.length-1);\n        let row= canclick[num];\n\n        let location = this.hammerpos(line,row);\n        let texiao=this.getEffByBlock(line,row);\n        ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.blocks[line][row],{x:0,y:0})\n        this.HattingPos ={x:line,y:row};\n        this.hammer.node.position=location;\n        this.playHammerSpine();\n    },\n    //根据小块的位置 过的特效文件\n    getEffByBlock(line,row){\n\n        let type = this.type == 0? \"BlockBig\":\"BlockSmall\";\n        let node = this.blocks[line][row].getComponent(type);\n        return node.getPngId();\n\n\n    },\n    geScreenRange : function(){\n        let max = this.curMaxLine;\n        let cameraPosY = this.camera.node.getPositionY();\n        let min=0;\n        let realwidth=this.blockWidth+this.blockBlank;\n        if(cameraPosY <= BaseHeight){\n            min =0;\n        }else{\n            let maxPosY= max*realwidth;\n            let canshowy = (maxPosY - cameraPosY+BaseHeight)/realwidth;\n            min = Math.floor(max- canshowy);\n        }\n        return {max:max,min:min};\n    },\n    //根据块的位置计算锤子的位置\n    hammerpos:function(line,row){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        let realx = row * realwidth+this.margins+this.blockBlank;\n        let realy = line * realwidth+gameY -cameraY -BaseGame;\n        let hamX= realx - BaseWidth + 42+this.blockWidth;\n        let hamY = realy - 42;\n        return cc.p(hamX,hamY);\n\n    },\n    smCallback:function(){\n        if(this.HattingPos != null){\n            let y= this.HattingPos.y;\n            let x= this.HattingPos.x;\n            if(cc.isValid(this.blocks[x][y])){\n                this.blocks[x][y].destroy();\n            }\n            this.cameraCentPosY();\n             this.setSmPosition();\n        }\n    },\n    //*********** 锤子 相关设置  end*****************\n\n    updateTouch:function(point){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        var line = Math.floor((point.y-(gameY-cameraY+BaseHeight - BaseGame))/realwidth);\n        var row = Math.floor((point.x-this.margins - this.blockBlank)/realwidth);\n        if(this.checkCanDestroy(line,row)){\n            this.destroyBlock(line,row);\n        }\n    },\n    touchStartCallBack:function (location) {\n        if(!this.canTouch){\n            return;\n        }\n        console.log(\"touchStartCallBack\");\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n        this.motionStreak.reset();\n        // this.isTouching = false;\n    },\n\n    touchCancelCallBack:function (location) {\n        this.updateTouch(location);\n        this.isTouching = false;\n        this.motionStreak.reset();\n    },\n\n    touchEndCallBack:function (location) {\n        // this.touchPosition(location);\n        this.updateTouch(location);\n        this.isTouching = false;\n        console.log(\"touchEndCallBack\");\n         this.motionStreak.reset();\n    },\n    touchMoveCallBack:function (location) {\n        this.updateTouch(location);\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n    },\n\n    onClickTreasure:function(event){\n        var maxlinenum= this.maxLineNum();\n        var totoalRowNum= this.totoalRowNum(0);\n        if(maxlinenum != 0  || totoalRowNum != 0){\n            this.touchEndPoint = event.getLocation();\n\n            this.updateTouch(this.touchEndPoint);\n            return;\n        }\n        this.playBoxSpine();\n    },\n    update:function(){\n        this.cameraCentPosY();\n\n    }\n});"]}