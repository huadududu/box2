{"version":3,"sources":["BoxController.js"],"names":["CameraController","require","StageConfig","BlockConfig","CycleConfig","ToolConfig","AttributeConfig","BoxConfig","RewardConfig","GameType","GameUtils","GameState","BlockBigFactory","BlockSmallFactory","RewardItemFactory","SpriteFrameCenter","ParticleSystemCenter","SkeletonDataCenter","Global","winsize","cc","winSize","BaseHeight","height","BaseWidth","width","GameHeight","GameCenterY","BaseGame","Class","extends","Component","properties","gameNode","Node","camera","Camera","BlockBig","Prefab","BlockSmall","MarginsBig","MarginsSmall","RewardItem","UIBottom","Sky","Bgbz","Underground","motionStreak","MotionStreak","boxSpine","sp","Skeleton","btnbox","Button","GameMenu","treasure","upgradView","language","visible","default","hard","myinfo","type","floorNum","rowNum","blockWidth","blockBlank","moveNum","margins","curMaxLine","canTouch","previousPt","Hatting","HattingPos","gameState","init","onLoad","preLoadAtlas","initdata","bind","GameMenuController","find","getComponent","initInfo","blocks","marginlist","hammers","rewardItem","startPos","setCompleteListener","animationName1","trackEntry","animation","name","log","trackIndex","addItems","firstOpen","playBoxSpine","node","active","setAnimation","stopBoxSpine","playHammerSpine","hammerpos","playHammers","i","undefined","setSmPosition","stopHammerSpine","addHammer","id","hammer","addComponent","info","addSkeletonData","addChild","animationName","checkCanHammer","smCallback","conf","attribute","timescale","att","parseFloat","time","timeScale","changeHammerSpine","data","skeletonData","start","nodehammer","conf1","restart","destroy","hatting","layer","length","blockwidth","size","count","blank","addBlocks","cameraStartPosY","initTreasure","addUIBottom","resetMarginList","isValid","resetBlockList","j","lineinfo","addLines","getPngName","cycleID","push","topline","top","pngname","thisNum","factory","curX","curY","lineArray","left","createMargins","position","p","right","endpos","create","thisID","indexOf","cycleArry","split","getnum","randomInt","parseInt","neednumber","destroyBlock","line","row","location","texiao","getEffByBlock","addParticleForNode","destroyUpdate","checkCanDestroy","exp","saveExp","updateDate","maxLineNum","max","totoalRowNum","cameraCentPosY","maxline","move","oldY","getPositionY","newY","setPositionY","posbottom","y","totoal","skyposy","bzYbottom","other","realwidth","maxrow","range","geScreenRange","canclick","x","num","getPngId","cameraPosY","min","maxPosY","canshowy","Math","floor","cameraY","gameY","realx","realy","hamX","hamY","updateTouch","point","touchStartCallBack","end","reset","console","setPositionX","touchCancelCallBack","isTouching","touchEndCallBack","touchMoveCallBack","onClickTreasure","event","maxlinenum","touchEndPoint","getLocation","update","eventcallback","toolChange","bool","checkCanAdd","saveHammer","addAdTime","updateButtom","mess","costtype","gold","cost","gem","next","confArry","unlock","openAdTimes","needlvl","level","inviteFriends","boxID","box","rewardID","reward","itemdata","random","z","str","rewardarry","createRewardItem","golds","gems","saveGold","saveGem","BoxID","BoxConf","normalSprite","getFrameFromAtlas","icon","pressedSprite","hoverSprite","disabledSprite","addSkeletonDataWait","action","moveTo","action2","callFunc","setFinish","runAction","sequence"],"mappings":"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","file":"BoxController.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/**\n * Created by bing on 20/04/2018.\n */\n\n//负责head展现和变换。\nconst CameraController = require('CameraController');\nlet StageConfig = require(\"StageConfig\");\nlet BlockConfig = require(\"BoxConfig1\");\nlet CycleConfig = require(\"CycleConfig\");\nlet ToolConfig = require(\"ToolConfig\");\nlet AttributeConfig = require(\"AttributeConfig\");\nlet BoxConfig = require(\"BoxConfig\");\nlet RewardConfig = require(\"RewardConfig\");\n\n\nlet GameType = require(\"GameType\");\nlet GameUtils = require(\"GameUtils\");\nlet GameState = require(\"GameState\");\nlet BlockBigFactory = require(\"BlockBigFactory\");\nlet BlockSmallFactory = require(\"BlockSmallFactory\");\nlet RewardItemFactory = require(\"RewardItemFactory\");\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\nlet SkeletonDataCenter = require(\"SkeletonDataCenter\");\n// let GameMenuController = require('GameMenuController');\n\nlet Global = require('Global');\n\n\nlet winsize = cc.winSize;\nconst BaseHeight =  winsize.height/2;\nconst BaseWidth =  winsize.width/2;\nconst GameHeight = 514;\nconst GameCenterY = 360;\nconst BaseGame = 257 ;\n\ncc.Class({\n    extends:cc.Component,\n\n    properties:{\n        gameNode:cc.Node,\n        camera: cc.Camera,\n        BlockBig:cc.Prefab,\n        BlockSmall:cc.Prefab,\n        MarginsBig:cc.Prefab,\n        MarginsSmall:cc.Prefab,\n        RewardItem:cc.Prefab,\n        UIBottom:cc.Prefab,\n        Sky:cc.Node,\n        Bgbz:cc.Node,\n        Underground:cc.Node,\n        motionStreak: cc.MotionStreak,\n        // hammer: sp.Skeleton,\n        boxSpine:sp.Skeleton,\n        btnbox:cc.Button,\n        GameMenu:cc.Node,\n        treasure:cc.Button,\n        upgradView:cc.Node,\n        // GameMenuController: GameMenuController,\n        language:{\n            visible: false,\n            default:\"English\"\n        },\n        hard:{\n            visible : true,\n            default:5\n        },\n        myinfo:{\n            visible : true,\n            default:null\n        },\n        type:{\n            visible : false,\n            default:0\n        },\n        floorNum:{\n            visible:false,\n            default:5\n        },\n        rowNum:{\n            visible:false,\n            default:5\n        },\n        blockWidth:100,\n        blockBlank:{\n            visible:false,\n            default:0\n        },\n        moveNum:{\n            visible:false,\n            default:0\n        },\n        margins:{\n            visible:false,\n            default:0\n        },\n        curMaxLine:{\n            visible: false,\n            default:0\n        },\n        canTouch:{\n            visible:false,\n            default:true\n        },\n        previousPt:{\n            visible:false,\n            default:null\n        },\n        Hatting:{\n            visible:false,\n            default:false\n        },\n        HattingPos:{\n            visible: false,\n            default:null\n        },\n        gameState:GameState.init ,//0 init 1 playing 2 rolling 3 end\n    },\n\n\n    onLoad:function () {\n        SpriteFrameCenter.preLoadAtlas(\"png/box\",this.initdata.bind(this));\n        this.GameMenuController = cc.find(\"GameMenu\").getComponent(\"GameMenuController\");\n        Global.initInfo();\n        this.blocks = [];\n        this.marginlist=[];\n        this.hammers={};\n        this.rewardItem =[];\n        this.startPos = -GameHeight/2;\n        this.boxSpine.setCompleteListener(trackEntry => {\n            var animationName1 = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName1);\n            // this.restart();\n            this.addItems();\n\n        });\n        this.firstOpen = true;\n    },\n    playBoxSpine:function () {\n        this.boxSpine.node.active = true;\n        this.boxSpine.setAnimation(0, \"newAnimation\", false);\n    },\n    stopBoxSpine:function () {\n        this.boxSpine.node.active = false;\n    },\n    playHammerSpine:function (hammerpos) {\n\n        this.hammers[hammerpos].node.active = true;\n        this.hammers[hammerpos].setAnimation(0, \"newAnimation\", true);\n    },\n    playHammers:function(){\n        for( var i = 3 ;i< 7;i++){\n            if(this.hammers[i] != undefined){\n                this.setSmPosition(i);\n            }\n        }\n    },\n    stopHammerSpine:function (hammerpos) {\n        this.hammers[hammerpos].node.active = false;\n    },\n    addHammer:function(id){\n        let node = new  cc.Node();\n        let hammer = node.addComponent(sp.Skeleton);\n        let info = ToolConfig[id];\n        let animation = info.animation;\n        SkeletonDataCenter.addSkeletonData(animation,hammer) ;\n        this.GameMenu.addChild(node);\n        this.hammers[id]=hammer;\n        hammer.node.active = false;\n        hammer.setCompleteListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"HammerSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n            hammer.node.active = false;\n            if(this.checkCanHammer(id)){\n                this.smCallback(id);\n            }\n        });\n        let conf = AttributeConfig[info.attribute];\n\n        let  timescale = 0.17*conf.att/parseFloat(conf.time);\n        hammer.timeScale = timescale;\n    },\n    changeHammerSpine:function(data){\n        this.hammer.skeletonData = data;\n    },\n    start:function(){\n        this.hard = Global.hard;\n        this.GameMenuController.initInfo();\n        this.hammers={};\n        let timescale=1;\n        let hammer = Global.hammer;\n        for(let i=1;i<7;i++){\n            if(hammer[i]  == undefined)\n                continue;\n            if(ToolConfig[i].id ==1 || ToolConfig[i].id ==2 )\n                continue;\n            let node = new  cc.Node();\n            let nodehammer = node.addComponent(sp.Skeleton);\n            let info = ToolConfig[i];\n            let animation = info.animation;\n            SkeletonDataCenter.addSkeletonData(animation,nodehammer) ;\n            this.GameMenu.addChild(node);\n            this.hammers[hammer[i].id]=nodehammer;\n            nodehammer.node.active = false;\n            nodehammer.setCompleteListener(trackEntry => {\n                var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n                cc.log(\"HammerSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n                nodehammer.node.active = false;\n                if(this.checkCanHammer(i)){\n                    this.smCallback(i);\n                }\n            });\n            let attribute = Global.hammer[i].attribute;\n            let conf1 = AttributeConfig[attribute];\n            hammer.timeScale = 0.17 * conf1.att/parseFloat(conf1.time);\n        }\n\n    },\n    restart:function(){\n        this.hard++;\n        Global.hard++;\n        this.boxSpine.node.active = false;\n        for(let i=1;i<4;i++){\n            // let node = this.rewardItem[i];\n            this.rewardItem[i].destroy();\n            // if(cc.isValid( node)){\n            //     node.destroy();\n            // }\n        }\n        this.rewardItem =[];\n        // this.addItems();\n        this.initdata();\n        this.gameState = GameState.hatting;\n\n    },\n    initdata:function(){\n        this.floorNum=StageConfig[this.hard].layer;\n        for (var i = 0;i<BlockConfig.length;i++){\n            if(BlockConfig[i].blockwidth == StageConfig[this.hard].size){\n                this.type = BlockConfig[i].type;\n                break;\n            }\n        }\n        this.rowNum=BlockConfig[this.type].count;\n        this.blockWidth=BlockConfig[this.type].blockwidth;\n        this.blockBlank=BlockConfig[this.type].blank;\n        this.margins=BlockConfig[this.type].margins;\n\n        this.addBlocks();\n        this.cameraStartPosY();\n        this.btnbox.node.active = true;\n        this.playHammers();\n        this.initTreasure();\n        if(this.firstOpen){\n            this.GameMenuController.addUIBottom();\n            this.firstOpen= false;\n        }\n\n    },\n    checkCanHammer :function(id){\n        var hammer = Global.hammer;\n        if(hammer[id] != undefined && hammer[id].attribute != -1)\n            return true;\n        return false;\n    },\n    resetMarginList:function(){\n        if(this.marginlist.length>0){\n            for(let i=0 ;i<this.marginlist.length;i++){\n                let node = this.marginlist[i];\n                if(cc.isValid(node)){\n                    node.destroy();\n                }\n            }\n        }\n        this.marginlist=[];\n    },\n    resetBlockList:function(){\n        if(this.blocks.length>0){\n            for(let i=0 ;i<this.blocks.length;i++){\n                for( let j=0;j<this.blocks[i].length;j++){\n                    let node = this.blocks[i][j];\n                    if(cc.isValid(node)){\n                        node.destroy();\n                    }\n                }\n            }\n        }\n        this.blocks=[];\n    },\n    //--------- block -----------------------\n    addBlocks:function() {\n\n        this.resetBlockList();\n        this.resetMarginList();\n        for (var i =0;i< this.floorNum-1;i++){\n\n            var lineinfo=this.addLines(this.getPngName(StageConfig[this.hard].cycleID,i),i);\n\n            this.blocks.push(lineinfo);\n            lineinfo=[];\n        }\n        let topline = this.addLines(StageConfig[this.hard].top,i);\n        this.blocks.push(topline);\n    },\n    addLines:function (pngname,thisNum) {\n\n        let conf=BlockConfig[this.type];\n        let count = conf.count;\n        let factory= this.type == 0?BlockBigFactory:BlockSmallFactory;\n        let curX= conf.margins+conf.blank -BaseWidth;\n        let curY= thisNum*(this.blockWidth+conf.blank) + this.startPos;\n        let lineArray=[];\n        let left = factory.createMargins(pngname);\n\n        left.position = cc.p(conf.margins/2-BaseWidth,curY+this.blockWidth/2);\n        this.gameNode.addChild(left);\n        this.marginlist.push(left);\n        let right = factory.createMargins(pngname);\n        let endpos = BaseWidth- conf.margins/2;\n        right.position = cc.p(endpos,curY+this.blockWidth/2);\n        this.gameNode.addChild(right);\n        this.marginlist.push(right);\n\n        for(var i=0;i<count;i++){\n            let node = factory.create(pngname);\n            node.position = cc.p(curX+this.blockWidth/2,curY+this.blockWidth/2);\n            curX+=this.blockWidth+conf.blank;\n            this.gameNode.addChild(node);\n            lineArray.push(node);\n        }\n\n        return lineArray;\n    },\n\n    //根据 获得 图片的名字\n    getPngName(cycleID,thisNum){\n        let thisID;\n        if(cycleID.indexOf(\";\") != -1){\n            let cycleArry = cycleID.split(\";\");\n            let getnum=GameUtils.randomInt(0,cycleArry.length-1);\n            thisID=cycleArry[getnum];\n        }else{\n            thisID=parseInt(cycleID);\n        }\n        let neednumber=0;\n        for(var i =1;i<=10 ;i++)\n        {\n            if(CycleConfig[thisID][\"num\"+i] == 0){\n                i=0;\n                continue;\n            }\n            neednumber+=CycleConfig[thisID][\"num\"+i];\n            if(neednumber>=thisNum){\n                return CycleConfig[thisID][\"block\"+i]\n            }\n            if(i==10){\n                i=0;\n            }\n        }\n    },\n    //销毁砖块\n    destroyBlock:function(line,row ){\n\n        if(!this.blocks[line])\n            return;\n        let node = this.blocks[line][row];\n        let location = this.hammerpos(line,row);\n        let texiao=this.getEffByBlock(line,row);\n        if(cc.isValid(node) ) {\n            ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n            node.destroy();\n            this.destroyUpdate();\n        }\n\n    },\n    checkCanDestroy :function(line,row){\n        if(!cc.isValid(this.blocks[line]) || !cc.isValid(this.blocks[line][row]) )\n            return false;\n        if(line >= this.floorNum-1)\n            return true;\n        let node;\n        node = this.blocks[line+1][row];\n        if(!cc.isValid(node)){\n            return true;\n        }\n        if(line>0){\n            node = this.blocks[line-1][row];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }\n        if(row>0 && row <this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if (row == 0){\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if(row == this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    destroyUpdate:function(){\n        // this.myinfo.exp++;\n        Global.exp++;\n        // cc.sys.localStorage.setItem('myinfo',JSON.stringify(this.myinfo));\n        Global.saveExp(Global.exp);\n        this.GameMenuController.updateDate({exp: Global.exp});\n\n    },\n    //--------- block -----------------------\n    maxLineNum:function(){\n        var max=0;\n        for(var i=0;i<this.floorNum;i++){\n            for(var j= 0;j<this.rowNum;j++) {\n                if (this.blocks && this.blocks[i] && this.blocks[i][j]) {\n                    var node = this.blocks[i][j];\n                    if (!cc.isValid(node))\n                        continue;\n                    if (i > max) {\n                        max = i;\n                    }\n                    break;\n                }\n            }\n        }\n        return max;\n    },\n\n    totoalRowNum:function(line) {//line 行拥有点的数量\n        var max = 0;\n        for(var j= 0;j<this.rowNum;j++){\n            var node = this.blocks[line][j];\n            if(!cc.isValid(node) )\n                continue;\n            max++;\n        }\n        return max;\n    },\n\n    //************camera 相关设置 start **********************\n    cameraCentPosY:function(){\n\n        let maxline=this.maxLineNum();\n        if(this.curMaxLine<= maxline){\n            return;\n        }\n        let move = this.curMaxLine-maxline;\n        this.curMaxLine=maxline;\n        let oldY = this.camera.node.getPositionY();\n        if(oldY<=GameCenterY){\n            return;\n        }\n        let newY= oldY-this.blockWidth*move;\n        if(newY>=GameCenterY){\n            this.camera.node.setPositionY(newY);\n        }else {\n            this.camera.node.setPositionY(GameCenterY);\n        }\n\n    },\n\n    cameraStartPosY:function(){\n        let height = this.floorNum*(this.blockWidth+this.blockBlank);\n        //地下\n        this.Underground.height=height;\n        let posbottom= (height-GameHeight)/2;\n        this.Underground.y=posbottom;\n        //地面\n        let totoal= this.Bgbz.height+height -50;\n        let skyposy;\n        let bzYbottom;\n        let other = GameHeight- totoal;\n        bzYbottom= (totoal+height - GameHeight)/2 -25;\n        this.Bgbz.y=bzYbottom;\n        if(other>0){\n            this.Sky.active = true;\n            this.Sky.height = other+10;\n            skyposy= (GameHeight - other)/2;\n            this.Sky.y=skyposy;\n            this.camera.node.setPositionY(GameCenterY);\n        }else{\n            this.Sky.active = false;\n            this.camera.node.setPositionY(GameCenterY - other);\n\n        }\n        this.curMaxLine = this.floorNum -1;\n    },\n\n\n    //************camera 相关设置 end **********************\n    //*********** 锤子 相关设置  start***************\n    setSmPosition:function(hammerpos){\n        let realwidth=this.blockWidth+this.blockBlank;\n        let maxline = this.curMaxLine;\n        let maxrow = this.totoalRowNum(0);\n        if(maxline == 0 && maxrow ==   0)\n        {\n            this.HattingPos =null;\n            // this.sm.node.visible = false;\n            this.hammers[hammerpos].node.active = false;\n            return ;\n        }\n        this.hammers[hammerpos].node.active = true;\n        let range = this.geScreenRange();\n        // let line = GameUtils.randomInt(range.min,range.max);\n        let line = this.curMaxLine;\n        let find = false;\n        let canclick=[];\n        for(var i = 0;i<this.rowNum;i++){//当前行可以删除的\n            if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\n                let find = false;\n                for(let j=1;j<=4;j++){\n                    if( this.HattingPos && this.HattingPos[j]){\n                        if(this.HattingPos[j].x == line && i ==this.HattingPos[j].y){\n                            find= true;\n                            break;\n                        }\n                    }\n                }\n                if(!find){\n                    canclick.push(i);\n                }\n            }\n        }\n\n        if(canclick.length ==0 && line ==0){\n            this.HattingPos[hammerpos] = null;\n            return;\n        }else if(canclick.length == 0){\n            line= line-1;\n            for(var i = 0;i<this.rowNum;i++){//当前行可以删除的\n                if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\n                    let find = false;\n                    for(let j=1;j<=4;j++){\n                        if( this.HattingPos && this.HattingPos[j]){\n                            if(this.HattingPos[j].x == line && i ==this.HattingPos[j].y){\n                                find= true;\n                                break;\n                            }\n                        }\n                    }\n                    if(!find){\n                        canclick.push(i);\n                    }\n                }\n            }\n        }\n        let num = GameUtils.randomInt(0,canclick.length-1);\n        let row= canclick[num];\n\n        let location = this.hammerpos(line,row);\n        let texiao=this.getEffByBlock(line,row);\n        // ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n        if(this.HattingPos == null){\n            this.HattingPos= {};\n        }\n        this.HattingPos[hammerpos] ={x:line,y:row};\n        this.hammers[hammerpos].node.position=location;\n        this.playHammerSpine(hammerpos);\n    },\n    //根据小块的位置 过的特效文件\n    getEffByBlock(line,row){\n\n        let type = this.type == 0? \"BlockBig\":\"BlockSmall\";\n        let node = this.blocks[line][row].getComponent(type);\n        return node.getPngId();\n    },\n    geScreenRange : function(){\n        let max = this.curMaxLine;\n        let cameraPosY = this.camera.node.getPositionY();\n        let min=0;\n        let realwidth=this.blockWidth+this.blockBlank;\n        if(cameraPosY <= BaseHeight){\n            min =0;\n        }else{\n            let maxPosY= max*realwidth;\n            let canshowy = (maxPosY - cameraPosY+BaseHeight)/realwidth;\n            min = Math.floor(max- canshowy);\n        }\n        return {max:max,min:min};\n    },\n    //根据块的位置计算锤子的位置\n    hammerpos:function(line,row){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        let realx = row * realwidth+this.margins+this.blockBlank;\n        let realy = line * realwidth+gameY -cameraY -BaseGame;\n        let hamX= realx - BaseWidth - 42+this.blockWidth;\n        let hamY = realy - 42;\n        return cc.p(hamX,hamY);\n\n    },\n    smCallback:function(hammerpos){\n        if(this.HattingPos != null && this.HattingPos[hammerpos]!=null ){\n            let y= this.HattingPos[hammerpos].y;\n            let x= this.HattingPos[hammerpos].x;\n            if(cc.isValid(this.blocks[x][y])){\n                // this.blocks[x][y].destroy();\n                this.destroyBlock(x,y);\n            }\n            this.cameraCentPosY();\n            this.setSmPosition(hammerpos);\n        }\n    },\n    //*********** 锤子 相关设置  end*****************\n\n    updateTouch:function(point){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        var line = Math.floor((point.y-(gameY-cameraY+BaseHeight - BaseGame))/realwidth);\n        var row = Math.floor((point.x-this.margins - this.blockBlank)/realwidth);\n        if(this.checkCanDestroy(line,row)){\n            let location = this.hammerpos(line,row);\n            let texiao=this.getEffByBlock(line,row);\n            // ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n            this.destroyBlock(line,row);\n        }\n    },\n    touchStartCallBack:function (location) {\n        if(!this.canTouch){\n            return;\n        }\n        if(this.gameState == GameState.end){\n            this.restart();\n        }\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins)){\n            this.motionStreak.reset();\n            return;\n        }\n        console.log(\"touchStartCallBack\");\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n        this.motionStreak.reset();\n        // this.isTouching = false;\n    },\n\n    touchCancelCallBack:function (location) {\n        this.updateTouch(location);\n        this.isTouching = false;\n        this.motionStreak.reset();\n    },\n\n    touchEndCallBack:function (location) {\n        // this.touchPosition(location);\n        this.updateTouch(location);\n        this.isTouching = false;\n        console.log(\"touchEndCallBack\");\n        this.motionStreak.reset();\n    },\n    touchMoveCallBack:function (location) {\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins\n            || location.y<216 )){\n            this.motionStreak.reset();\n            return;\n        }\n        this.updateTouch(location);\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n    },\n\n    onClickTreasure:function(event){\n        var maxlinenum= this.maxLineNum();\n        var totoalRowNum= this.totoalRowNum(0);\n        if(maxlinenum != 0  || totoalRowNum != 0){\n            this.touchEndPoint = event.getLocation();\n\n            this.updateTouch(this.touchEndPoint);\n            return;\n        }\n        this.btnbox.node.active = false;\n        this.gameState = GameState.end;\n        this.playBoxSpine();\n    },\n    update:function(){\n        this.cameraCentPosY();\n    },\n    eventcallback: function(type, id) {\n        // let node= this.itemList.indexOf(sender);\n        switch (type) {\n            case 0:\n                break;\n            case 1:\n                // let info = ToolConfig[id];\n                // let animation = info.animation;\n                // // BoxController.changeHammerSpine(animation);\n                // SkeletonDataCenter.addSkeletonData(animation, BoxController.changeHammerSpine);\n                this.toolChange(id);\n                break;\n            case 2:\n                break;\n        }\n    },\n    toolChange:function(id) {\n        let info = ToolConfig[id];\n        // let animation = info.animation;\n        // this.BoxController.changeHammerSpine(animation);\n        // let node = this.BoxController.hammers[id-1];\n        // SkeletonDataCenter.addSkeletonData(animation,node);\n\n        if(Global.hammer[id] == undefined){\n            let bool =this.checkCanAdd(id);\n            if(bool) {\n                Global.hammer[id] = {id: id, attribute: info.attribute};\n                Global.saveHammer(Global.hammer);\n                if(id != 1 && id !=2){\n                    this.addHammer(id);\n                    this.setSmPosition(id);\n                }\n            }else{\n                this.addAdTime(id);\n            }\n            this.GameMenuController.updateButtom();\n        }else{\n\n            let conf = AttributeConfig[Global.hammer[id].attribute];\n            let mess ={};\n\n            if(conf.costtype = 1001){\n                Global.gold -= conf.cost;\n                mess['gold']=Global.gold;\n            }else if(conf.costtype = 1002){\n                Global.gem -= conf.cost;\n                mess['gem']=Global.gem;\n            }\n            if(conf.next != -1){\n                Global.hammer[id].attribute = conf.next;\n                let conf1=AttributeConfig[conf.next];\n                Global.saveHammer(Global.hammer);\n                this.hammers[id].timeScale = 0.17*(conf1.att/parseFloat(conf1.time));\n            }\n            this.GameMenuController.updateDate(mess);\n        }\n    },\n    checkCanAdd:function(id){\n        let conf = ToolConfig[id];\n        let thisID;\n        let confArry;\n        if(id == 1 || id == 2 )\n            return false;\n        if(\"unlock\" in conf) {\n            if (conf.unlock.indexOf(\";\") != -1) {\n                confArry = conf.unlock.split(\";\");\n                thisID = confArry[0];\n            } else {\n                thisID = parseInt(conf.unlock);\n            }\n            if (thisID == -1 ) {\n                return true;\n            }\n            if(thisID == 0){//点击激活\n                return true;\n            }else if(thisID == 1){//视频激励\n                 return Global.openAdTimes>0;\n            }else if(thisID == 2){//等级激活\n                let needlvl = confArry[1];\n                if(Global.level<needlvl){\n                    return false;\n                }else{\n                    return true;\n                }\n\n            }else if(thisID == 3){//邀请好友\n                if( Global.inviteFriends< confArry[1])\n                    return false;\n                else\n                    return true;\n            }\n        }\n        return true;\n\n    },\n    addAdTime:function(id){\n        let conf = ToolConfig[id];\n        let thisID;\n        let confArry;\n        if(id == 1 || id == 2 )\n            return;\n        if(\"unlock\" in conf) {\n            if (conf.unlock.indexOf(\";\") != -1) {\n                confArry = conf.unlock.split(\";\");\n                thisID = confArry[0];\n            } else {\n                thisID = parseInt(conf.unlock);\n            }\n            if(thisID == 1){//视频激励\n                return Global.openAdTimes++;\n            }else if(thisID == 3){//邀请好友\n                Global.inviteFriends++;\n            }\n        }\n    },\n    addItems:function(){\n\n        let hard = Global.hard;\n        let boxID = StageConfig[hard].box;\n        let rewardID= BoxConfig[boxID].reward;\n        let conf = RewardConfig[rewardID];\n        let num = conf.num;\n        let itemdata = {};\n        let totoal=0;\n        let reward ={};\n        let max =0;\n        for (let i =1;i<7;i++){\n            if(conf['rate'+i] !=0){\n                totoal=conf['rate'+i];\n                if(i == 1){\n                    itemdata[i] = totoal;\n                    max = itemdata[i];\n                }else{\n                    itemdata[i] = itemdata[i-1] + totoal;\n                    max = itemdata[i];\n                }\n            }\n        }\n        for (let j=1;j<=num;j++){\n            let random= GameUtils.random(max);\n            for(let z =1;itemdata[z] != undefined;z++){\n                if(itemdata[z]<random){\n                    continue;\n                }\n                reward[j]=conf['item'+z];\n                break;\n            }\n        }\n        let gold =0;\n        let gem= 0;\n        let str =\"\";\n        for(let i=1; i<=num;i++){\n            if(reward[i] != undefined){\n                str+=reward[i]+\"--\";\n                if(reward[i].indexOf(\";\") != -1){\n                    let rewardarry = reward[i].split(\";\");\n                    if(rewardarry[0] == 1001){\n                        gold+=parseInt(rewardarry[1]);\n                    }else if(rewardarry[0] == 1002){\n                        gem+=parseInt(rewardarry[1]);\n                    }\n                }\n            }\n            this.createRewardItem(reward[i],i);\n        }\n        if(gold>0 || gem >0){\n            let golds = Global.gold+gold;\n            let gems = Global.gem+gem;\n            this.GameMenuController.updateDate({gold:golds,gem:gems});\n            Global.saveGold(golds);\n            Global.saveGem(gems );\n        }\n\n    },\n    initTreasure:function(){\n        let BoxID = StageConfig[this.hard].box;\n        let BoxConf = BoxConfig[BoxID];\n        this.treasure.normalSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        this.treasure.pressedSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        this.treasure.hoverSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        this.treasure.disabledSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        let animation = BoxConf.animation+\".json\";\n        SkeletonDataCenter.addSkeletonDataWait(animation,  this.boxSpine);\n        this.treasure.node.y = - GameHeight/2+ this.blockWidth+35 -20;\n        this.boxSpine.node.y = - GameHeight/2+ this.blockWidth+35 -20;\n\n    },\n    createRewardItem:function(reward,i){\n        if(this.rewardItem[i]){\n            this.rewardItem[i].destroy();\n            this.rewardItem[i]=null;\n        }\n        let start = -400 +i*200;\n\n        let node = RewardItemFactory.create(reward);\n        let location = this.treasure.node.position;\n        this.rewardItem[i]=(node);\n        node.position = location;\n        let action =cc. moveTo(0.5,cc.p(start,-20));\n        let action2 = cc.callFunc(()=> {\n            node.getComponent(\"RewardItem\").setFinish();\n        },this);\n        // node.runAction(cc. moveTo(0.5,cc.p(start,-20)));\n        this.gameNode.addChild(node);\n        node.runAction(cc.sequence(action, action2));\n    }\n});\n//"]}