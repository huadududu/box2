{"version":3,"sources":["BoxController.js"],"names":["CameraController","require","StageConfig","BlockConfig","CycleConfig","ToolConfig","AttributeConfig","BoxConfig","RewardConfig","GameType","GameUtils","BlockBigFactory","BlockSmallFactory","SpriteFrameCenter","ParticleSystemCenter","SkeletonDataCenter","Global","winsize","cc","winSize","BaseHeight","height","BaseWidth","width","GameHeight","GameCenterY","BaseGame","Class","extends","Component","properties","gameNode","Node","camera","Camera","BlockBig","Prefab","BlockSmall","MarginsBig","MarginsSmall","UIBottom","Sky","Bgbz","Underground","motionStreak","MotionStreak","boxSpine","sp","Skeleton","btnbox","Button","GameMenu","treasure","language","visible","default","hard","myinfo","type","floorNum","rowNum","blockWidth","blockBlank","moveNum","margins","curMaxLine","canTouch","previousPt","Hatting","HattingPos","onLoad","preLoadAtlas","initdata","bind","GameMenuController","find","getComponent","initInfo","blocks","marginlist","hammers","startPos","setCompleteListener","animationName1","trackEntry","animation","name","log","trackIndex","restart","node","active","playBoxSpine","setAnimation","stopBoxSpine","playHammerSpine","hammerpos","playHammers","i","undefined","setSmPosition","stopHammerSpine","addHammer","id","hammer","addComponent","info","addSkeletonData","addChild","animationName","checkCanHammer","smCallback","conf","attribute","timescale","att","parseFloat","time","timeScale","changeHammerSpine","data","skeletonData","start","nodehammer","conf1","addItems","boxID","box","rewardID","reward","num","itemdata","totoal","max","j","random","z","gold","gem","indexOf","rewardarry","split","parseInt","saveHard","golds","gems","updateDate","saveGold","saveGem","layer","length","blockwidth","size","count","blank","addBlocks","cameraStartPosY","addUIBottom","initTreasure","resetMarginList","isValid","destroy","resetBlockList","lineinfo","addLines","getPngName","cycleID","push","topline","top","pngname","thisNum","factory","curX","curY","lineArray","left","createMargins","position","p","right","endpos","create","thisID","cycleArry","getnum","randomInt","neednumber","destroyBlock","line","row","destroyUpdate","checkCanDestroy","exp","saveExp","maxLineNum","totoalRowNum","cameraCentPosY","maxline","move","oldY","getPositionY","newY","setPositionY","posbottom","y","skyposy","bzYbottom","other","realwidth","maxrow","range","geScreenRange","canclick","x","location","texiao","getEffByBlock","addParticleForNode","getPngId","cameraPosY","min","maxPosY","canshowy","Math","floor","cameraY","gameY","realx","realy","hamX","hamY","updateTouch","point","touchStartCallBack","reset","console","setPositionX","touchCancelCallBack","isTouching","touchEndCallBack","touchMoveCallBack","onClickTreasure","event","maxlinenum","touchEndPoint","getLocation","update","eventcallback","toolChange","saveHammer","costtype","cost","next","BoxID","BoxConf","normalSprite","getFrameFromAtlas","icon","pressedSprite","hoverSprite","disabledSprite","addSkeletonDataWait"],"mappings":"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","file":"BoxController.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/**\n * Created by bing on 20/04/2018.\n */\n\n//负责head展现和变换。\nconst CameraController = require('CameraController');\nlet StageConfig = require(\"StageConfig\");\nlet BlockConfig = require(\"BoxConfig1\");\nlet CycleConfig = require(\"CycleConfig\");\nlet ToolConfig = require(\"ToolConfig\");\nlet AttributeConfig = require(\"AttributeConfig\");\nlet BoxConfig = require(\"BoxConfig\");\nlet RewardConfig = require(\"RewardConfig\");\n\n\nlet GameType = require(\"GameType\");\nlet GameUtils = require(\"GameUtils\");\nlet BlockBigFactory = require(\"BlockBigFactory\");\nlet BlockSmallFactory = require(\"BlockSmallFactory\");\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\nlet SkeletonDataCenter = require(\"SkeletonDataCenter\");\n// let GameMenuController = require('GameMenuController');\nlet Global = require('Global');\n\n\nlet winsize = cc.winSize;\nconst BaseHeight =  winsize.height/2;\nconst BaseWidth =  winsize.width/2;\nconst GameHeight = 514;\nconst GameCenterY = 360;\nconst BaseGame = 257 ;\n\ncc.Class({\n    extends:cc.Component,\n\n    properties:{\n        gameNode:cc.Node,\n        camera: cc.Camera,\n        BlockBig:cc.Prefab,\n        BlockSmall:cc.Prefab,\n        MarginsBig:cc.Prefab,\n        MarginsSmall:cc.Prefab,\n        UIBottom:cc.Prefab,\n        Sky:cc.Node,\n        Bgbz:cc.Node,\n        Underground:cc.Node,\n        motionStreak: cc.MotionStreak,\n        // hammer: sp.Skeleton,\n        boxSpine:sp.Skeleton,\n        btnbox:cc.Button,\n        GameMenu:cc.Node,\n        treasure:cc.Button,\n        // GameMenuController: GameMenuController,\n        language:{\n            visible: false,\n            default:\"English\"\n        },\n        hard:{\n            visible : true,\n            default:5\n        },\n        myinfo:{\n            visible : true,\n            default:null\n        },\n        type:{\n            visible : false,\n            default:0\n        },\n        floorNum:{\n            visible:false,\n            default:5\n        },\n        rowNum:{\n            visible:false,\n            default:5\n        },\n        blockWidth:100,\n        blockBlank:{\n            visible:false,\n            default:0\n        },\n        moveNum:{\n            visible:false,\n            default:0\n        },\n        margins:{\n            visible:false,\n            default:0\n        },\n        curMaxLine:{\n            visible: false,\n            default:0\n        },\n        canTouch:{\n            visible:false,\n            default:true\n        },\n        previousPt:{\n            visible:false,\n            default:null\n        },\n        Hatting:{\n            visible:false,\n            default:false\n        },\n        HattingPos:{\n            visible: false,\n            default:null\n        }\n    },\n\n\n    onLoad:function () {\n        SpriteFrameCenter.preLoadAtlas(\"png/box\",this.initdata.bind(this));\n        this.GameMenuController = cc.find(\"GameMenu\").getComponent(\"GameMenuController\");\n        Global.initInfo();\n        this.blocks = [];\n        this.marginlist=[];\n        this.hammers={};\n        this.startPos = -GameHeight/2;\n        this.boxSpine.setCompleteListener(trackEntry => {\n            var animationName1 = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName1);\n            this.restart();\n            this.boxSpine.node.active = false;\n\n        });\n    },\n    playBoxSpine:function () {\n        this.boxSpine.node.active = true;\n        this.boxSpine.setAnimation(0, \"newAnimation\", false);\n    },\n    stopBoxSpine:function () {\n        this.boxSpine.node.active = false;\n    },\n    playHammerSpine:function (hammerpos) {\n\n        this.hammers[hammerpos].node.active = true;\n        this.hammers[hammerpos].setAnimation(0, \"newAnimation\", true);\n    },\n    playHammers:function(){\n        for( var i = 1 ;i< 5;i++){\n            if(this.hammers[i] != undefined){\n                this.setSmPosition(i);\n            }\n        }\n    },\n    stopHammerSpine:function (hammerpos) {\n        this.hammers[hammerpos].node.active = false;\n    },\n    addHammer:function(id){\n        let node = new  cc.Node();\n        let hammer = node.addComponent(sp.Skeleton);\n        let info = ToolConfig[id];\n        let animation = info.animation;\n        SkeletonDataCenter.addSkeletonData(animation,hammer) ;\n        this.GameMenu.addChild(node);\n        this.hammers[id]=hammer;\n        hammer.node.active = false;\n        hammer.setCompleteListener(trackEntry => {\n            var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n            cc.log(\"HammerSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n            hammer.node.active = false;\n            if(this.checkCanHammer(id)){\n                this.smCallback(id);\n            }\n        });\n        let conf = AttributeConfig[info.attribute];\n\n        let  timescale = 0.17*conf.att/parseFloat(conf.time);\n        hammer.timeScale = timescale;\n    },\n    changeHammerSpine:function(data){\n        // this.hammer.node.active = false;\n        this.hammer.skeletonData = data;\n    },\n    start:function(){\n        // this.initdata();\n        // this.myinfo = JSON.parse(cc.sys.localStorage.getItem('myinfo'));\n        // if(this.myinfo == null){\n        //     this.myinfo ={hard:1,level:1,gold:1,gem:1,exp:1,hammer:[]};\n        // }\n        // this.myinfo ={hard:1,level:1,gold:1,gem:1,exp:1,hammer:[{\"id\":1,\"attribute\":-1},{\"id\":2,\"attribute\":-1},{\"id\":3,\"attribute\":-1},{\"id\":4,\"attribute\":-1}]};\n        // cc.sys.localStorage.setItem('myinfo',JSON.stringify(this.myinfo));\n        this.hard = Global.hard;\n        this.GameMenuController.initInfo();\n        this.hammers={};\n        let timescale=1;\n        let hammer = Global.hammer;\n        for(let i=1;i<5;i++){\n            if(hammer[i]  == undefined)\n                continue;\n            let node = new  cc.Node();\n            let nodehammer = node.addComponent(sp.Skeleton);\n            let info = ToolConfig[i];\n            let animation = info.animation;\n            SkeletonDataCenter.addSkeletonData(animation,nodehammer) ;\n            this.GameMenu.addChild(node);\n            this.hammers[hammer[i].id]=nodehammer;\n            nodehammer.node.active = false;\n            nodehammer.setCompleteListener(trackEntry => {\n                var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\n                cc.log(\"HammerSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\n                nodehammer.node.active = false;\n                if(this.checkCanHammer(i)){\n                    this.smCallback(i);\n                }\n            });\n            let attribute = Global.hammer[i].attribute;\n            let conf1 = AttributeConfig[attribute];\n            hammer.timeScale = 0.17 * conf1.att/parseFloat(conf1.time);\n        }\n\n    },\n    restart:function(){\n        this.hard++;\n        this.addItems();\n        this.initdata();\n    },\n    addItems:function(){\n\n        let boxID = StageConfig[this.hard].box;\n        let rewardID= BoxConfig[boxID].reward;\n        let conf = RewardConfig[rewardID];\n        let num = conf.num;\n        let itemdata = {};\n        let totoal=0;\n        let reward ={};\n        let max =0;\n        for (let i =1;i<7;i++){\n            if(conf['rate'+i] !=0){\n                totoal=conf['rate'+i];\n                if(i == 1){\n                    itemdata[i] = totoal;\n                    max = itemdata[i];\n                }else{\n                    itemdata[i] = itemdata[i-1] + totoal;\n                    max = itemdata[i];\n                }\n            }\n        }\n        for (let j=1;j<=num;j++){\n            let random= GameUtils.random(max);\n            for(let z =1;itemdata[z] != undefined;z++){\n                if(itemdata[z]<random){\n                    continue;\n                }\n                reward[j]=conf['item'+z];\n                break;\n            }\n        }\n        let gold =0;\n        let gem= 0;\n        for(let i=1; i<=num;i++){\n            if(reward[i] != undefined){\n                if(reward[i].indexOf(\";\") != -1){\n                    let rewardarry = reward[i].split(\";\");\n                    if(rewardarry[0] == 1001){\n                        gold+=parseInt(rewardarry[1]);\n                    }else if(rewardarry[0] == 1002){\n                        gem+=parseInt(rewardarry[1]);\n                    }\n                }\n            }\n        }\n        Global.saveHard(++this.hard);\n        let golds = Global.gold+gold;\n        let gems = Global.gem+gem;\n        if(gold>0 || gem>0){\n           this.GameMenuController.updateDate({gold:golds,gem:gems});\n            Global.saveGold(golds);\n            Global.saveGem(gems );\n        }\n    },\n\n    initdata:function(){\n        this.floorNum=StageConfig[this.hard].layer;\n        for (var i = 0;i<BlockConfig.length;i++){\n            if(BlockConfig[i].blockwidth == StageConfig[this.hard].size){\n                this.type = BlockConfig[i].type;\n                break;\n            }\n        }\n        this.rowNum=BlockConfig[this.type].count;\n        this.blockWidth=BlockConfig[this.type].blockwidth;\n        this.blockBlank=BlockConfig[this.type].blank;\n        this.margins=BlockConfig[this.type].margins;\n\n        this.addBlocks();\n        this.cameraStartPosY();\n        // this.setSmPosition(this.hammer);\n        this.GameMenuController.addUIBottom();\n\n        // this.playHammers(this.hammer);\n        this.btnbox.node.active = true;\n        this.playHammers();\n        //\n        this.initTreasure();\n    },\n    checkCanHammer :function(id){\n        var hammer = Global.hammer;\n        if(hammer[id] != undefined && hammer[id].attribute != -1)\n            return true;\n        return false;\n    },\n    resetMarginList:function(){\n        if(this.marginlist.length>0){\n            for(let i=0 ;i<this.marginlist.length;i++){\n                let node = this.marginlist[i];\n                if(cc.isValid(node)){\n                    node.destroy();\n                }\n            }\n        }\n        this.marginlist=[];\n    },\n    resetBlockList:function(){\n        if(this.blocks.length>0){\n            for(let i=0 ;i<this.blocks.length;i++){\n                for( let j=0;j<this.blocks[i].length;j++){\n                    let node = this.blocks[i][j];\n                    if(cc.isValid(node)){\n                        node.destroy();\n                    }\n                }\n            }\n        }\n        this.blocks=[];\n    },\n    //--------- block -----------------------\n    addBlocks:function() {\n\n        this.resetBlockList();\n        this.resetMarginList();\n        for (var i =0;i< this.floorNum-1;i++){\n\n            var lineinfo=this.addLines(this.getPngName(StageConfig[this.hard].cycleID,i),i);\n\n            this.blocks.push(lineinfo);\n            lineinfo=[];\n        }\n        let topline = this.addLines(StageConfig[this.hard].top,i);\n        this.blocks.push(topline);\n    },\n    addLines:function (pngname,thisNum) {\n\n        let conf=BlockConfig[this.type];\n        let count = conf.count;\n        let factory= this.type == 0?BlockBigFactory:BlockSmallFactory;\n        let curX= conf.margins+conf.blank -BaseWidth;\n        let curY= thisNum*(this.blockWidth+conf.blank) + this.startPos;\n        let lineArray=[];\n        let left = factory.createMargins(pngname);\n\n        left.position = cc.p(conf.margins/2-BaseWidth,curY+this.blockWidth/2);\n        this.gameNode.addChild(left);\n        this.marginlist.push(left);\n        let right = factory.createMargins(pngname);\n        let endpos = BaseWidth- conf.margins/2;\n        right.position = cc.p(endpos,curY+this.blockWidth/2);\n        this.gameNode.addChild(right);\n        this.marginlist.push(right);\n\n        for(var i=0;i<count;i++){\n            let node = factory.create(pngname);\n            node.position = cc.p(curX+this.blockWidth/2,curY+this.blockWidth/2);\n            curX+=this.blockWidth+conf.blank;\n            this.gameNode.addChild(node);\n            lineArray.push(node);\n        }\n\n        return lineArray;\n    },\n\n    //根据 获得 图片的名字\n    getPngName(cycleID,thisNum){\n        let thisID;\n        if(cycleID.indexOf(\";\") != -1){\n            let cycleArry = cycleID.split(\";\");\n            let getnum=GameUtils.randomInt(0,cycleArry.length-1);\n            thisID=cycleArry[getnum];\n        }else{\n            thisID=parseInt(cycleID);\n        }\n        let neednumber=0;\n        for(var i =1;i<=10 ;i++)\n        {\n            if(CycleConfig[thisID][\"num\"+i] == 0){\n                i=0;\n                continue;\n            }\n            neednumber+=CycleConfig[thisID][\"num\"+i];\n            if(neednumber>=thisNum){\n                return CycleConfig[thisID][\"block\"+i]\n            }\n            if(i==10){\n                i=0;\n            }\n        }\n    },\n    //销毁砖块\n    destroyBlock:function(line,row ){\n\n        if(!this.blocks[line])\n            return;\n        let node = this.blocks[line][row];\n        if(cc.isValid(node) ) {\n            node.destroy();\n            this.destroyUpdate();\n        }\n\n    },\n    checkCanDestroy :function(line,row){\n        if(!cc.isValid(this.blocks[line]) || !cc.isValid(this.blocks[line][row]) )\n            return false;\n        if(line >= this.floorNum-1)\n            return true;\n        let node;\n        node = this.blocks[line+1][row];\n        if(!cc.isValid(node)){\n            return true;\n        }\n        if(line>0){\n            node = this.blocks[line-1][row];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }\n        if(row>0 && row <this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if (row == 0){\n            node = this.blocks[line][row+1];\n            if(!cc.isValid(node)){\n                return true;\n            }\n        }else if(row == this.rowNum-1){\n            node = this.blocks[line][row-1];\n            if(!cc.isValid(node)) {\n                return true;\n            }\n        }\n        return false;\n    },\n    destroyUpdate:function(){\n        // this.myinfo.exp++;\n        Global.exp++;\n        // cc.sys.localStorage.setItem('myinfo',JSON.stringify(this.myinfo));\n        Global.saveExp(Global.exp);\n        this.GameMenuController.updateDate({exp: Global.exp});\n\n    },\n    //--------- block -----------------------\n    maxLineNum:function(){\n        var max=0;\n        for(var i=0;i<this.floorNum;i++){\n            for(var j= 0;j<this.rowNum;j++) {\n                if (this.blocks && this.blocks[i] && this.blocks[i][j]) {\n                    var node = this.blocks[i][j];\n                    if (!cc.isValid(node))\n                        continue;\n                    if (i > max) {\n                        max = i;\n                    }\n                    break;\n                }\n            }\n        }\n        return max;\n    },\n\n    totoalRowNum:function(line) {//line 行拥有点的数量\n        var max = 0;\n        for(var j= 0;j<this.rowNum;j++){\n            var node = this.blocks[line][j];\n            if(!cc.isValid(node) )\n                continue;\n            max++;\n        }\n        return max;\n    },\n\n    //************camera 相关设置 start **********************\n    cameraCentPosY:function(){\n\n        let maxline=this.maxLineNum();\n        if(this.curMaxLine<= maxline){\n            return;\n        }\n        let move = this.curMaxLine-maxline;\n        this.curMaxLine=maxline;\n        let oldY = this.camera.node.getPositionY();\n        if(oldY<=GameCenterY){\n            return;\n        }\n        let newY= oldY-this.blockWidth*move;\n        if(newY>=GameCenterY){\n            this.camera.node.setPositionY(newY);\n        }else {\n            this.camera.node.setPositionY(GameCenterY);\n        }\n\n    },\n\n    cameraStartPosY:function(){\n        let height = this.floorNum*(this.blockWidth+this.blockBlank);\n        //地下\n        this.Underground.height=height;\n        let posbottom= (height-GameHeight)/2;\n        this.Underground.y=posbottom;\n        //地面\n        let totoal= this.Bgbz.height+height -50;\n        let skyposy;\n        let bzYbottom;\n        let other = GameHeight- totoal;\n        bzYbottom= (totoal+height - GameHeight)/2 -25;\n        this.Bgbz.y=bzYbottom;\n        if(other>0){\n            this.Sky.active = true;\n            this.Sky.height = other+10;\n            skyposy= (GameHeight - other)/2;\n            this.Sky.y=skyposy;\n            this.camera.node.setPositionY(GameCenterY);\n        }else{\n            this.Sky.active = false;\n            this.camera.node.setPositionY(GameCenterY - other);\n\n        }\n        this.curMaxLine = this.floorNum -1;\n    },\n\n\n    //************camera 相关设置 end **********************\n    //*********** 锤子 相关设置  start***************\n    setSmPosition:function(hammerpos){\n        let realwidth=this.blockWidth+this.blockBlank;\n        let maxline = this.curMaxLine;\n        let maxrow = this.totoalRowNum(0);\n        if(maxline == 0 && maxrow ==   0)\n        {\n            this.HattingPos =null;\n            // this.sm.node.visible = false;\n            this.hammers[hammerpos].node.active = false;\n            return ;\n        }\n        this.hammers[hammerpos].node.active = true;\n        let range = this.geScreenRange();\n        // let line = GameUtils.randomInt(range.min,range.max);\n        let line = this.curMaxLine;\n        let find = false;\n        let canclick=[];\n        for(var i = 0;i<this.rowNum;i++){//当前行可以删除的\n            if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\n                let find = false;\n                for(let j=1;j<=4;j++){\n                    if( this.HattingPos && this.HattingPos[j]){\n                        if(this.HattingPos[j].x == line && i ==this.HattingPos[j].y){\n                            find= true;\n                            break;\n                        }\n                    }\n                }\n                if(!find){\n                    canclick.push(i);\n                }\n            }\n        }\n\n        if(canclick.length ==0 && line ==0){\n            this.HattingPos[hammerpos] = null;\n            return;\n        }else if(canclick.length == 0){\n            line= line-1;\n            for(var i = 0;i<this.rowNum;i++){//当前行可以删除的\n                if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\n                    let find = false;\n                    for(let j=1;j<=4;j++){\n                        if( this.HattingPos && this.HattingPos[j]){\n                            if(this.HattingPos[j].x == line && i ==this.HattingPos[j].y){\n                                find= true;\n                                break;\n                            }\n                        }\n                    }\n                    if(!find){\n                        canclick.push(i);\n                    }\n                }\n            }\n        }\n        let num = GameUtils.randomInt(0,canclick.length-1);\n        let row= canclick[num];\n\n        let location = this.hammerpos(line,row);\n        let texiao=this.getEffByBlock(line,row);\n        ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n        if(this.HattingPos == null){\n            this.HattingPos= {};\n        }\n        this.HattingPos[hammerpos] ={x:line,y:row};\n        this.hammers[hammerpos].node.position=location;\n        this.playHammerSpine(hammerpos);\n    },\n    //根据小块的位置 过的特效文件\n    getEffByBlock(line,row){\n\n        let type = this.type == 0? \"BlockBig\":\"BlockSmall\";\n        let node = this.blocks[line][row].getComponent(type);\n        return node.getPngId();\n    },\n    geScreenRange : function(){\n        let max = this.curMaxLine;\n        let cameraPosY = this.camera.node.getPositionY();\n        let min=0;\n        let realwidth=this.blockWidth+this.blockBlank;\n        if(cameraPosY <= BaseHeight){\n            min =0;\n        }else{\n            let maxPosY= max*realwidth;\n            let canshowy = (maxPosY - cameraPosY+BaseHeight)/realwidth;\n            min = Math.floor(max- canshowy);\n        }\n        return {max:max,min:min};\n    },\n    //根据块的位置计算锤子的位置\n    hammerpos:function(line,row){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        let realx = row * realwidth+this.margins+this.blockBlank;\n        let realy = line * realwidth+gameY -cameraY -BaseGame;\n        let hamX= realx - BaseWidth + 42+this.blockWidth;\n        let hamY = realy - 42;\n        return cc.p(hamX,hamY);\n\n    },\n    smCallback:function(hammerpos){\n        if(this.HattingPos != null && this.HattingPos[hammerpos]!=null ){\n            let y= this.HattingPos[hammerpos].y;\n            let x= this.HattingPos[hammerpos].x;\n            if(cc.isValid(this.blocks[x][y])){\n                // this.blocks[x][y].destroy();\n                this.destroyBlock(x,y);\n            }\n            this.cameraCentPosY();\n            this.setSmPosition(hammerpos);\n        }\n    },\n    //*********** 锤子 相关设置  end*****************\n\n    updateTouch:function(point){\n        let cameraY= this.camera.node.getPositionY();\n        let gameY = this.gameNode.y;\n        let realwidth=this.blockWidth+this.blockBlank;\n        var line = Math.floor((point.y-(gameY-cameraY+BaseHeight - BaseGame))/realwidth);\n        var row = Math.floor((point.x-this.margins - this.blockBlank)/realwidth);\n        if(this.checkCanDestroy(line,row)){\n            let location = this.hammerpos(line,row);\n            let texiao=this.getEffByBlock(line,row);\n            ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\n            this.destroyBlock(line,row);\n        }\n    },\n    touchStartCallBack:function (location) {\n        if(!this.canTouch){\n            return;\n        }\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins)){\n            this.motionStreak.reset();\n            return;\n        }\n        console.log(\"touchStartCallBack\");\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n        this.motionStreak.reset();\n        // this.isTouching = false;\n    },\n\n    touchCancelCallBack:function (location) {\n        this.updateTouch(location);\n        this.isTouching = false;\n        this.motionStreak.reset();\n    },\n\n    touchEndCallBack:function (location) {\n        // this.touchPosition(location);\n        this.updateTouch(location);\n        this.isTouching = false;\n        console.log(\"touchEndCallBack\");\n        this.motionStreak.reset();\n    },\n    touchMoveCallBack:function (location) {\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins\n            || location.y<216 )){\n            this.motionStreak.reset();\n            return;\n        }\n        this.updateTouch(location);\n        this.previousPt = location;\n        this.motionStreak.node.setPositionX(location.x);\n        this.motionStreak.node.setPositionY(location.y);\n    },\n\n    onClickTreasure:function(event){\n        var maxlinenum= this.maxLineNum();\n        var totoalRowNum= this.totoalRowNum(0);\n        if(maxlinenum != 0  || totoalRowNum != 0){\n            this.touchEndPoint = event.getLocation();\n\n            this.updateTouch(this.touchEndPoint);\n            return;\n        }\n        this.btnbox.node.active = false;\n        this.playBoxSpine();\n    },\n    update:function(){\n        this.cameraCentPosY();\n    },\n    eventcallback: function(type, id) {\n        // let node= this.itemList.indexOf(sender);\n        switch (type) {\n            case 0:\n                break;\n            case 1:\n                // let info = ToolConfig[id];\n                // let animation = info.animation;\n                // // BoxController.changeHammerSpine(animation);\n                // SkeletonDataCenter.addSkeletonData(animation, BoxController.changeHammerSpine);\n                this.toolChange(id);\n                break;\n            case 2:\n                break;\n        }\n    },\n    toolChange:function(id) {\n        let info = ToolConfig[id];\n        // let animation = info.animation;\n        // this.BoxController.changeHammerSpine(animation);\n        // let node = this.BoxController.hammers[id-1];\n        // SkeletonDataCenter.addSkeletonData(animation,node);\n        if(Global.hammer[id] == undefined){\n            Global.hammer[id]={id:id,attribute:info.attribute};\n            Global.saveHammer(Global.hammer);\n            this.addHammer(id);\n            this.setSmPosition(id);\n        }else{\n            let conf = AttributeConfig[Global.hammer[id].attribute];\n            if(conf.costtype = 1001){\n                Global.gold -= conf.cost;\n            }else if(conf.costtype = 1002){\n                Global.gem -= conf.cost;\n            }\n            if(conf.next != -1){\n                Global.hammer[id].attribute = conf.next;\n                let conf1=AttributeConfig[conf.next];\n                Global.saveHammer(Global.hammer);\n                this.hammers[id].timeScale = 0.17*(conf1.att/parseFloat(conf1.time));\n            }\n        }\n    },\n    initTreasure:function(){\n        let BoxID = StageConfig[this.hard].box;\n        let BoxConf = BoxConfig[BoxID];\n        this.treasure.normalSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        this.treasure.pressedSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        this.treasure.hoverSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        this.treasure.disabledSprite = SpriteFrameCenter.getFrameFromAtlas(\"png/box\",BoxConf.icon+\".png\");\n        let animation = BoxConf.animation+\".json\";\n        SkeletonDataCenter.addSkeletonDataWait(animation,  this.boxSpine);\n        this.treasure.node.y = - GameHeight/2+ this.blockWidth+35 -20;\n\n    }\n});"]}