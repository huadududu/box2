{"version":3,"sources":["BoxController.js"],"names":["CameraController","require","StageConfig","BlockConfig","CycleConfig","ToolConfig","GameType","GameUtils","BlockBigFactory","BlockSmallFactory","SpriteFrameCenter","ParticleSystemCenter","SkeletonDataCenter","winsize","cc","winSize","BaseHeight","height","BaseWidth","width","GameHeight","GameCenterY","BaseGame","Class","extends","Component","properties","gameNode","Node","camera","Camera","BlockBig","Prefab","BlockSmall","MarginsBig","MarginsSmall","UIBottom","Sky","Bgbz","Underground","motionStreak","MotionStreak","boxSpine","sp","Skeleton","btnbox","Button","language","visible","default","hard","myinfo","type","floorNum","rowNum","blockWidth","blockBlank","moveNum","margins","curMaxLine","canTouch","previousPt","Hatting","HattingPos","onLoad","preLoadAtlas","initdata","bind","GameMenuController","find","getComponent","blocks","marginlist","hammers","startPos","node","active","setCompleteListener","animationName1","trackEntry","animation","name","log","trackIndex","restart","playBoxSpine","setAnimation","stopBoxSpine","playHammerSpine","hammer","stopHammerSpine","changeHammerSpine","data","skeletonData","start","JSON","parse","sys","localStorage","getItem","level","gold","gem","exp","setItem","stringify","initInfo","layer","i","length","blockwidth","size","count","blank","addBlocks","cameraStartPosY","addUIBottom","destroy","timescale","addComponent","info","addSkeletonData","addChild","push","animationName","setSmPosition","smCallback","timeScale","resetMarginList","isValid","resetBlockList","j","lineinfo","addLines","getPngName","cycleID","topline","top","pngname","thisNum","conf","factory","curX","curY","lineArray","left","createMargins","position","p","right","endpos","create","thisID","indexOf","cycleArry","split","getnum","randomInt","parseInt","neednumber","destroyBlock","line","row","destroyUpdate","checkCanDestroy","updateDate","maxLineNum","max","totoalRowNum","cameraCentPosY","maxline","move","oldY","getPositionY","newY","setPositionY","posbottom","y","totoal","skyposy","bzYbottom","other","realwidth","maxrow","range","geScreenRange","canclick","num","location","hammerpos","texiao","getEffByBlock","addParticleForNode","x","getPngId","cameraPosY","min","maxPosY","canshowy","Math","floor","cameraY","gameY","realx","realy","hamX","hamY","updateTouch","point","touchStartCallBack","reset","console","setPositionX","touchCancelCallBack","isTouching","touchEndCallBack","touchMoveCallBack","onClickTreasure","event","maxlinenum","touchEndPoint","getLocation","update"],"mappings":"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","file":"BoxController.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\src\\controller","sourcesContent":["/**\r\n * Created by bing on 20/04/2018.\r\n */\r\n\r\n//负责head展现和变换。\r\nconst CameraController = require('CameraController');\r\nlet StageConfig = require(\"StageConfig\");\r\nlet BlockConfig = require(\"BoxConfig1\");\r\nlet CycleConfig = require(\"CycleConfig\");\r\nlet ToolConfig = require(\"ToolConfig\");\r\n\r\nlet GameType = require(\"GameType\");\r\nlet GameUtils = require(\"GameUtils\");\r\nlet BlockBigFactory = require(\"BlockBigFactory\");\r\nlet BlockSmallFactory = require(\"BlockSmallFactory\");\r\nlet SpriteFrameCenter = require(\"SpriteFrameCenter\");\r\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\r\nlet SkeletonDataCenter = require(\"SkeletonDataCenter\");\r\n// let GameMenuController = require('GameMenuController');\r\n\r\n\r\nlet winsize = cc.winSize;\r\nconst BaseHeight =  winsize.height/2;\r\nconst BaseWidth =  winsize.width/2;\r\nconst GameHeight = 514;\r\nconst GameCenterY = 360;\r\nconst BaseGame = 257 ;\r\n\r\ncc.Class({\r\n    extends:cc.Component,\r\n\r\n    properties:{\r\n        gameNode:cc.Node,\r\n        camera: cc.Camera,\r\n        BlockBig:cc.Prefab,\r\n        BlockSmall:cc.Prefab,\r\n        MarginsBig:cc.Prefab,\r\n        MarginsSmall:cc.Prefab,\r\n        UIBottom:cc.Prefab,\r\n        Sky:cc.Node,\r\n        Bgbz:cc.Node,\r\n        Underground:cc.Node,\r\n        motionStreak: cc.MotionStreak,\r\n        // hammer: sp.Skeleton,\r\n        boxSpine:sp.Skeleton,\r\n        btnbox:cc.Button,\r\n        // GameMenuController: GameMenuController,\r\n        language:{\r\n            visible: false,\r\n            default:\"English\" \r\n        },\r\n        hard:{\r\n            visible : true,\r\n            default:5\r\n        },\r\n        myinfo:{\r\n            visible : true,\r\n            default:null\r\n        },\r\n        type:{\r\n            visible : false,\r\n            default:0\r\n        },\r\n        floorNum:{\r\n            visible:false,\r\n            default:5\r\n        },\r\n        rowNum:{\r\n            visible:false,\r\n            default:5\r\n        },\r\n        blockWidth:100,\r\n        blockBlank:{\r\n            visible:false,\r\n            default:0\r\n        },\r\n        moveNum:{\r\n            visible:false,\r\n            default:0\r\n        },\r\n        margins:{\r\n            visible:false,\r\n            default:0\r\n        },\r\n        curMaxLine:{\r\n            visible: false,\r\n            default:0\r\n        },\r\n        canTouch:{\r\n            visible:false,\r\n            default:true\r\n        },\r\n        previousPt:{\r\n            visible:false,\r\n            default:null\r\n        },\r\n        Hatting:{\r\n            visible:false,\r\n            default:false\r\n        },\r\n        HattingPos:{\r\n            visible: false,\r\n            default:null\r\n        }\r\n    },\r\n\r\n\r\n    onLoad:function () {\r\n        SpriteFrameCenter.preLoadAtlas(\"png/box\",this.initdata.bind(this));\r\n        this.GameMenuController = cc.find(\"GameMenu\").getComponent(\"GameMenuController\");\r\n        this.blocks = [];\r\n        this.marginlist=[];\r\n        this.hammers=[];\r\n        this.startPos = -GameHeight/2;\r\n        // this.sm.on('stop',      this.smCallback,        this);\r\n        // this.hammer.setCompleteListener(trackEntry => {\r\n        //     var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n        //     cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\r\n        //     this.hammer.node.active = false;\r\n        //       this.smCallback(this.hammer);\r\n        // });\r\n         this.boxSpine.node.active = false;\r\n        this.boxSpine.setCompleteListener(trackEntry => {\r\n            var animationName1 = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n            cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName1);\r\n             this.restart();\r\n            this.boxSpine.node.active = false;\r\n\r\n        });\r\n    },\r\n    playBoxSpine:function () {\r\n        this.boxSpine.node.active = true;\r\n        this.boxSpine.setAnimation(0, \"newAnimation\", false);\r\n    },\r\n    stopBoxSpine:function () {\r\n        this.boxSpine.node.active = false;\r\n    },\r\n    playHammerSpine:function (hammer) {\r\n\r\n         hammer.node.active = true;\r\n         hammer.setAnimation(0, \"newAnimation\", true);\r\n    },\r\n    stopHammerSpine:function (hammer) {\r\n        hammer.node.active = false;\r\n    },\r\n    changeHammerSpine:function(data){\r\n        // this.hammer.node.active = false;\r\n        this.hammer.skeletonData = data;\r\n    },\r\n    start:function(){\r\n        // this.initdata();\r\n        this.myinfo = JSON.parse(cc.sys.localStorage.getItem('myinfo'));\r\n        if(this.myinfo == null){\r\n            this.myinfo ={hard:1,level:1,gold:1,gem:1,exp:1,hammer:[]};\r\n        }\r\n        this.myinfo ={hard:1,level:1,gold:1,gem:1,exp:1,hammer:[{\"id\":1,\"attribute\":101},{\"id\":2,\"attribute\":201},{\"id\":3,\"attribute\":301},{\"id\":4,\"attribute\":401}]};\r\n        cc.sys.localStorage.setItem('myinfo',JSON.stringify(this.myinfo));\r\n        this.hard = this.myinfo[\"hard\"];\r\n        this.GameMenuController.initInfo(this.myinfo);\r\n\r\n    },\r\n    restart:function(){\r\n        this.hard++;\r\n        this.myinfo.hard++;\r\n        this.myinfo.gold+=1000;\r\n        this.initdata();\r\n    },\r\n    initdata:function(){\r\n        this.floorNum=StageConfig[this.hard].layer;\r\n        for (var i = 0;i<BlockConfig.length;i++){\r\n            if(BlockConfig[i].blockwidth == StageConfig[this.hard].size){\r\n                this.type = BlockConfig[i].type;\r\n                break;\r\n            }\r\n        }\r\n        this.rowNum=BlockConfig[this.type].count;\r\n        this.blockWidth=BlockConfig[this.type].blockwidth;\r\n        this.blockBlank=BlockConfig[this.type].blank;\r\n        this.margins=BlockConfig[this.type].margins;\r\n\r\n        this.addBlocks();\r\n        this.cameraStartPosY();\r\n        // this.setSmPosition(this.hammer);\r\n        this.GameMenuController.addUIBottom();\r\n\r\n        // this.playHammers(this.hammer);\r\n        this.btnbox.node.active = true;\r\n        for(let i=0;i<this.hammers.length;i++){\r\n            let node = this.hammers[i];\r\n            node.destroy();\r\n        }\r\n        this.hammers=[];\r\n        let timescale=1;\r\n        for(let i=0;i<this.myinfo.hammer.length;i++){\r\n            let node = this.myinfo.hammer[i];\r\n            if(node != null){\r\n                node = new  cc.Node();\r\n                let hammer = node.addComponent(sp.Skeleton);\r\n                let info = ToolConfig[i+1];\r\n                let animation = info.animation;\r\n                SkeletonDataCenter.addSkeletonData(animation,hammer) ;\r\n                this.gameNode.addChild(node);\r\n                this.hammers.push(hammer);\r\n                hammer.setCompleteListener(trackEntry => {\r\n                    var animationName = trackEntry.animation ? trackEntry.animation.name : \"\";\r\n                    cc.log(\"recordSpine [track %s][animation %s] end.\", trackEntry.trackIndex, animationName);\r\n                    hammer.node.active = false;\r\n                    this.setSmPosition(hammer);\r\n                    this.smCallback(hammer);\r\n                });\r\n                timescale*=0.9;\r\n                hammer.timeScale = timescale;  \r\n\r\n\r\n            }\r\n        }\r\n    },\r\n    resetMarginList:function(){\r\n        if(this.marginlist.length>0){\r\n            for(let i=0 ;i<this.marginlist.length;i++){\r\n                let node = this.marginlist[i];\r\n                if(cc.isValid(node)){\r\n                    node.destroy();\r\n                }\r\n            }\r\n        }\r\n        this.marginlist=[];\r\n    },\r\n    resetBlockList:function(){\r\n        if(this.blocks.length>0){\r\n            for(let i=0 ;i<this.blocks.length;i++){\r\n                for( let j=0;j<this.blocks[i].length;j++){\r\n                    let node = this.blocks[i][j];\r\n                    if(cc.isValid(node)){\r\n                        node.destroy();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.blocks=[];\r\n    },\r\n    //--------- block -----------------------\r\n    addBlocks:function() {\r\n\r\n        this.resetBlockList();\r\n        this.resetMarginList();\r\n        for (var i =0;i< this.floorNum-1;i++){\r\n\r\n            var lineinfo=this.addLines(this.getPngName(StageConfig[this.hard].cycleID,i),i);\r\n\r\n            this.blocks.push(lineinfo);\r\n            lineinfo=[];\r\n        }\r\n        let topline = this.addLines(StageConfig[this.hard].top,i);\r\n        this.blocks.push(topline);\r\n    },\r\n    addLines:function (pngname,thisNum) {\r\n\r\n        let conf=BlockConfig[this.type];\r\n        let count = conf.count;\r\n        let factory= this.type == 0?BlockBigFactory:BlockSmallFactory;\r\n        let curX= conf.margins+conf.blank -BaseWidth;\r\n        let curY= thisNum*(this.blockWidth+conf.blank) + this.startPos;\r\n        let lineArray=[];\r\n        let left = factory.createMargins(pngname);\r\n\r\n        left.position = cc.p(conf.margins/2-BaseWidth,curY+this.blockWidth/2);\r\n        this.gameNode.addChild(left);\r\n        this.marginlist.push(left);\r\n        let right = factory.createMargins(pngname);\r\n        let endpos = BaseWidth- conf.margins/2;\r\n        right.position = cc.p(endpos,curY+this.blockWidth/2);\r\n        this.gameNode.addChild(right);\r\n        this.marginlist.push(right);\r\n\r\n        for(var i=0;i<count;i++){\r\n            let node = factory.create(pngname);\r\n            node.position = cc.p(curX+this.blockWidth/2,curY+this.blockWidth/2);\r\n            curX+=this.blockWidth+conf.blank;\r\n            this.gameNode.addChild(node);\r\n            lineArray.push(node);\r\n        }\r\n\r\n        return lineArray;\r\n    },\r\n\r\n    //根据 获得 图片的名字\r\n    getPngName(cycleID,thisNum){\r\n        let thisID;\r\n        if(cycleID.indexOf(\";\") != -1){\r\n            let cycleArry = cycleID.split(\";\");\r\n            let getnum=GameUtils.randomInt(0,cycleArry.length-1);\r\n            thisID=cycleArry[getnum];\r\n        }else{\r\n            thisID=parseInt(cycleID);\r\n        }\r\n        let neednumber=0;\r\n        for(var i =1;i<=10 ;i++)\r\n        {\r\n            if(CycleConfig[thisID][\"num\"+i] == 0){\r\n                i=0;\r\n                continue;\r\n            }\r\n            neednumber+=CycleConfig[thisID][\"num\"+i];\r\n            if(neednumber>=thisNum){\r\n                return CycleConfig[thisID][\"block\"+i]\r\n            }\r\n            if(i==10){\r\n                i=0;\r\n            }\r\n        }\r\n    },\r\n    //销毁砖块\r\n    destroyBlock:function(line,row ){\r\n\r\n        if(!this.blocks[line])\r\n            return;\r\n        let node = this.blocks[line][row];\r\n        if(cc.isValid(node) ) {\r\n            node.destroy();\r\n            this.destroyUpdate();\r\n        }\r\n\r\n    },\r\n    checkCanDestroy :function(line,row){\r\n        if(!cc.isValid(this.blocks[line]) || !cc.isValid(this.blocks[line][row]) )\r\n            return false;\r\n        if(line >= this.floorNum-1)\r\n            return true;\r\n        let node;\r\n        node = this.blocks[line+1][row];\r\n        if(!cc.isValid(node)){\r\n            return true;\r\n        }\r\n        if(line>0){\r\n            node = this.blocks[line-1][row];\r\n            if(!cc.isValid(node)){\r\n                return true;\r\n            }\r\n        }\r\n        if(row>0 && row <this.rowNum-1){\r\n            node = this.blocks[line][row-1];\r\n            if(!cc.isValid(node)){\r\n                return true;\r\n            }\r\n            node = this.blocks[line][row+1];\r\n            if(!cc.isValid(node)){\r\n                return true;\r\n            }\r\n        }else if (row == 0){\r\n            node = this.blocks[line][row+1];\r\n            if(!cc.isValid(node)){\r\n                return true;\r\n            }\r\n        }else if(row == this.rowNum-1){\r\n            node = this.blocks[line][row-1];\r\n            if(!cc.isValid(node)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    destroyUpdate:function(){\r\n        this.myinfo.exp++;\r\n        cc.sys.localStorage.setItem('myinfo',JSON.stringify(this.myinfo));\r\n        this.GameMenuController.updateDate({exp:this.myinfo.exp});\r\n\r\n    },\r\n    //--------- block -----------------------\r\n    maxLineNum:function(){\r\n        var max=0;\r\n        for(var i=0;i<this.floorNum;i++){\r\n            for(var j= 0;j<this.rowNum;j++) {\r\n                if (this.blocks && this.blocks[i] && this.blocks[i][j]) {\r\n                    var node = this.blocks[i][j];\r\n                    if (!cc.isValid(node))\r\n                        continue;\r\n                    if (i > max) {\r\n                        max = i;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return max;\r\n    },\r\n\r\n    totoalRowNum:function(line) {//line 行拥有点的数量\r\n        var max = 0;\r\n        for(var j= 0;j<this.rowNum;j++){\r\n            var node = this.blocks[line][j];\r\n            if(!cc.isValid(node) )\r\n                continue;\r\n            max++;\r\n        }\r\n        return max;\r\n    },\r\n\r\n    //************camera 相关设置 start **********************\r\n    cameraCentPosY:function(){\r\n\r\n        let maxline=this.maxLineNum();\r\n        if(this.curMaxLine<= maxline){\r\n            return;\r\n        }\r\n        let move = this.curMaxLine-maxline;\r\n        this.curMaxLine=maxline;\r\n        let oldY = this.camera.node.getPositionY();\r\n        if(oldY<=GameCenterY){\r\n            return;\r\n        }\r\n        let newY= oldY-this.blockWidth*move;\r\n        if(newY>=GameCenterY){\r\n            this.camera.node.setPositionY(newY);\r\n        }else {\r\n            this.camera.node.setPositionY(GameCenterY);\r\n        }\r\n\r\n    },\r\n\r\n    cameraStartPosY:function(){\r\n        let height = this.floorNum*(this.blockWidth+this.blockBlank);\r\n        //地下\r\n        this.Underground.height=height;\r\n        let posbottom= (height-GameHeight)/2;\r\n        this.Underground.y=posbottom;\r\n        //地面\r\n        let totoal= this.Bgbz.height+height -50;\r\n        let skyposy;\r\n        let bzYbottom;\r\n        let other = GameHeight- totoal;\r\n        bzYbottom= (totoal+height - GameHeight)/2 -25;\r\n        this.Bgbz.y=bzYbottom;\r\n        if(other>0){\r\n            this.Sky.active = true;\r\n            this.Sky.height = other+10;\r\n            skyposy= (GameHeight - other)/2;\r\n            this.Sky.y=skyposy;\r\n            this.camera.node.setPositionY(GameCenterY);\r\n        }else{\r\n            this.Sky.active = false;\r\n            this.camera.node.setPositionY(GameCenterY - other);\r\n\r\n        }\r\n        this.curMaxLine = this.floorNum -1;\r\n    },\r\n\r\n\r\n    //************camera 相关设置 end **********************\r\n    //*********** 锤子 相关设置  start***************\r\n    setSmPosition:function(hammer){\r\n        let realwidth=this.blockWidth+this.blockBlank;\r\n        let maxline = this.curMaxLine;\r\n        let maxrow = this.totoalRowNum(0);\r\n        if(maxline == 0 && maxrow ==   0)\r\n        {\r\n            this.HattingPos =null;\r\n            // this.sm.node.visible = false;\r\n            hammer.node.active = false;\r\n            return ;\r\n        }\r\n        hammer.node.active = true;\r\n        let range = this.geScreenRange();\r\n        // let line = GameUtils.randomInt(range.min,range.max);\r\n         let line = this.curMaxLine;\r\n        let find = false;\r\n        let canclick=[];\r\n        for(var i = 0;i<this.rowNum;i++){\r\n            if(this.blocks[line]&&this.checkCanDestroy(line,i) ){\r\n                canclick.push(i);\r\n\r\n            }\r\n        }\r\n\r\n       let num = GameUtils.randomInt(0,canclick.length-1);\r\n        let row= canclick[num];\r\n\r\n        let location = this.hammerpos(line,row);\r\n        let texiao=this.getEffByBlock(line,row);\r\n        ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\r\n        this.HattingPos ={x:line,y:row};\r\n       hammer.node.position=location;\r\n        this.playHammerSpine(hammer);\r\n    },\r\n    //根据小块的位置 过的特效文件\r\n    getEffByBlock(line,row){\r\n\r\n        let type = this.type == 0? \"BlockBig\":\"BlockSmall\";\r\n        let node = this.blocks[line][row].getComponent(type);\r\n        return node.getPngId();\r\n    },\r\n    geScreenRange : function(){\r\n        let max = this.curMaxLine;\r\n        let cameraPosY = this.camera.node.getPositionY();\r\n        let min=0;\r\n        let realwidth=this.blockWidth+this.blockBlank;\r\n        if(cameraPosY <= BaseHeight){\r\n            min =0;\r\n        }else{\r\n            let maxPosY= max*realwidth;\r\n            let canshowy = (maxPosY - cameraPosY+BaseHeight)/realwidth;\r\n            min = Math.floor(max- canshowy);\r\n        }\r\n        return {max:max,min:min};\r\n    },\r\n    //根据块的位置计算锤子的位置\r\n    hammerpos:function(line,row){\r\n        let cameraY= this.camera.node.getPositionY();\r\n        let gameY = this.gameNode.y;\r\n        let realwidth=this.blockWidth+this.blockBlank;\r\n        let realx = row * realwidth+this.margins+this.blockBlank;\r\n        let realy = line * realwidth+gameY -cameraY -BaseGame;\r\n        let hamX= realx - BaseWidth + 42+this.blockWidth;\r\n        let hamY = realy - 42;\r\n        return cc.p(hamX,hamY);\r\n\r\n    },\r\n    smCallback:function(hammer){\r\n        if(this.HattingPos != null){\r\n            let y= this.HattingPos.y;\r\n            let x= this.HattingPos.x;\r\n            if(cc.isValid(this.blocks[x][y])){\r\n                // this.blocks[x][y].destroy();\r\n                this.destroyBlock(x,y);\r\n            }\r\n            this.cameraCentPosY();\r\n             this.setSmPosition(hammer);\r\n        }\r\n    },\r\n    //*********** 锤子 相关设置  end*****************\r\n\r\n    updateTouch:function(point){\r\n        let cameraY= this.camera.node.getPositionY();\r\n        let gameY = this.gameNode.y;\r\n        let realwidth=this.blockWidth+this.blockBlank;\r\n        var line = Math.floor((point.y-(gameY-cameraY+BaseHeight - BaseGame))/realwidth);\r\n        var row = Math.floor((point.x-this.margins - this.blockBlank)/realwidth);\r\n        if(this.checkCanDestroy(line,row)){\r\n            let location = this.hammerpos(line,row);\r\n            let texiao=this.getEffByBlock(line,row);\r\n            ParticleSystemCenter.addParticleForNode(texiao+\".plist\",this.GameMenuController.node,location);\r\n            this.destroyBlock(line,row);\r\n        }\r\n    },\r\n    touchStartCallBack:function (location) {\r\n        if(!this.canTouch){\r\n            return;\r\n        }\r\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins)){\r\n            this.motionStreak.reset();\r\n            return;\r\n        }\r\n        console.log(\"touchStartCallBack\");\r\n        this.previousPt = location;\r\n        this.motionStreak.node.setPositionX(location.x);\r\n        this.motionStreak.node.setPositionY(location.y);\r\n        this.motionStreak.reset();\r\n        // this.isTouching = false;\r\n    },\r\n\r\n    touchCancelCallBack:function (location) {\r\n        this.updateTouch(location);\r\n        this.isTouching = false;\r\n        this.motionStreak.reset();\r\n    },\r\n\r\n    touchEndCallBack:function (location) {\r\n        // this.touchPosition(location);\r\n        this.updateTouch(location);\r\n        this.isTouching = false;\r\n        console.log(\"touchEndCallBack\");\r\n         this.motionStreak.reset();\r\n    },\r\n    touchMoveCallBack:function (location) {\r\n        if(location.x<this.margins || location.x >(2*BaseWidth-this.margins\r\n        || location.y<216 )){\r\n            this.motionStreak.reset();\r\n            return;\r\n        }\r\n        this.updateTouch(location);\r\n        this.previousPt = location;\r\n        this.motionStreak.node.setPositionX(location.x);\r\n        this.motionStreak.node.setPositionY(location.y);\r\n    },\r\n\r\n    onClickTreasure:function(event){\r\n        var maxlinenum= this.maxLineNum();\r\n        var totoalRowNum= this.totoalRowNum(0);\r\n        if(maxlinenum != 0  || totoalRowNum != 0){\r\n            this.touchEndPoint = event.getLocation();\r\n\r\n            this.updateTouch(this.touchEndPoint);\r\n            return;\r\n        }\r\n        this.btnbox.node.active = false;\r\n        this.playBoxSpine();\r\n    },\r\n    update:function(){\r\n        this.cameraCentPosY();\r\n    }\r\n});"]}