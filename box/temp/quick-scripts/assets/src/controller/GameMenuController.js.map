{"version":3,"sources":["GameMenuController.js"],"names":["GameMenuView","require","UIBottomFactory","AcceleratorConfig","ToolConfig","EfficiencyConfig","LevelConfig","ParticleSystemCenter","SkeletonDataCenter","cc","Class","extends","Component","properties","node","Node","bottomlist","scrollView","ScrollView","level","Label","gold","gem","TopProgressBar","ProgressBar","radioButton","default","type","Toggle","thisCheck","visible","BoxController","onLoad","config","itemList","addUIBottom","undefined","startpos","width","i","length","j","create","eventcallback","bind","position","p","addChild","push","initInfo","info","myinfo","setGoldNum","setLevel","setGem","hard","exp","setProgress","getPositionInView","item","worldPos","parent","convertToWorldSpaceAR","viewPos","convertToNodeSpaceAR","num","string","value","pro","progress","toolChange","id","animation","hammers","changeHammerSpine","data","updateDate","name","scrollEvent","sender","event","thispos","getScrollOffset","num1","num2","x","setCheckToggle","radioButtonClicked","toggle","index","indexOf","scrollToOffset","isChecked","onClickLevel","addlevel","needexp","needgold","rewardcoin"],"mappings":"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","file":"GameMenuController.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\src\\controller","sourcesContent":["/*\r\n * Created by Ren on 2018/6/6.\r\n */\r\nlet GameMenuView = require('GameMenuView');\r\nlet UIBottomFactory = require(\"UIBottomFactory\");\r\nlet AcceleratorConfig = require(\"AcceleratorConfig\");\r\nlet ToolConfig = require(\"ToolConfig\");\r\nlet EfficiencyConfig = require(\"EfficiencyConfig\");\r\nlet LevelConfig = require(\"LevelConfig\");\r\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\r\nlet SkeletonDataCenter = require(\"SkeletonDataCenter\");\r\n\r\ncc.Class({\r\n    extends:cc.Component,\r\n    properties:{\r\n        node:cc.Node,\r\n        bottomlist:cc.Node,\r\n        scrollView: cc.ScrollView,\r\n        level: cc.Label,\r\n        gold:cc.Label,\r\n        gem:cc.Label,\r\n        TopProgressBar:cc.ProgressBar,\r\n\r\n        radioButton:{\r\n            default:[],\r\n            type:cc.Toggle\r\n        },\r\n\r\n        thisCheck:{\r\n            visible:false,\r\n            default:0\r\n        },\r\n\r\n        BoxController: require(\"BoxController\")\r\n\r\n    },\r\n    onLoad:function(){\r\n        // this.BoxController = cc.find(\"Canvas\").getComponent(\"BoxController\");\r\n\r\n        this.config=[AcceleratorConfig,ToolConfig,EfficiencyConfig];\r\n        this.itemList=[];\r\n\r\n\r\n    },\r\n    addUIBottom:function(){\r\n        if(this.config == undefined)\r\n        {\r\n            this.config=[AcceleratorConfig,ToolConfig,EfficiencyConfig];\r\n        }\r\n        this.itemList=[];\r\n        let startpos = -this.bottomlist.width/2;\r\n        for(var i = 0;i < this.config.length;i++){\r\n            for(var j = 1; this.config[i][j] != undefined;j++){\r\n                let node = UIBottomFactory.create(i,this.config[i][j],\"English\",this.eventcallback.bind(this));\r\n                node.position = cc.p(startpos+75,0);\r\n                this.bottomlist.addChild(node);\r\n                this.itemList.push(node);\r\n                startpos+=156;\r\n            }\r\n        }\r\n    },\r\n    initInfo:function(info) {\r\n        this.myinfo = info;\r\n        this.setGoldNum(info.gold);\r\n        this.setLevel(info.level);\r\n        this.setGem(info.gem);\r\n        let hard = info.hard;\r\n\r\n        let exp = LevelConfig[info.hard].exp;\r\n\r\n        this.setProgress(info.exp/exp);\r\n        // this.ToggleContainer(info.gold);\r\n\r\n    },\r\n    getPositionInView: function (item) { // get item position in scrollview's node space\r\n        let worldPos = item.parent.convertToWorldSpaceAR(item.position);\r\n        let viewPos = this.scrollView.node.convertToNodeSpaceAR(worldPos);\r\n        return viewPos;\r\n    },\r\n    //设置金币\r\n    setGoldNum: function (num) {\r\n        this.gold.string = num;\r\n    },\r\n    setLevel: function (level) {\r\n        this.level.string = \"level:\"+level;\r\n    },\r\n    setGem: function (value){\r\n        this.gem.string = value;\r\n    },\r\n    setProgress: function (value){\r\n        let pro = this.TopProgressBar.progress;\r\n        if (pro  == 1.0 && value ==1)\r\n            return;\r\n        this.TopProgressBar.progress = value;\r\n    },\r\n    toolChange:function(id) {\r\n        let info = ToolConfig[id];\r\n        let animation = info.animation;\r\n        // this.BoxController.changeHammerSpine(animation);\r\n        let node = this.BoxController.hammers[id-1];\r\n        // SkeletonDataCenter.addSkeletonData(animation,node);\r\n    },\r\n    changeHammerSpine:function(data){\r\n        this.BoxController.changeHammerSpine(data);\r\n    },\r\n    updateDate:function (data){\r\n        for( var name in data) {\r\n            if (name == 'exp') {\r\n                let exp = LevelConfig[this.myinfo.level].exp;\r\n                let pro = data.exp / exp;\r\n                if (pro > 1)\r\n                    pro = 1;\r\n\r\n                this.setProgress(pro);\r\n            }\r\n            if (name == \"level\") {\r\n\r\n                this.setLevel(data.level);\r\n            }\r\n            if (name == \"gold\") {\r\n                this.setGoldNum(data.gold);\r\n            }\r\n        }\r\n    },\r\n    scrollEvent: function(sender, event) {\r\n        let thispos= sender.getScrollOffset();\r\n        // switch(event) {\r\n        //     case 2: //left\r\n        //        // this.lblScrollEvent.string = \"Scroll to Left\";\r\n        //        break;\r\n        //     case 3: ////right\r\n        //        // this.lblScrollEvent.string = \"Scroll to Right\"; \r\n        //        break;\r\n        //    }\r\n        let num1= 2*156;\r\n        let num2 = 3*156;\r\n        if(-thispos.x <num1){\r\n            this.setCheckToggle(0);\r\n        }else if(-thispos.x < num2){\r\n            this.setCheckToggle(1);\r\n\r\n        }else{\r\n            this.setCheckToggle(2);\r\n        }\r\n    },\r\n\r\n    radioButtonClicked: function(toggle) {\r\n        var index = this.radioButton.indexOf(toggle);\r\n        // var title = \"RadioButton\";\r\n        switch(index) {\r\n            case 0:\r\n                // title += \"1\";\r\n                this.scrollView.scrollToOffset(cc.p(0 , 0), 0.2);\r\n                break;\r\n            case 1:\r\n                let num1= 2*156;\r\n                this.scrollView.scrollToOffset(cc.p( num1, 0), 0.2);\r\n                // title += \"2\";\r\n                break;\r\n            case 2:\r\n                let num2= 4*156;\r\n                this.scrollView.scrollToOffset(cc.p( num2, 0), 0.2);\r\n                // title += \"3\";\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n\r\n    setCheckToggle: function(num) {\r\n        if( this.thisCheck == num )\r\n            return;\r\n        this.thisCheck= num;\r\n        for( let i=0;i < this.radioButton.length;i++)\r\n        {\r\n            if(i == num){\r\n                this.radioButton[i].isChecked = true;\r\n            }\r\n            else{\r\n                this.radioButton[i].isChecked = false;\r\n            }\r\n        }\r\n    },\r\n    eventcallback: function(type, id) {\r\n        // let node= this.itemList.indexOf(sender);\r\n        switch (type) {\r\n            case 0:\r\n                break;\r\n            case 1:\r\n                // let info = ToolConfig[id];\r\n                // let animation = info.animation;\r\n                // // BoxController.changeHammerSpine(animation);\r\n                // SkeletonDataCenter.addSkeletonData(animation, BoxController.changeHammerSpine);\r\n                this.toolChange(id);\r\n                break;\r\n            case 2:\r\n                break;\r\n        }\r\n    },\r\n\r\n    //点击升级按钮\r\n    onClickLevel:function(){\r\n        if(this.TopProgressBar.progress >=1){\r\n            this.addlevel();\r\n\r\n        }\r\n\r\n    },\r\n    addlevel:function(){\r\n        let level =this.myinfo.level+1;\r\n        let needexp = LevelConfig[ this.myinfo.level].exp;\r\n\r\n        let needgold = LevelConfig[ this.myinfo.level].rewardcoin;\r\n        this.myinfo.level = level;\r\n        this.myinfo.exp -=needexp;\r\n        this.myinfo.gold -= needgold;\r\n        this.updateDate(this.myinfo);\r\n\r\n    }\r\n});"]}