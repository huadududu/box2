{"version":3,"sources":["GameMenuController.js"],"names":["GameMenuView","require","UIBottomFactory","AcceleratorConfig","ToolConfig","EfficiencyConfig","LevelConfig","GameUtils","Global","cc","Class","extends","Component","properties","bottomlist","Node","scrollView","ScrollView","level","Label","gold","gem","TopProgressBar","ProgressBar","radioButton","default","type","Toggle","levelupBtn","Button","thisCheck","visible","radiotext","BoxController","onLoad","config","itemList","btnColor","itemlistNum","addUIBottom","undefined","startpos","i","length","j","node","create","eventcallback","bind","position","p","addChild","push","single","needlength","width","initInfo","setGoldNum","setLevel","setGem","hard","exp","setProgress","num","strnum","formatNum","string","value","pro","progress","interactable","changeHammerSpine","data","updateDate","name","updateButtom","scrollEvent","sender","event","thispos","getScrollOffset","movex","x","num1","num2","setCheckToggle","radioButtonClicked","toggle","index","indexOf","scrollToOffset","num0","color","onClickLevel","typebtn","upgradView","active","id","getComponent","setBtnState"],"mappings":"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","file":"GameMenuController.js","sourceRoot":"../../../../../assets/src/controller","sourcesContent":["/*\n * Created by Ren on 2018/6/6.\n */\nlet GameMenuView = require('GameMenuView');\nlet UIBottomFactory = require(\"UIBottomFactory\");\nlet AcceleratorConfig = require(\"AcceleratorConfig\");\nlet ToolConfig = require(\"ToolConfig\");\nlet EfficiencyConfig = require(\"EfficiencyConfig\");\nlet LevelConfig = require(\"LevelConfig\");\nlet GameUtils = require(\"GameUtils\");\nlet Global = require('Global');\n\ncc.Class({\n    extends:cc.Component,\n    properties:{\n        bottomlist:cc.Node,\n        scrollView: cc.ScrollView,\n        level: cc.Label,\n        gold:cc.Label,\n        gem:cc.Label,\n        TopProgressBar:cc.ProgressBar,\n        radioButton:{\n            default:[],\n            type:cc.Toggle\n        },\n        levelupBtn:cc.Button,\n        thisCheck:{\n            visible:false,\n            default:0\n        },\n        radiotext:{\n            default:[],\n            type:cc.Label\n        },\n        BoxController: require(\"BoxController\")\n\n    },\n    onLoad:function(){\n\n        this.config=[AcceleratorConfig,ToolConfig,EfficiencyConfig];\n        this.itemList=[];\n        this.btnColor=['#ffa30f','#f9f9f9'];\n        this.itemlistNum=[];\n    },\n    addUIBottom:function(){\n        if(this.config == undefined)\n        {\n            this.config=[AcceleratorConfig,ToolConfig,EfficiencyConfig];\n        }\n        this.itemList=[];\n        // let startpos = -this.bottomlist.width/2;\n        let startpos = 0;\n\n        for(var i = 0;i < this.config.length;i++){\n            var j = 1;\n            for(; this.config[i][j] != undefined;j++){\n                let node = UIBottomFactory.create(i,this.config[i][j],this.eventcallback.bind(this));\n                node.position = cc.p(startpos+75,0);\n                this.bottomlist.addChild(node);\n                this.itemList.push(node);\n                startpos+=156;\n            }\n            this.itemlistNum[i]=j-1;\n\n        }\n        let single = this.itemlistNum[this.itemlistNum.length-1];\n        if(single<7){\n            startpos+=(7-single)*156;\n        }\n        let needlength = startpos+156;\n        this.bottomlist.width = needlength;\n        // this.bottomlist.x = needlength/2;\n\n\n    },\n    initInfo:function() {\n        this.setGoldNum(Global.gold);\n        this.setLevel(Global.level);\n        this.setGem(Global.gem);\n        let hard = Global.hard;\n\n        let exp = LevelConfig[Global.level].exp;\n        this.setProgress(Global.exp/exp);\n\n    },\n    //设置金币\n    setGoldNum: function (num) {\n        let strnum = GameUtils.formatNum(num);\n        this.gold.string = strnum;\n    },\n    setLevel: function (level) {\n        this.level.string = \"LEVEL\"+level;\n    },\n    setGem: function (value){\n        this.gem.string = value;\n    },\n    setProgress: function (value){\n        let pro = this.TopProgressBar.progress;\n        if (pro  == 1.0 && value ==1)\n            return;\n        this.levelupBtn.interactable = value>=1;\n        this.TopProgressBar.progress = value;\n    },\n\n    changeHammerSpine:function(data){\n        this.BoxController.changeHammerSpine(data);\n    },\n    updateDate:function (data){\n        if(data == null)\n            return;\n        for( var name in data) {\n            if (name == 'exp') {\n                let exp = LevelConfig[Global.level].exp;\n                let pro = data.exp / exp;\n                if (pro > 1)\n                    pro = 1;\n\n                this.setProgress(pro);\n            }\n            if (name == \"level\") {\n\n                this.setLevel(data.level);\n            }\n            if (name == \"gold\") {\n                this.setGoldNum(data.gold);\n            }\n            if(name == 'gem'){\n                this.setGem(data.gem);\n            }\n        }\n        if (name == \"level\" || name == \"gold\" || name == 'gem' ){\n            this.updateButtom();\n        }\n    },\n    scrollEvent: function(sender, event) {\n        let thispos= sender.getScrollOffset();\n        let movex = -thispos.x;\n        // switch(event) {\n        //     case 2: //left\n        //        // this.lblScrollEvent.string = \"Scroll to Left\";\n        //        break;\n        //     case 3: ////right\n        //        // this.lblScrollEvent.string = \"Scroll to Right\"; \n        //        break;\n        //    }\n        let num1= this.itemlistNum[0]*156 - 6;\n        let num2 = num1+this.itemlistNum[1]*156 - 6;\n        if(movex <num1){\n            this.setCheckToggle(0);\n        }else if(movex <num2){\n            this.setCheckToggle(1);\n\n        }else{\n            this.setCheckToggle(2);\n        }\n    },\n\n    radioButtonClicked: function(toggle) {\n        var index = this.radioButton.indexOf(toggle);\n        // var title = \"RadioButton\";\n        switch(index) {\n            case 0:\n                // title += \"1\";\n                this.scrollView.scrollToOffset(cc.p(0 , 0), 0.2);\n                break;\n            case 1:\n                let num0= this.itemlistNum[0]*156;\n                this.scrollView.scrollToOffset(cc.p( num0, 0), 0.2);\n                // title += \"2\";\n                break;\n            case 2:\n                let num1= (this.itemlistNum[0]+this.itemlistNum[1])*156;\n                this.scrollView.scrollToOffset(cc.p( num1, 0), 0.2);\n                // title += \"3\";\n                break;\n            default:\n                break;\n        }\n        // this.setCheckToggle(index);\n    },\n\n    setCheckToggle: function(num) {\n        if( this.thisCheck == num )\n            return;\n        this.thisCheck= num;\n        for( let i=0;i < this.radioButton.length;i++)\n        {\n            if(i == num){\n                // this.radioButton[i].isChecked = true;\n                this.radiotext[i].node.color = new cc.color(this.btnColor[0]);\n            }\n            else{\n                // this.radioButton[i].isChecked = false;\n                this.radiotext[i].node.color =new cc.color(this.btnColor[1]);\n            }\n        }\n    },\n\n\n    //点击升级按钮\n    onClickLevel:function(){\n        if(this.TopProgressBar.progress >=1){\n            Global.typebtn = 'uplevel';\n            this.BoxController.upgradView.active = true;\n\n        }\n    },\n    eventcallback: function(type, id,string=null) {\n\n        this.BoxController.eventcallback(type,id,string);\n\n    },\n    updateButtom:function(){\n        for(let i=0;i<this.itemList.length;i++){\n            let node = this.itemList[i].getComponent(\"UIBottom\");\n            node.setBtnState();\n        }\n    }\n});"]}