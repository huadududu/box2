{"version":3,"sources":["GameMenuController.js"],"names":["GameMenuView","require","UIBottomFactory","AcceleratorConfig","ToolConfig","EfficiencyConfig","LevelConfig","ParticleSystemCenter","SkeletonDataCenter","Global","cc","Class","extends","Component","properties","bottomlist","Node","scrollView","ScrollView","level","Label","gold","gem","TopProgressBar","ProgressBar","radioButton","default","type","Toggle","levelupBtn","Button","thisCheck","visible","radiotext","BoxController","onLoad","config","itemList","btnColor","addUIBottom","undefined","startpos","width","i","length","j","node","create","eventcallback","bind","position","p","addChild","push","initInfo","setGoldNum","setLevel","setGem","hard","exp","setProgress","num","string","value","pro","progress","interactable","changeHammerSpine","data","updateDate","name","updateButtom","scrollEvent","sender","event","thispos","getScrollOffset","movex","x","num1","num2","setCheckToggle","radioButtonClicked","toggle","index","indexOf","scrollToOffset","color","onClickLevel","upgradView","active","addlevel","myinfo","needexp","needgold","rewardcoin","saveLevel","saveExp","saveGold","id","getComponent","setBtnState"],"mappings":"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","file":"GameMenuController.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\src\\controller","sourcesContent":["/*\r\n * Created by Ren on 2018/6/6.\r\n */\r\nlet GameMenuView = require('GameMenuView');\r\nlet UIBottomFactory = require(\"UIBottomFactory\");\r\nlet AcceleratorConfig = require(\"AcceleratorConfig\");\r\nlet ToolConfig = require(\"ToolConfig\");\r\nlet EfficiencyConfig = require(\"EfficiencyConfig\");\r\nlet LevelConfig = require(\"LevelConfig\");\r\nlet ParticleSystemCenter = require(\"ParticleSystemCenter\");\r\nlet SkeletonDataCenter = require(\"SkeletonDataCenter\");\r\nlet Global = require('Global');\r\n\r\ncc.Class({\r\n    extends:cc.Component,\r\n    properties:{\r\n        bottomlist:cc.Node,\r\n        scrollView: cc.ScrollView,\r\n        level: cc.Label,\r\n        gold:cc.Label,\r\n        gem:cc.Label,\r\n        TopProgressBar:cc.ProgressBar,\r\n        radioButton:{\r\n            default:[],\r\n            type:cc.Toggle\r\n        },\r\n        levelupBtn:cc.Button,\r\n        thisCheck:{\r\n            visible:false,\r\n            default:0\r\n        },\r\n        radiotext:{\r\n            default:[],\r\n            type:cc.Label\r\n        },\r\n        BoxController: require(\"BoxController\")\r\n\r\n    },\r\n    onLoad:function(){\r\n\r\n        this.config=[AcceleratorConfig,ToolConfig,EfficiencyConfig];\r\n        this.itemList=[];\r\n        this.btnColor=['#ffa30f','#f9f9f9'];\r\n        },\r\n    addUIBottom:function(){\r\n        if(this.config == undefined)\r\n        {\r\n            this.config=[AcceleratorConfig,ToolConfig,EfficiencyConfig];\r\n        }\r\n        this.itemList=[];\r\n        let startpos = -this.bottomlist.width/2;\r\n        for(var i = 0;i < this.config.length;i++){\r\n            for(var j = 1; this.config[i][j] != undefined;j++){\r\n                let node = UIBottomFactory.create(i,this.config[i][j],this.eventcallback.bind(this));\r\n                node.position = cc.p(startpos+75,0);\r\n                this.bottomlist.addChild(node);\r\n                this.itemList.push(node);\r\n                startpos+=156;\r\n            }\r\n        }\r\n    },\r\n    initInfo:function() {\r\n        this.setGoldNum(Global.gold);\r\n        this.setLevel(Global.level);\r\n        this.setGem(Global.gem);\r\n        let hard = Global.hard;\r\n\r\n        let exp = LevelConfig[Global.level].exp;\r\n        this.setProgress(Global.exp/exp);\r\n\r\n    },\r\n    //设置金币\r\n    setGoldNum: function (num) {\r\n        this.gold.string = num;\r\n    },\r\n    setLevel: function (level) {\r\n        this.level.string = \"level:\"+level;\r\n    },\r\n    setGem: function (value){\r\n        this.gem.string = value;\r\n    },\r\n    setProgress: function (value){\r\n        let pro = this.TopProgressBar.progress;\r\n        if (pro  == 1.0 && value ==1)\r\n            return;\r\n        this.levelupBtn.interactable = value>=1;\r\n        this.TopProgressBar.progress = value;\r\n    },\r\n\r\n    changeHammerSpine:function(data){\r\n        this.BoxController.changeHammerSpine(data);\r\n    },\r\n    updateDate:function (data){\r\n        for( var name in data) {\r\n            if (name == 'exp') {\r\n                let exp = LevelConfig[Global.level].exp;\r\n                let pro = data.exp / exp;\r\n                if (pro > 1)\r\n                    pro = 1;\r\n\r\n                this.setProgress(pro);\r\n            }\r\n            if (name == \"level\") {\r\n\r\n                this.setLevel(data.level);\r\n            }\r\n            if (name == \"gold\") {\r\n                this.setGoldNum(data.gold);\r\n            }\r\n            if(name == 'gem'){\r\n                this.setGem(data.gem);\r\n            }\r\n        }\r\n        if (name == \"level\" || name == \"gold\" ){\r\n            this.updateButtom();\r\n        }\r\n    },\r\n    scrollEvent: function(sender, event) {\r\n        let thispos= sender.getScrollOffset();\r\n        let movex = -thispos.x;\r\n        // switch(event) {\r\n        //     case 2: //left\r\n        //        // this.lblScrollEvent.string = \"Scroll to Left\";\r\n        //        break;\r\n        //     case 3: ////right\r\n        //        // this.lblScrollEvent.string = \"Scroll to Right\"; \r\n        //        break;\r\n        //    }\r\n        let num1= 310;\r\n        let num2 = 1240;\r\n        if(movex <num1){\r\n            this.setCheckToggle(0);\r\n        }else if(movex <num2){\r\n            this.setCheckToggle(1);\r\n\r\n        }else{\r\n            this.setCheckToggle(2);\r\n        }\r\n    },\r\n\r\n    radioButtonClicked: function(toggle) {\r\n        var index = this.radioButton.indexOf(toggle);\r\n        // var title = \"RadioButton\";\r\n        switch(index) {\r\n            case 0:\r\n                // title += \"1\";\r\n                this.scrollView.scrollToOffset(cc.p(0 , 0), 0.2);\r\n                break;\r\n            case 1:\r\n                let num1= 2*156;\r\n                this.scrollView.scrollToOffset(cc.p( num1, 0), 0.2);\r\n                // title += \"2\";\r\n                break;\r\n            case 2:\r\n                let num2= 8*156;\r\n                this.scrollView.scrollToOffset(cc.p( num2, 0), 0.2);\r\n                // title += \"3\";\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        this.setCheckToggle(index);\r\n    },\r\n\r\n    setCheckToggle: function(num) {\r\n        if( this.thisCheck == num )\r\n            return;\r\n        this.thisCheck= num;\r\n        for( let i=0;i < this.radioButton.length;i++)\r\n        {\r\n            if(i == num){\r\n                // this.radioButton[i].isChecked = true;\r\n                this.radiotext[i].node.color = new cc.color(this.btnColor[0]);\r\n            }\r\n            else{\r\n                // this.radioButton[i].isChecked = false;\r\n                this.radiotext[i].node.color =new cc.color(this.btnColor[1]);\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    //点击升级按钮\r\n    onClickLevel:function(){\r\n        if(this.TopProgressBar.progress >=1){\r\n            this.BoxController.upgradView.active = true;\r\n        }\r\n    },\r\n    addlevel:function(){\r\n            let myinfo ={};\r\n            let level =Global.level+1;\r\n            let needexp = LevelConfig[ level].exp;\r\n            let needgold = LevelConfig[ level].rewardcoin;\r\n            myinfo.level = level;\r\n            Global.saveLevel( level);\r\n            myinfo.exp =Global.exp-needexp;\r\n            Global.saveExp( myinfo.exp);\r\n            myinfo.gold = Global.gold+needgold;\r\n            Global.saveGold(myinfo.gold);\r\n            this.updateDate(myinfo);\r\n\r\n    },\r\n    eventcallback: function(type, id,string=null) {\r\n\r\n        this.BoxController.eventcallback(type,id,string);\r\n\r\n\r\n    },\r\n    updateButtom:function(){\r\n        for(let i=0;i<this.itemList.length;i++){\r\n            let node = this.itemList[i].getComponent(\"UIBottom\");\r\n            node.setBtnState();\r\n        }\r\n    }\r\n});"]}